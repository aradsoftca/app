{"version":3,"file":"static/js/382.ccf57abb.chunk.js","mappings":"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","sources":["hooks/useDocumentTitle.js","pages/PaymentSuccess.js"],"sourcesContent":["import { useEffect } from 'react';\r\n\r\n/**\r\n * Sets the document title for the current page.\r\n * Resets to default title on unmount.\r\n * @param {string} title - Page-specific title\r\n */\r\nconst useDocumentTitle = (title) => {\r\n  useEffect(() => {\r\n    const prev = document.title;\r\n    document.title = title ? `${title} | VPN XO` : 'VPN XO - Secure VPN Service';\r\n    return () => { document.title = prev; };\r\n  }, [title]);\r\n};\r\n\r\nexport default useDocumentTitle;\r\n","import React, { useEffect, useState, useCallback } from 'react';\nimport { Link, useSearchParams } from 'react-router-dom';\nimport { FaCheckCircle, FaSpinner, FaExclamationTriangle } from 'react-icons/fa';\nimport { apiService } from '../services/api';\nimport useDocumentTitle from '../hooks/useDocumentTitle';\n\nconst PaymentSuccess = () => {\n  useDocumentTitle('Payment Success');\n  const [searchParams] = useSearchParams();\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [subscription, setSubscription] = useState(null);\n  const [planType, setPlanType] = useState(null);\n\n  const getPlanName = (type) => {\n    switch (type) {\n      case 'monthly': return 'Monthly';\n      case '6month': return '6-Month';\n      case '12month': return '12-Month';\n      default: return 'Premium';\n    }\n  };\n\n  const verifyAndLoad = useCallback(async () => {\n    const sessionId = searchParams.get('session_id');\n    const source = searchParams.get('source');\n    const isCoinbase = source === 'coinbase';\n\n    if (!sessionId && !isCoinbase) {\n      setError('No payment session found');\n      setLoading(false);\n      return;\n    }\n\n    try {\n      // Step 1: Verify session (also triggers self-healing activation if webhook missed)\n      if (sessionId) {\n        try {\n          const verifyRes = await apiService.verifyCheckoutSession(sessionId);\n          if (verifyRes?.data?.planType) {\n            setPlanType(verifyRes.data.planType);\n          }\n        } catch (verifyErr) {\n          console.warn('Session verify:', verifyErr);\n        }\n      }\n\n      // Step 2: Poll subscription status until active (max ~15s)\n      const maxAttempts = isCoinbase ? 8 : 5;\n      const delay = isCoinbase ? 3000 : 2000;\n\n      for (let i = 0; i < maxAttempts; i++) {\n        if (i > 0) await new Promise(r => setTimeout(r, delay));\n        const response = await apiService.getSubscriptionStatus();\n        const data = response.data;\n        if (data?.tier === 'paid') {\n          setSubscription(data);\n          setLoading(false);\n          return;\n        }\n      }\n\n      // After polling: get latest status even if still free\n      const finalRes = await apiService.getSubscriptionStatus();\n      setSubscription(finalRes.data);\n    } catch (err) {\n      console.error('Payment verification failed:', err);\n      setError('Unable to verify payment. If you were charged, your plan will activate shortly.');\n    } finally {\n      setLoading(false);\n    }\n  }, [searchParams]);\n\n  useEffect(() => { verifyAndLoad(); }, [verifyAndLoad]);\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <FaSpinner className=\"text-white text-6xl mx-auto mb-4 animate-spin\" />\n          <div className=\"text-white text-2xl\">Verifying your payment...</div>\n          <div className=\"text-gray-300 mt-2\">This may take a few moments</div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full bg-white bg-opacity-10 backdrop-blur-md rounded-2xl p-8 border border-white border-opacity-20 text-center\">\n          <FaExclamationTriangle className=\"text-yellow-400 text-6xl mx-auto mb-4\" />\n          <h1 className=\"text-2xl font-bold text-white mb-3\">Verification Issue</h1>\n          <p className=\"text-gray-300 mb-6\">{error}</p>\n          <Link\n            to=\"/dashboard\"\n            className=\"block w-full py-3 rounded-full text-center font-semibold transition-all bg-blue-600 text-white hover:bg-blue-700\"\n          >\n            Go to Dashboard\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  const isPaid = subscription?.tier === 'paid';\n  const displayPlan = subscription?.planType || planType;\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 flex items-center justify-center p-4\">\n      <div className=\"max-w-lg w-full bg-white bg-opacity-10 backdrop-blur-md rounded-2xl p-8 border border-white border-opacity-20 text-center\">\n        \n        {isPaid ? (\n          <>\n            <FaCheckCircle className=\"text-green-400 text-7xl mx-auto mb-5\" />\n            <h1 className=\"text-3xl font-bold text-white mb-2\">Payment Successful!</h1>\n            <p className=\"text-gray-300 mb-6\">\n              Your {getPlanName(displayPlan)} plan is now active.\n            </p>\n\n            <div className=\"bg-white bg-opacity-10 rounded-xl p-5 mb-6 text-left space-y-3\">\n              <div className=\"flex justify-between text-gray-200\">\n                <span>Plan</span>\n                <span className=\"font-semibold text-white\">{getPlanName(displayPlan)}</span>\n              </div>\n              <div className=\"flex justify-between text-gray-200\">\n                <span>Status</span>\n                <span className=\"font-semibold text-green-400\">Active</span>\n              </div>\n              {subscription.daysRemaining > 0 && (\n                <div className=\"flex justify-between text-gray-200\">\n                  <span>Days Remaining</span>\n                  <span className=\"font-semibold text-white\">{subscription.daysRemaining}</span>\n                </div>\n              )}\n              {subscription.subscriptionEndDate && (\n                <div className=\"flex justify-between text-gray-200\">\n                  <span>Valid Until</span>\n                  <span className=\"font-semibold text-white\">\n                    {new Date(subscription.subscriptionEndDate).toLocaleDateString()}\n                  </span>\n                </div>\n              )}\n            </div>\n          </>\n        ) : (\n          <>\n            <FaCheckCircle className=\"text-yellow-400 text-7xl mx-auto mb-5\" />\n            <h1 className=\"text-3xl font-bold text-white mb-2\">Payment Received</h1>\n            <p className=\"text-gray-300 mb-6\">\n              Your payment was received. Your Premium plan will activate within a few minutes.\n              Check your dashboard for the updated status.\n            </p>\n          </>\n        )}\n\n        <Link\n          to=\"/dashboard\"\n          className=\"block w-full py-4 rounded-full text-center font-semibold text-lg transition-all bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:shadow-lg hover:scale-105\"\n        >\n          Go to Dashboard\n        </Link>\n      </div>\n    </div>\n  );\n};\n\nexport default PaymentSuccess;\n\n"],"names":["title","useEffect","prev","document","concat","PaymentSuccess","useDocumentTitle","searchParams","useSearchParams","loading","setLoading","useState","error","setError","subscription","setSubscription","planType","setPlanType","getPlanName","type","verifyAndLoad","useCallback","async","sessionId","get","isCoinbase","_verifyRes$data","verifyRes","apiService","verifyCheckoutSession","data","verifyErr","console","warn","maxAttempts","delay","i","Promise","r","setTimeout","getSubscriptionStatus","tier","finalRes","err","_jsx","className","children","_jsxs","FaSpinner","FaExclamationTriangle","Link","to","isPaid","displayPlan","_Fragment","FaCheckCircle","daysRemaining","subscriptionEndDate","Date","toLocaleDateString"],"sourceRoot":""}