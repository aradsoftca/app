"use strict";(self.webpackChunkvpn_xo_website=self.webpackChunkvpn_xo_website||[]).push([[870],{182:(e,t,s)=>{s.d(t,{A:()=>r});var a=s(9379),l=s(5043);const r=()=>{const[e,t]=(0,l.useState)({isOpen:!1,title:"Are you sure?",message:"",confirmText:"Confirm",cancelText:"Cancel",variant:"danger",resolve:null}),s=(0,l.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(s=>{t({isOpen:!0,title:e.title||"Are you sure?",message:e.message||"",confirmText:e.confirmText||"Confirm",cancelText:e.cancelText||"Cancel",variant:e.variant||"danger",resolve:s})})},[]),r=(0,l.useCallback)(()=>{var s;null===(s=e.resolve)||void 0===s||s.call(e,!0),t(e=>(0,a.A)((0,a.A)({},e),{},{isOpen:!1,resolve:null}))},[e.resolve]),i=(0,l.useCallback)(()=>{var s;null===(s=e.resolve)||void 0===s||s.call(e,!1),t(e=>(0,a.A)((0,a.A)({},e),{},{isOpen:!1,resolve:null}))},[e.resolve]);return{confirm:s,dialogProps:{isOpen:e.isOpen,title:e.title,message:e.message,confirmText:e.confirmText,cancelText:e.cancelText,variant:e.variant,onConfirm:r,onCancel:i}}}},2835:(e,t,s)=>{s.d(t,{A:()=>c});var a=s(9379),l=s(3986),r=(s(5043),s(12)),i=s(579);const n=["children","variant","size","fullWidth","disabled","loading","icon","onClick","type","className"],c=e=>{let{children:t,variant:s="primary",size:c="md",fullWidth:o=!1,disabled:d=!1,loading:x=!1,icon:m,onClick:p,type:h="button",className:u=""}=e,g=(0,l.A)(e,n);const b=o?"w-full":"",y=d||x?"opacity-50 cursor-not-allowed":"cursor-pointer transform hover:scale-105",j="\n    ".concat("font-bold rounded-full transition-all duration-300 flex items-center justify-center","\n    ").concat({primary:"bg-blue-600 hover:bg-blue-700 text-white shadow-lg hover:shadow-xl",secondary:"bg-green-500 hover:bg-green-600 text-white shadow-lg hover:shadow-xl",outline:"bg-white bg-opacity-10 hover:bg-opacity-20 text-white border-2 border-white border-opacity-30",ghost:"bg-transparent hover:bg-white hover:bg-opacity-10 text-white",danger:"bg-red-500 hover:bg-red-600 text-white shadow-lg hover:shadow-xl",success:"bg-green-600 hover:bg-green-700 text-white shadow-lg hover:shadow-xl",warning:"bg-yellow-500 hover:bg-yellow-600 text-gray-900 shadow-lg hover:shadow-xl",solid:"bg-white hover:bg-gray-100 text-gray-900 shadow-lg hover:shadow-xl"}[s],"\n    ").concat({sm:"px-4 py-2 text-sm",md:"px-6 py-3 text-base",lg:"px-10 py-4 text-lg",xl:"px-12 py-5 text-xl"}[c],"\n    ").concat(b,"\n    ").concat(y,"\n    ").concat(u,"\n  ").trim().replace(/\s+/g," ");return(0,i.jsx)(r.P.button,(0,a.A)((0,a.A)({type:h,className:j,onClick:p,disabled:d||x,whileTap:{scale:d||x?1:.95}},g),{},{children:x?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,i.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,i.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading..."]}):(0,i.jsxs)(i.Fragment,{children:[m&&(0,i.jsx)("span",{className:"mr-2",children:m}),t]})}))}},3367:(e,t,s)=>{s.d(t,{A:()=>n});s(5043);var a=s(12),l=s(6938),r=s(5369),i=s(579);const n=e=>{let{isOpen:t,title:s="Are you sure?",message:n="",confirmText:c="Confirm",cancelText:o="Cancel",variant:d="danger",onConfirm:x,onCancel:m}=e;const p={danger:{icon:"text-red-400",button:"bg-red-600 hover:bg-red-700 focus:ring-red-500",bg:"bg-red-900 bg-opacity-20"},warning:{icon:"text-yellow-400",button:"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500",bg:"bg-yellow-900 bg-opacity-20"},info:{icon:"text-blue-400",button:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500",bg:"bg-blue-900 bg-opacity-20"}},h=p[d]||p.danger;return(0,i.jsx)(l.N,{children:t&&(0,i.jsxs)(a.P.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},children:[(0,i.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-60",onClick:m}),(0,i.jsxs)(a.P.div,{className:"relative bg-gray-800 rounded-xl shadow-2xl border border-gray-700 max-w-md w-full p-6",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.15},role:"alertdialog","aria-modal":"true","aria-labelledby":"confirm-dialog-title","aria-describedby":"confirm-dialog-message",children:[(0,i.jsxs)("div",{className:"flex items-start gap-4",children:[(0,i.jsx)("div",{className:"flex-shrink-0 p-2 rounded-full ".concat(h.bg),children:(0,i.jsx)(r.BS8,{className:"text-xl ".concat(h.icon)})}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("h3",{id:"confirm-dialog-title",className:"text-lg font-semibold text-white mb-1",children:s}),(0,i.jsx)("p",{id:"confirm-dialog-message",className:"text-sm text-gray-300 leading-relaxed",children:n})]})]}),(0,i.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,i.jsx)("button",{onClick:m,className:"px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 rounded-lg hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 transition",children:o}),(0,i.jsx)("button",{onClick:x,className:"px-4 py-2 text-sm font-medium text-white rounded-lg focus:outline-none focus:ring-2 transition ".concat(h.button),autoFocus:!0,children:c})]})]})]})})}},3870:(e,t,s)=>{s.r(t),s.d(t,{default:()=>be});var a=s(9379),l=s(5043),r=s(3216),i=s(5475),n=s(12),c=s(5369),o=s(342),d=s(4505),x=s(8289),m=s(2835),p=s(6938),h=s(579);const u=e=>{let{isOpen:t,onClose:s,title:a,children:r,size:i="md",showCloseButton:o=!0,closeOnBackdrop:d=!0,closeOnEsc:x=!0,footer:m}=e;(0,l.useEffect)(()=>{if(!t||!x)return;const e=e=>{"Escape"===e.key&&s()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,x,s]),(0,l.useEffect)(()=>(document.body.style.overflow=t?"hidden":"unset",()=>{document.body.style.overflow="unset"}),[t]);return(0,h.jsx)(p.N,{children:t&&(0,h.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:[(0,h.jsx)(n.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"absolute inset-0 bg-black bg-opacity-75 backdrop-blur-sm",onClick:d?s:void 0}),(0,h.jsxs)(n.P.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2,ease:"easeOut"},className:"relative w-full ".concat({sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl",full:"max-w-full mx-4"}[i]," bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl border border-white border-opacity-10 max-h-[90vh] flex flex-col"),children:[(0,h.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-white border-opacity-10",children:[(0,h.jsx)("h2",{id:"modal-title",className:"text-2xl font-bold text-white",children:a}),o&&(0,h.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-white hover:bg-opacity-10","aria-label":"Close modal",children:(0,h.jsx)(c.QCr,{size:20})})]}),(0,h.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:r}),m&&(0,h.jsx)("div",{className:"p-6 border-t border-white border-opacity-10",children:m})]})]})})},g=e=>{let{isOpen:t,onClose:s,user:r,onSuccess:i}=e;const[n,o]=(0,l.useState)({email:(null===r||void 0===r?void 0:r.email)||"",tier:(null===r||void 0===r?void 0:r.tier)||"free",status:(null===r||void 0===r?void 0:r.status)||"active"}),[x,p]=(0,l.useState)(!1),[g,b]=(0,l.useState)(null),[y,j]=(0,l.useState)(!1),v=(e,t)=>{o(s=>(0,a.A)((0,a.A)({},s),{},{[e]:t})),b(null)},N=async e=>{if(e.preventDefault(),n.email&&n.email.includes("@")||(b("Please enter a valid email address"),0)){p(!0),b(null);try{await d.Kp.updateUser(r.id,n),j(!0),setTimeout(()=>{i(),s()},1e3)}catch(l){var t,a;b((null===(t=l.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||"Failed to update user")}finally{p(!1)}}},f=[{value:"free",label:"Free",icon:c.x$1,color:"gray"},{value:"paid",label:"Premium",icon:c.Hu1,color:"purple"},{value:"admin",label:"Admin",icon:c.SMR,color:"yellow"}],w=[{value:"active",label:"Active",icon:c.A7C,color:"green"},{value:"suspended",label:"Suspended",icon:c.Rqy,color:"red"},{value:"deleted",label:"Deleted",icon:c.Rqy,color:"gray"}];return(0,h.jsx)(u,{isOpen:t,onClose:s,title:"Edit User",size:"md",footer:(0,h.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,h.jsx)(m.A,{variant:"outline",onClick:s,disabled:x,children:"Cancel"}),(0,h.jsx)(m.A,{variant:"primary",onClick:N,loading:x,disabled:y,children:y?"Saved!":"Save Changes"})]}),children:(0,h.jsxs)("form",{onSubmit:N,className:"space-y-6",children:[g&&(0,h.jsx)("div",{className:"bg-red-500 bg-opacity-10 border border-red-500 rounded-lg p-4",children:(0,h.jsx)("p",{className:"text-red-400 text-sm",children:g})}),y&&(0,h.jsx)("div",{className:"bg-green-500 bg-opacity-10 border border-green-500 rounded-lg p-4",children:(0,h.jsxs)("p",{className:"text-green-400 text-sm flex items-center",children:[(0,h.jsx)(c.A7C,{className:"mr-2"}),"User updated successfully!"]})}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Email Address"}),(0,h.jsxs)("div",{className:"relative",children:[(0,h.jsx)("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:(0,h.jsx)(c.maD,{className:"text-gray-400"})}),(0,h.jsx)("input",{type:"email",value:n.email,onChange:e=>v("email",e.target.value),className:"w-full pl-12 pr-4 py-3 bg-white bg-opacity-5 border border-white border-opacity-10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition",placeholder:"user@example.com",required:!0})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-3",children:"User Tier"}),(0,h.jsx)("div",{className:"grid grid-cols-3 gap-3",children:f.map(e=>{const t=e.icon,s=n.tier===e.value;return(0,h.jsxs)("button",{type:"button",onClick:()=>v("tier",e.value),className:"p-4 rounded-lg border-2 transition-all ".concat(s?"border-".concat(e.color,"-500 bg-").concat(e.color,"-500 bg-opacity-10"):"border-white border-opacity-10 hover:border-opacity-30"),children:[(0,h.jsx)(t,{className:"mx-auto mb-2 text-2xl ".concat(s?"text-".concat(e.color,"-400"):"text-gray-400")}),(0,h.jsx)("p",{className:"text-sm font-semibold ".concat(s?"text-white":"text-gray-400"),children:e.label})]},e.value)})})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-3",children:"Account Status"}),(0,h.jsx)("div",{className:"grid grid-cols-3 gap-3",children:w.map(e=>{const t=e.icon,s=n.status===e.value;return(0,h.jsxs)("button",{type:"button",onClick:()=>v("status",e.value),className:"p-4 rounded-lg border-2 transition-all ".concat(s?"border-".concat(e.color,"-500 bg-").concat(e.color,"-500 bg-opacity-10"):"border-white border-opacity-10 hover:border-opacity-30"),children:[(0,h.jsx)(t,{className:"mx-auto mb-2 text-2xl ".concat(s?"text-".concat(e.color,"-400"):"text-gray-400")}),(0,h.jsx)("p",{className:"text-sm font-semibold ".concat(s?"text-white":"text-gray-400"),children:e.label})]},e.value)})})]}),(0,h.jsxs)("div",{className:"bg-white bg-opacity-5 rounded-lg p-4 space-y-2",children:[(0,h.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,h.jsx)("span",{className:"text-gray-400",children:"User ID:"}),(0,h.jsx)("span",{className:"text-white font-mono",children:null===r||void 0===r?void 0:r.id})]}),(0,h.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,h.jsx)("span",{className:"text-gray-400",children:"Created:"}),(0,h.jsx)("span",{className:"text-white",children:null!==r&&void 0!==r&&r.created_at?new Date(r.created_at).toLocaleDateString():"N/A"})]}),(0,h.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,h.jsx)("span",{className:"text-gray-400",children:"Last Login:"}),(0,h.jsx)("span",{className:"text-white",children:null!==r&&void 0!==r&&r.last_login?new Date(r.last_login).toLocaleDateString():"Never"})]})]})]})})},b=e=>{let{isOpen:t,onClose:s,server:r,onSuccess:i}=e;const n=!!r,[o,x]=(0,l.useState)("basic"),[p,g]=(0,l.useState)(!1),[b,y]=(0,l.useState)(!1),j={name:"",location:"",country_code:"",ip_address:"",capacity:250,status:"active",protocols:["shadowsocks","trojan","v2ray","hysteria"],ss_port:8388,ss_api_port:8389,trojan_api_port:10443,v2ray_api_port:9443,xray_api_port:0,ssh_host:"",ssh_port:22,ssh_user:"root",ssh_private_key:"",ssh_password:"",wireguard_public_key:"",v2ray_uuid:"",reality_server_name:"",reality_public_key:"",reality_short_id:"",bandwidth_limit:0},[v,N]=(0,l.useState)(j),[f,w]=(0,l.useState)(!1),[_,k]=(0,l.useState)(null),[C,A]=(0,l.useState)(!1);(0,l.useEffect)(()=>{N(r?{name:r.name||"",location:r.location||"",country_code:r.country_code||"",ip_address:r.ip_address||"",capacity:r.capacity||250,status:r.status||"active",protocols:r.protocols||["shadowsocks"],ss_port:r.ss_port||8388,ss_api_port:r.ss_api_port||8389,trojan_api_port:r.trojan_api_port||10443,v2ray_api_port:r.v2ray_api_port||9443,xray_api_port:r.xray_api_port||0,ssh_host:r.ssh_host||"",ssh_port:r.ssh_port||22,ssh_user:r.ssh_user||"root",ssh_private_key:"",ssh_password:"",wireguard_public_key:r.wireguard_public_key||"",v2ray_uuid:r.v2ray_uuid||"",reality_server_name:r.reality_server_name||"",reality_public_key:r.reality_public_key||"",reality_short_id:r.reality_short_id||"",bandwidth_limit:r.bandwidth_limit||0}:j),x("basic"),k(null),A(!1)},[r,t]);const S=(e,t)=>{N(s=>(0,a.A)((0,a.A)({},s),{},{[e]:t})),k(null)},D=()=>{return v.name.trim()?v.location.trim()?v.country_code.trim()&&2===v.country_code.length?(e=v.ip_address,/^(\d{1,3}\.){3}\d{1,3}$/.test(e)&&e.split(".").every(e=>parseInt(e)>=0&&parseInt(e)<=255)?v.capacity<1?k("Capacity must be at least 1")||!1:0!==v.protocols.length||(k("Select at least one protocol")||!1):k("Invalid IP address")||!1):k("Country code must be 2 characters")||!1:k("Location is required")||!1:k("Server name is required")||!1;var e},P=async e=>{if(null===e||void 0===e||e.preventDefault(),!D())return;w(!0),k(null);const t=(0,a.A)({},v);n&&(t.ssh_private_key||delete t.ssh_private_key,t.ssh_password||delete t.ssh_password);try{n?await d.Kp.updateServer(r.id,t):await d.Kp.addServer(t),A(!0),setTimeout(()=>{i(),s()},800)}catch(o){var l,c;k((null===(l=o.response)||void 0===l||null===(c=l.data)||void 0===c?void 0:c.error)||"Failed to ".concat(n?"update":"add"," server"))}finally{w(!1)}},T=[{id:"basic",label:"Basic",icon:c.vwk},{id:"protocols",label:"Protocols",icon:c.SMR},{id:"ssh",label:"SSH",icon:c.iuJ},{id:"advanced",label:"Advanced",icon:c.Pcn}],L="w-full px-4 py-2.5 bg-white bg-opacity-5 border border-white border-opacity-10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition text-sm",F="block text-sm font-semibold text-gray-300 mb-1.5";return(0,h.jsx)(u,{isOpen:t,onClose:s,title:n?"Edit: ".concat(null===r||void 0===r?void 0:r.name):"Add New Server",size:"xl",footer:(0,h.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,h.jsx)(m.A,{variant:"outline",onClick:s,disabled:f,children:"Cancel"}),(0,h.jsx)(m.A,{variant:"primary",onClick:P,loading:f,disabled:C,children:C?"Saved!":n?"Update Server":"Add Server"})]}),children:(0,h.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[_&&(0,h.jsx)("div",{className:"bg-red-500 bg-opacity-10 border border-red-500 rounded-lg p-3",children:(0,h.jsx)("p",{className:"text-red-400 text-sm",children:_})}),C&&(0,h.jsx)("div",{className:"bg-green-500 bg-opacity-10 border border-green-500 rounded-lg p-3",children:(0,h.jsxs)("p",{className:"text-green-400 text-sm flex items-center",children:[(0,h.jsx)(c.A7C,{className:"mr-2"}),"Server ",n?"updated":"added"," successfully!"]})}),(0,h.jsx)("div",{className:"flex gap-1 bg-black bg-opacity-20 p-1 rounded-lg",children:T.map(e=>(0,h.jsxs)("button",{type:"button",onClick:()=>x(e.id),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition ".concat(o===e.id?"bg-blue-600 text-white shadow":"text-gray-400 hover:text-white hover:bg-white hover:bg-opacity-5"),children:[(0,h.jsx)(e.icon,{className:"text-xs"}),e.label]},e.id))}),"basic"===o&&(0,h.jsx)("div",{className:"space-y-4",children:(0,h.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:F,children:"Server Name *"}),(0,h.jsx)("input",{type:"text",value:v.name,onChange:e=>S("name",e.target.value),className:L,placeholder:"Canada OVH",required:!0})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:F,children:"IP Address *"}),(0,h.jsx)("input",{type:"text",value:v.ip_address,onChange:e=>S("ip_address",e.target.value),className:"".concat(L," font-mono"),placeholder:"51.222.9.219",required:!0})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:F,children:"Location *"}),(0,h.jsx)("input",{type:"text",value:v.location,onChange:e=>S("location",e.target.value),className:L,placeholder:"Montreal, Canada",required:!0})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:F,children:"Country Code *"}),(0,h.jsx)("input",{type:"text",value:v.country_code,onChange:e=>S("country_code",e.target.value.toUpperCase()),className:"".concat(L," uppercase"),placeholder:"CA",maxLength:2,required:!0}),(0,h.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"ISO 3166 (US, CA, FR, DE...)"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:F,children:"Capacity (Max Users)"}),(0,h.jsx)("input",{type:"number",value:v.capacity,onChange:e=>S("capacity",parseInt(e.target.value)||0),className:L,min:"1",max:"10000"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:F,children:"Status"}),(0,h.jsxs)("select",{value:v.status,onChange:e=>S("status",e.target.value),className:L,children:[(0,h.jsx)("option",{value:"active",children:"Active"}),(0,h.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,h.jsx)("option",{value:"offline",children:"Offline"})]})]})]})}),"protocols"===o&&(0,h.jsxs)("div",{className:"space-y-5",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:F,children:"Enabled Protocols"}),(0,h.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:[{value:"shadowsocks",label:"Shadowsocks",color:"text-blue-400"},{value:"trojan",label:"Trojan",color:"text-purple-400"},{value:"v2ray",label:"V2Ray/VMess",color:"text-green-400"},{value:"vless",label:"VLESS+Reality",color:"text-cyan-400"},{value:"wireguard",label:"WireGuard",color:"text-yellow-400"},{value:"hysteria",label:"Hysteria",color:"text-orange-400"}].map(e=>{const t=v.protocols.includes(e.value);return(0,h.jsx)("button",{type:"button",onClick:()=>{return t=e.value,void N(e=>(0,a.A)((0,a.A)({},e),{},{protocols:e.protocols.includes(t)?e.protocols.filter(e=>e!==t):[...e.protocols,t]}));var t},className:"p-3 rounded-lg border-2 transition-all text-left ".concat(t?"border-blue-500 bg-blue-500 bg-opacity-10":"border-white border-opacity-10 hover:border-opacity-30"),children:(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(t?"bg-green-400":"bg-gray-600")}),(0,h.jsx)("span",{className:"text-sm font-semibold ".concat(t?e.color:"text-gray-500"),children:e.label})]})},e.value)})})]}),(0,h.jsxs)("div",{className:"border-t border-white border-opacity-10 pt-4",children:[(0,h.jsx)("label",{className:F,children:"Protocol Ports"}),(0,h.jsxs)("div",{className:"grid md:grid-cols-2 gap-3",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"text-xs text-gray-500",children:"Shadowsocks Port"}),(0,h.jsx)("input",{type:"number",value:v.ss_port,onChange:e=>S("ss_port",parseInt(e.target.value)||0),className:L})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"text-xs text-gray-500",children:"SS API Port"}),(0,h.jsx)("input",{type:"number",value:v.ss_api_port,onChange:e=>S("ss_api_port",parseInt(e.target.value)||0),className:L})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"text-xs text-gray-500",children:"Trojan API Port"}),(0,h.jsx)("input",{type:"number",value:v.trojan_api_port,onChange:e=>S("trojan_api_port",parseInt(e.target.value)||0),className:L})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"text-xs text-gray-500",children:"V2Ray API Port"}),(0,h.jsx)("input",{type:"number",value:v.v2ray_api_port,onChange:e=>S("v2ray_api_port",parseInt(e.target.value)||0),className:L})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"text-xs text-gray-500",children:"XRay API Port"}),(0,h.jsx)("input",{type:"number",value:v.xray_api_port,onChange:e=>S("xray_api_port",parseInt(e.target.value)||0),className:L})]})]})]})]}),"ssh"===o&&(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsx)("p",{className:"text-xs text-gray-500",children:"SSH credentials for remote server management. Used for health checks and configuration deployment."}),(0,h.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:F,children:"SSH Host"}),(0,h.jsx)("input",{type:"text",value:v.ssh_host,onChange:e=>S("ssh_host",e.target.value),className:"".concat(L," font-mono"),placeholder:"Same as IP if empty"}),(0,h.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty to use server IP"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:F,children:"SSH Port"}),(0,h.jsx)("input",{type:"number",value:v.ssh_port,onChange:e=>S("ssh_port",parseInt(e.target.value)||22),className:L})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:F,children:"SSH User"}),(0,h.jsx)("input",{type:"text",value:v.ssh_user,onChange:e=>S("ssh_user",e.target.value),className:L,placeholder:"root"})]})]}),(0,h.jsxs)("div",{className:"border-t border-white border-opacity-10 pt-4",children:[(0,h.jsxs)("label",{className:F,children:["SSH Private Key ",n&&(null===r||void 0===r?void 0:r.has_ssh_key)&&(0,h.jsx)("span",{className:"text-green-400 text-xs font-normal ml-2",children:"(key stored)"})]}),(0,h.jsx)("div",{className:"relative",children:(0,h.jsx)("textarea",{value:v.ssh_private_key,onChange:e=>S("ssh_private_key",e.target.value),className:"".concat(L," font-mono text-xs h-28 resize-none"),placeholder:n?"Leave empty to keep existing key":"-----BEGIN OPENSSH PRIVATE KEY-----\n...\n-----END OPENSSH PRIVATE KEY-----",style:{fontFamily:"monospace"}})})]}),(0,h.jsxs)("div",{children:[(0,h.jsxs)("label",{className:F,children:["SSH Password ",n&&(null===r||void 0===r?void 0:r.has_ssh_password)&&(0,h.jsx)("span",{className:"text-green-400 text-xs font-normal ml-2",children:"(password stored)"})]}),(0,h.jsxs)("div",{className:"relative",children:[(0,h.jsx)("input",{type:b?"text":"password",value:v.ssh_password,onChange:e=>S("ssh_password",e.target.value),className:"".concat(L," pr-10 font-mono"),placeholder:n?"Leave empty to keep existing":"Enter SSH password"}),(0,h.jsx)("button",{type:"button",onClick:()=>y(!b),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white",children:b?(0,h.jsx)(c.mx3,{}):(0,h.jsx)(c.Ny1,{})})]})]})]}),"advanced"===o&&(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{className:"border border-white border-opacity-10 rounded-lg p-4",children:[(0,h.jsxs)("h4",{className:"text-sm font-bold text-cyan-400 mb-3 flex items-center gap-2",children:[(0,h.jsx)(c.SMR,{})," VLESS + REALITY"]}),(0,h.jsxs)("div",{className:"grid md:grid-cols-2 gap-3",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"text-xs text-gray-500",children:"Server Name (SNI)"}),(0,h.jsx)("input",{type:"text",value:v.reality_server_name,onChange:e=>S("reality_server_name",e.target.value),className:L,placeholder:"www.google.com"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"text-xs text-gray-500",children:"Short ID"}),(0,h.jsx)("input",{type:"text",value:v.reality_short_id,onChange:e=>S("reality_short_id",e.target.value),className:"".concat(L," font-mono"),placeholder:"abcdef01"})]}),(0,h.jsxs)("div",{className:"md:col-span-2",children:[(0,h.jsx)("label",{className:"text-xs text-gray-500",children:"Public Key"}),(0,h.jsx)("input",{type:"text",value:v.reality_public_key,onChange:e=>S("reality_public_key",e.target.value),className:"".concat(L," font-mono text-xs"),placeholder:"Base64 public key..."})]})]})]}),(0,h.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,h.jsxs)("div",{className:"border border-white border-opacity-10 rounded-lg p-4",children:[(0,h.jsxs)("h4",{className:"text-sm font-bold text-yellow-400 mb-3 flex items-center gap-2",children:[(0,h.jsx)(c.pXu,{})," WireGuard"]}),(0,h.jsx)("label",{className:"text-xs text-gray-500",children:"Public Key"}),(0,h.jsx)("input",{type:"text",value:v.wireguard_public_key,onChange:e=>S("wireguard_public_key",e.target.value),className:"".concat(L," font-mono text-xs"),placeholder:"Base64 WG public key..."})]}),(0,h.jsxs)("div",{className:"border border-white border-opacity-10 rounded-lg p-4",children:[(0,h.jsxs)("h4",{className:"text-sm font-bold text-green-400 mb-3 flex items-center gap-2",children:[(0,h.jsx)(c.nVN,{})," V2Ray"]}),(0,h.jsx)("label",{className:"text-xs text-gray-500",children:"UUID"}),(0,h.jsx)("input",{type:"text",value:v.v2ray_uuid,onChange:e=>S("v2ray_uuid",e.target.value),className:"".concat(L," font-mono text-xs"),placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:F,children:"Bandwidth Limit (Mbps)"}),(0,h.jsx)("input",{type:"number",value:v.bandwidth_limit,onChange:e=>S("bandwidth_limit",parseInt(e.target.value)||0),className:L,min:"0"}),(0,h.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"0 = unlimited"})]})]})]})})},y=e=>{let{isOpen:t,onClose:s,onConfirm:a,title:r="Confirm Deletion",message:i,itemName:n,requireConfirmation:o=!0,confirmText:d="DELETE",type:x="user"}=e;const[p,g]=(0,l.useState)(""),[b,y]=(0,l.useState)(!1),[j,v]=(0,l.useState)(null),N=!o||p===d;return(0,h.jsx)(u,{isOpen:t,onClose:s,title:r,size:"md",footer:(0,h.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,h.jsx)(m.A,{variant:"outline",onClick:s,disabled:b,children:"Cancel"}),(0,h.jsx)(m.A,{variant:"danger",onClick:async()=>{if(N){y(!0),v(null);try{await a(),s()}catch(l){var e,t;v((null===(e=l.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Failed to delete")}finally{y(!1)}}},loading:b,disabled:!N,icon:(0,h.jsx)(c.qbC,{}),children:b?"Deleting...":"Delete"})]}),children:(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsx)("div",{className:"flex justify-center",children:(0,h.jsx)("div",{className:"w-16 h-16 rounded-full bg-red-500 bg-opacity-10 flex items-center justify-center",children:(0,h.jsx)(c.BS8,{className:"text-red-500 text-3xl"})})}),(0,h.jsxs)("div",{className:"text-center",children:[(0,h.jsxs)("p",{className:"text-white text-lg font-semibold mb-2",children:["Are you sure you want to delete this ",x,"?"]}),n&&(0,h.jsx)("p",{className:"text-gray-400 mb-4",children:(0,h.jsx)("span",{className:"font-mono bg-white bg-opacity-5 px-2 py-1 rounded",children:n})}),(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:(()=>{switch(x){case"user":return"This will permanently delete the user account and all associated data. This action cannot be undone.";case"server":return"This will permanently remove the server. Active connections will be terminated. This action cannot be undone.";case"connection":return"This will force disconnect the user from the VPN server.";default:return i||"This action cannot be undone."}})()})]}),j&&(0,h.jsx)("div",{className:"bg-red-500 bg-opacity-10 border border-red-500 rounded-lg p-4",children:(0,h.jsx)("p",{className:"text-red-400 text-sm",children:j})}),o&&(0,h.jsxs)("div",{children:[(0,h.jsxs)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:["Type ",(0,h.jsx)("span",{className:"font-mono text-red-400",children:d})," to confirm"]}),(0,h.jsx)("input",{type:"text",value:p,onChange:e=>g(e.target.value),className:"w-full px-4 py-3 bg-white bg-opacity-5 border border-white border-opacity-10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 transition font-mono",placeholder:d,autoFocus:!0})]}),(0,h.jsxs)("div",{className:"bg-yellow-500 bg-opacity-10 border border-yellow-500 rounded-lg p-4",children:[(0,h.jsx)("p",{className:"text-yellow-400 text-sm font-semibold mb-2",children:"\u26a0\ufe0f This action will:"}),(0,h.jsxs)("ul",{className:"text-yellow-400 text-sm space-y-1 list-disc list-inside",children:["user"===x&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("li",{children:"Delete all user data"}),(0,h.jsx)("li",{children:"Terminate active connections"}),(0,h.jsx)("li",{children:"Remove subscription information"}),(0,h.jsx)("li",{children:"Cannot be recovered"})]}),"server"===x&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("li",{children:"Remove server from network"}),(0,h.jsx)("li",{children:"Disconnect all active users"}),(0,h.jsx)("li",{children:"Delete server configuration"}),(0,h.jsx)("li",{children:"Cannot be recovered"})]}),"connection"===x&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("li",{children:"Immediately disconnect user"}),(0,h.jsx)("li",{children:"User will need to reconnect"})]})]})]})]})})};var j=s(182),v=s(3367);const N=()=>{const[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)([]),[i,o]=(0,l.useState)({totalRevenue:0,monthlyRevenue:0,activeSubscriptions:0,failedPayments:0}),[p,u]=(0,l.useState)(!0),[g,b]=(0,l.useState)("all"),[y,N]=(0,l.useState)(""),[f,w]=(0,l.useState)(null),{confirm:_,dialogProps:k}=(0,j.A)();(0,l.useEffect)(()=>{C();const e=setInterval(C,3e4);return()=>clearInterval(e)},[]);const C=async()=>{try{u(!0);try{const e=(await d.Kp.getAdminPaymentHistory()).data||[],s=e.reduce((e,t)=>"succeeded"===t.status?e+(t.amount||0):e,0),a=new Date,l=new Date(a.getFullYear(),a.getMonth(),1),r=e.filter(e=>new Date(e.created_at)>=l&&"succeeded"===e.status).reduce((e,t)=>e+(t.amount||0),0),i=e.filter(e=>"active"===e.status).length,n=e.filter(e=>"failed"===e.status).length;t(e),o({totalRevenue:s,monthlyRevenue:r,activeSubscriptions:i,failedPayments:n})}catch(e){console.error("Failed to load payment data:",e),t([]),o({totalRevenue:0,monthlyRevenue:0,activeSubscriptions:0,failedPayments:0})}try{const e=await d.Kp.getAdminSubscriptions();r(e.data||[])}catch(e){console.error("Failed to load subscriptions:",e),r([])}}catch(e){console.error("Failed to load payment data:",e)}finally{u(!1)}},A=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),S=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),D=e=>{if(!e)return(0,h.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-gray-500 text-white",children:"Unknown"});return(0,h.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold ".concat({succeeded:"bg-green-500 text-white",active:"bg-green-500 text-white",failed:"bg-red-500 text-white",canceled:"bg-gray-500 text-white",pending:"bg-yellow-500 text-white"}[e]||"bg-gray-500 text-white"),children:e.charAt(0).toUpperCase()+e.slice(1)})},P=e.filter(e=>{var t;const s="all"===g||e.status===g,a=null===(t=e.user_email)||void 0===t?void 0:t.toLowerCase().includes(y.toLowerCase());return s&&a});return p?(0,h.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,h.jsx)("div",{className:"text-white text-xl",children:"Loading payment data..."})}):(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,h.jsx)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:(0,h.jsx)(x.A,{className:"p-6 bg-gradient-to-br from-green-600 to-green-800",children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-green-200 text-sm",children:"Total Revenue"}),(0,h.jsx)("p",{className:"text-white text-3xl font-bold",children:A(i.totalRevenue)})]}),(0,h.jsx)(c.Tsk,{className:"text-green-200 text-4xl"})]})})}),(0,h.jsx)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:(0,h.jsx)(x.A,{className:"p-6 bg-gradient-to-br from-blue-600 to-blue-800",children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-blue-200 text-sm",children:"Monthly Revenue"}),(0,h.jsx)("p",{className:"text-white text-3xl font-bold",children:A(i.monthlyRevenue)})]}),(0,h.jsx)(c.x1c,{className:"text-blue-200 text-4xl"})]})})}),(0,h.jsx)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:(0,h.jsx)(x.A,{className:"p-6 bg-gradient-to-br from-purple-600 to-purple-800",children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-purple-200 text-sm",children:"Active Subscriptions"}),(0,h.jsx)("p",{className:"text-white text-3xl font-bold",children:i.activeSubscriptions})]}),(0,h.jsx)(c.A7C,{className:"text-purple-200 text-4xl"})]})})}),(0,h.jsx)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:(0,h.jsx)(x.A,{className:"p-6 bg-gradient-to-br from-red-600 to-red-800",children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-red-200 text-sm",children:"Failed Payments"}),(0,h.jsx)("p",{className:"text-white text-3xl font-bold",children:i.failedPayments})]}),(0,h.jsx)(c._Hm,{className:"text-red-200 text-4xl"})]})})})]}),(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,h.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Payment History"}),(0,h.jsx)(m.A,{variant:"outline",size:"sm",icon:(0,h.jsx)(c.WCW,{}),onClick:()=>{const e=[["Date","Email","Plan","Amount","Status","Payment ID"],...P.map(e=>[new Date(e.created_at).toISOString(),e.user_email,e.plan,e.amount,e.status,e.stripe_payment_id||""])].map(e=>e.map(e=>'"'.concat(String(e).replace(/"/g,'""'),'"')).join(",")).join("\n"),t=new Blob([e],{type:"text/csv"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="payments_".concat((new Date).toISOString().split("T")[0],".csv"),a.click(),URL.revokeObjectURL(s)},children:"Export CSV"})]}),(0,h.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,h.jsxs)("div",{className:"flex-1 relative",children:[(0,h.jsx)(c.KSO,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,h.jsx)("input",{type:"text",placeholder:"Search by email...",value:y,onChange:e=>N(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,h.jsxs)("select",{value:g,onChange:e=>b(e.target.value),className:"px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,h.jsx)("option",{value:"all",children:"All Payments"}),(0,h.jsx)("option",{value:"succeeded",children:"Succeeded"}),(0,h.jsx)("option",{value:"failed",children:"Failed"}),(0,h.jsx)("option",{value:"pending",children:"Pending"})]})]}),(0,h.jsx)("div",{className:"overflow-x-auto",children:(0,h.jsxs)("table",{className:"w-full",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-white border-opacity-20",children:[(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Date"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"User"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Plan"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Amount"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Status"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Payment ID"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Actions"})]})}),(0,h.jsx)("tbody",{children:0===P.length?(0,h.jsx)("tr",{children:(0,h.jsxs)("td",{colSpan:"7",className:"text-center py-12 text-gray-400",children:[(0,h.jsx)(c.x1c,{className:"text-6xl mx-auto mb-4 opacity-50"}),(0,h.jsx)("p",{children:"No payments found"}),(0,h.jsx)("p",{className:"text-sm mt-2",children:"Payments will appear here once users subscribe"})]})}):P.map(e=>(0,h.jsxs)("tr",{className:"border-b border-white border-opacity-10 hover:bg-white hover:bg-opacity-5",children:[(0,h.jsx)("td",{className:"py-3 px-4 text-gray-300",children:S(e.created_at)}),(0,h.jsx)("td",{className:"py-3 px-4 text-white",children:e.user_email}),(0,h.jsx)("td",{className:"py-3 px-4 text-gray-300",children:e.plan}),(0,h.jsx)("td",{className:"py-3 px-4 text-white font-semibold",children:A(e.amount)}),(0,h.jsx)("td",{className:"py-3 px-4",children:D(e.status)}),(0,h.jsx)("td",{className:"py-3 px-4 text-gray-300 font-mono text-sm",children:e.stripe_payment_id}),(0,h.jsxs)("td",{className:"py-3 px-4",children:[(0,h.jsx)("button",{className:"text-blue-400 hover:text-blue-300 mr-3",onClick:()=>w((null===f||void 0===f?void 0:f.id)===e.id?null:e),children:"View"}),e.stripe_payment_id&&(0,h.jsx)("a",{href:"https://dashboard.stripe.com/payments/".concat(e.stripe_payment_id),target:"_blank",rel:"noopener noreferrer",className:"text-green-400 hover:text-green-300",children:"Invoice"})]})]},e.id))})]})})]}),f&&(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,h.jsx)("h3",{className:"text-xl font-bold text-white",children:"Payment Details"}),(0,h.jsx)("button",{onClick:()=>w(null),className:"text-gray-400 hover:text-white text-xl",children:"\xd7"})]}),(0,h.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:"ID"}),(0,h.jsx)("p",{className:"text-white",children:f.id})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:"User"}),(0,h.jsx)("p",{className:"text-white",children:f.user_email})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:"Plan"}),(0,h.jsx)("p",{className:"text-white",children:f.plan})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:"Amount"}),(0,h.jsx)("p",{className:"text-white font-bold",children:A(f.amount)})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:"Status"}),(0,h.jsx)("p",{children:D(f.status)})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:"Date"}),(0,h.jsx)("p",{className:"text-white",children:S(f.created_at)})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:"Stripe ID"}),(0,h.jsx)("p",{className:"text-white font-mono text-xs",children:f.stripe_payment_id||"N/A"})]})]})]}),(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsx)("h2",{className:"text-2xl font-bold text-white mb-6",children:"Active Subscriptions"}),(0,h.jsx)("div",{className:"overflow-x-auto",children:(0,h.jsxs)("table",{className:"w-full",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-white border-opacity-20",children:[(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"User"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Plan"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Amount"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Status"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Next Billing"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Actions"})]})}),(0,h.jsx)("tbody",{children:0===s.length?(0,h.jsx)("tr",{children:(0,h.jsxs)("td",{colSpan:"6",className:"text-center py-12 text-gray-400",children:[(0,h.jsx)(c.A7C,{className:"text-6xl mx-auto mb-4 opacity-50"}),(0,h.jsx)("p",{children:"No active subscriptions"}),(0,h.jsx)("p",{className:"text-sm mt-2",children:"Active subscriptions will appear here"})]})}):s.map(e=>(0,h.jsxs)("tr",{className:"border-b border-white border-opacity-10 hover:bg-white hover:bg-opacity-5",children:[(0,h.jsx)("td",{className:"py-3 px-4 text-white",children:e.user_email}),(0,h.jsx)("td",{className:"py-3 px-4 text-gray-300",children:e.plan}),(0,h.jsx)("td",{className:"py-3 px-4 text-white font-semibold",children:A(e.amount)}),(0,h.jsx)("td",{className:"py-3 px-4",children:D(e.status)}),(0,h.jsx)("td",{className:"py-3 px-4 text-gray-300",children:S(e.current_period_end)}),(0,h.jsxs)("td",{className:"py-3 px-4",children:[(0,h.jsx)("a",{href:e.stripe_subscription_id?"https://dashboard.stripe.com/subscriptions/".concat(e.stripe_subscription_id):"#",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 mr-3",children:"Manage"}),(0,h.jsx)("button",{className:"text-red-400 hover:text-red-300",onClick:()=>(async e=>{if(await _({title:"Cancel Subscription",message:"Are you sure you want to cancel this subscription?",confirmText:"Cancel Subscription",variant:"danger"}))try{await d.Kp.cancelAdminSubscription(e),C()}catch(t){console.error("Cancel failed:",t),alert("Failed to cancel subscription")}})(e.id),children:"Cancel"})]})]},e.id))})]})})]}),(0,h.jsx)(v.A,(0,a.A)({},k))]})},f=()=>{var e,t,s,r;const[i,n]=(0,l.useState)(null),[o,p]=(0,l.useState)(!0),[u,g]=(0,l.useState)(!1),[b,y]=(0,l.useState)(!1),[N,f]=(0,l.useState)(!1),[w,_]=(0,l.useState)({type:"",text:""}),[k,C]=(0,l.useState)(""),[A,S]=(0,l.useState)(!0),[D,P]=(0,l.useState)(null),[T,L]=(0,l.useState)(null),{confirm:F,dialogProps:R}=(0,j.A)(),E=(e,t)=>{_({type:e,text:t}),setTimeout(()=>_({type:"",text:""}),5e3)};(0,l.useEffect)(()=>{U()},[]);const U=async()=>{try{p(!0);const e=(await d.Kp.getSubscriptionSettings()).data;n(e),C(e.reminder_days.join(", ")),S(!1!==e.reminder_enabled)}catch(e){console.error("Failed to load subscription settings:",e),E("error","Failed to load subscription settings")}finally{p(!1)}};return o?(0,h.jsxs)("div",{className:"text-gray-400 text-center py-10",children:[(0,h.jsx)(c.hW,{className:"animate-spin inline mr-2"}),"Loading subscription settings..."]}):(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("h3",{className:"text-2xl font-bold text-white mb-4 flex items-center gap-2",children:[(0,h.jsx)(c.YXz,{className:"text-blue-400"})," Subscription Overview"]}),(null===i||void 0===i?void 0:i.stats)&&(0,h.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,h.jsxs)("div",{className:"bg-blue-900 bg-opacity-30 border border-blue-700 rounded-lg p-4 text-center",children:[(0,h.jsx)("div",{className:"text-3xl font-bold text-blue-300",children:i.stats.paid_users}),(0,h.jsx)("div",{className:"text-gray-400 text-sm mt-1",children:"Paid Users"})]}),(0,h.jsxs)("div",{className:"bg-green-900 bg-opacity-30 border border-green-700 rounded-lg p-4 text-center",children:[(0,h.jsx)("div",{className:"text-3xl font-bold text-green-300",children:i.stats.auto_renew_on}),(0,h.jsx)("div",{className:"text-gray-400 text-sm mt-1",children:"Auto-Renew ON"})]}),(0,h.jsxs)("div",{className:"bg-yellow-900 bg-opacity-30 border border-yellow-700 rounded-lg p-4 text-center",children:[(0,h.jsx)("div",{className:"text-3xl font-bold text-yellow-300",children:i.stats.auto_renew_off}),(0,h.jsx)("div",{className:"text-gray-400 text-sm mt-1",children:"Auto-Renew OFF"})]}),(0,h.jsxs)("div",{className:"bg-red-900 bg-opacity-30 border border-red-700 rounded-lg p-4 text-center",children:[(0,h.jsx)("div",{className:"text-3xl font-bold text-red-300",children:i.stats.expired_pending}),(0,h.jsx)("div",{className:"text-gray-400 text-sm mt-1",children:"Expired Pending"})]})]}),(null===i||void 0===i?void 0:i.stats)&&(0,h.jsxs)("div",{className:"flex gap-4 mt-4 text-sm",children:[(0,h.jsxs)("span",{className:"text-yellow-300",children:["Expiring 7d: ",(0,h.jsx)("strong",{children:i.stats.expiring_7d})]}),(0,h.jsxs)("span",{className:"text-orange-300",children:["Expiring 3d: ",(0,h.jsx)("strong",{children:i.stats.expiring_3d})]}),(0,h.jsxs)("span",{className:"text-red-300",children:["Expiring 1d: ",(0,h.jsx)("strong",{children:i.stats.expiring_1d})]})]})]}),(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-6 flex-wrap gap-3",children:[(0,h.jsxs)("h3",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[(0,h.jsx)(c.jNV,{className:"text-yellow-400"})," Expiry Reminder Settings"]}),w.text&&(0,h.jsx)("div",{className:"px-4 py-2 rounded-lg text-sm text-white ".concat("success"===w.type?"bg-green-600":"bg-red-600"),children:w.text})]}),(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between bg-white bg-opacity-5 rounded-lg p-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-white font-medium",children:"Enable Expiry Reminders"}),(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:"Send email reminders to users before subscription expires"})]}),(0,h.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,h.jsx)("input",{type:"checkbox",checked:A,onChange:e=>S(e.target.checked),className:"sr-only peer"}),(0,h.jsx)("div",{className:"w-11 h-6 bg-gray-600 peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsxs)("label",{className:"block text-gray-300 mb-2 flex items-center gap-2",children:[(0,h.jsx)(c.bfZ,{className:"text-blue-400"})," Reminder Days Before Expiry"]}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsx)("input",{type:"text",value:k,onChange:e=>C(e.target.value),placeholder:"7, 3, 1",className:"px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 flex-1"}),(0,h.jsxs)(m.A,{variant:"primary",onClick:async()=>{try{g(!0);const e=k.split(",").map(e=>parseInt(e.trim(),10)).filter(e=>!isNaN(e)&&e>0);if(0===e.length)return void E("error","Enter at least one valid reminder day");await d.Kp.updateSubscriptionSettings({reminder_days:e,reminder_enabled:A}),E("success","Settings saved \u2014 will take effect on next cron run"),await U()}catch(s){var e,t;E("error",(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Failed to save settings")}finally{g(!1)}},disabled:u,children:[u?(0,h.jsx)(c.hW,{className:"animate-spin mr-1"}):(0,h.jsx)(c.jNV,{className:"mr-1"}),"Save"]})]}),(0,h.jsxs)("p",{className:"text-gray-500 text-xs mt-1",children:["Comma-separated days (e.g., ",(0,h.jsx)("code",{className:"text-gray-300",children:"14, 7, 3, 1"}),"). Users receive ONE email per threshold, never duplicates."]})]}),(0,h.jsxs)("div",{className:"bg-blue-900 bg-opacity-20 border border-blue-700 rounded-lg p-4",children:[(0,h.jsxs)("p",{className:"text-blue-200 text-sm",children:[(0,h.jsx)("strong",{children:"Schedule:"})," ",(null===i||void 0===i?void 0:i.cron_schedule)||"Daily at midnight UTC"]}),(0,h.jsxs)("p",{className:"text-blue-200 text-sm mt-1",children:[(0,h.jsx)("strong",{children:"Current reminders:"})," ",(null===i||void 0===i||null===(e=i.reminder_days)||void 0===e?void 0:e.map(e=>"".concat(e," day").concat(e>1?"s":"")).join(" \u2192 "))||"Not configured"]}),(0,h.jsx)("p",{className:"text-gray-400 text-xs mt-2",children:"Deduplication is built-in \u2014 each user receives at most one email per reminder threshold per subscription period. Auto-renew users whose Stripe renewal succeeds will NOT be downgraded."})]}),(0,h.jsxs)("div",{className:"border-t border-white border-opacity-10 pt-5",children:[(0,h.jsx)("h4",{className:"text-white font-bold mb-3",children:"Manual Actions"}),(0,h.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,h.jsxs)(m.A,{variant:"secondary",onClick:async()=>{try{y(!0),P(null);const e=await d.Kp.testReminders(!0);P(e.data),E("success","Dry run complete: ".concat(e.data.would_send," emails would be sent"))}catch(s){var e,t;E("error",(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Dry run failed")}finally{y(!1)}},disabled:b,className:"!bg-purple-700 hover:!bg-purple-600",children:[b?(0,h.jsx)(c.hW,{className:"animate-spin mr-1"}):(0,h.jsx)(c.gSK,{className:"mr-1"}),"Dry Run (Preview)"]}),(0,h.jsxs)(m.A,{variant:"primary",onClick:async()=>{if(await F({title:"Send Live Emails",message:"This will send real emails to users with expiring subscriptions. Continue?",confirmText:"Send Now",variant:"warning"}))try{y(!0);const e=await d.Kp.testReminders(!1);P(null),E("success","Live run complete: ".concat(e.data.sent," emails sent, ").concat(e.data.skipped," skipped")),await U()}catch(s){var e,t;E("error",(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Live run failed")}finally{y(!1)}},disabled:b,children:[b?(0,h.jsx)(c.hW,{className:"animate-spin mr-1"}):(0,h.jsx)(c.Cer,{className:"mr-1"}),"Send Now (Live)"]}),(0,h.jsxs)(m.A,{variant:"secondary",onClick:async()=>{if(await F({title:"Reset Dedup Tracking",message:"Reset dedup tracking for all users? This will allow re-sending all reminders.",confirmText:"Reset",variant:"danger"}))try{f(!0);const e=await d.Kp.resetReminderDedup();E("success",e.data.message),await U()}catch(s){var e,t;E("error",(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Reset failed")}finally{f(!1)}},disabled:N,className:"!bg-orange-700 hover:!bg-orange-600",children:[N?(0,h.jsx)(c.hW,{className:"animate-spin mr-1"}):(0,h.jsx)(c.Swo,{className:"mr-1"}),"Reset Dedup Tracking"]}),(0,h.jsxs)(m.A,{variant:"secondary",onClick:async()=>{try{const e=await d.Kp.getExpiringUsers(30);L(e.data)}catch(e){E("error","Failed to load expiring users")}},className:"!bg-gray-700 hover:!bg-gray-600",children:[(0,h.jsx)(c.YXz,{className:"mr-1"})," View Expiring Users"]})]})]}),D&&(0,h.jsxs)("div",{className:"bg-purple-900 bg-opacity-20 border border-purple-600 rounded-lg p-4",children:[(0,h.jsx)("h4",{className:"text-purple-200 font-bold mb-2",children:"Dry Run Results"}),(0,h.jsxs)("div",{className:"flex gap-4 mb-3 text-sm",children:[(0,h.jsxs)("span",{className:"text-green-300",children:["Would Send: ",(0,h.jsx)("strong",{children:D.would_send})]}),(0,h.jsxs)("span",{className:"text-gray-400",children:["Would Skip: ",(0,h.jsx)("strong",{children:D.would_skip})]}),(0,h.jsxs)("span",{className:"text-blue-300",children:["Reminder Days: ",(0,h.jsx)("strong",{children:null===(t=D.reminder_days)||void 0===t?void 0:t.join(", ")})]})]}),(null===(s=D.details)||void 0===s?void 0:s.length)>0&&(0,h.jsx)("div",{className:"max-h-60 overflow-y-auto",children:(0,h.jsxs)("table",{className:"w-full text-sm",children:[(0,h.jsx)("thead",{className:"text-gray-400",children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{className:"text-left py-1 px-2",children:"Email"}),(0,h.jsx)("th",{className:"text-center py-1 px-2",children:"Days Left"}),(0,h.jsx)("th",{className:"text-center py-1 px-2",children:"Reminder"}),(0,h.jsx)("th",{className:"text-center py-1 px-2",children:"Last Sent"}),(0,h.jsx)("th",{className:"text-center py-1 px-2",children:"Status"})]})}),(0,h.jsx)("tbody",{className:"text-gray-300",children:D.details.map((e,t)=>{var s;return(0,h.jsxs)("tr",{className:"border-t border-white border-opacity-5",children:[(0,h.jsx)("td",{className:"py-1 px-2",children:e.email}),(0,h.jsx)("td",{className:"text-center py-1 px-2",children:e.days_until_expiry}),(0,h.jsxs)("td",{className:"text-center py-1 px-2",children:[e.matched_reminder_day,"d"]}),(0,h.jsx)("td",{className:"text-center py-1 px-2",children:null!==(s=e.last_reminder_sent)&&void 0!==s?s:"\u2014"}),(0,h.jsx)("td",{className:"text-center py-1 px-2",children:e.would_send?(0,h.jsx)(c.A7C,{className:"inline text-green-400",title:"Will send"}):(0,h.jsx)(c._Hm,{className:"inline text-gray-500",title:"Skipped (already sent)"})})]},t)})})]})})]}),T&&(0,h.jsxs)("div",{className:"bg-yellow-900 bg-opacity-20 border border-yellow-600 rounded-lg p-4",children:[(0,h.jsxs)("h4",{className:"text-yellow-200 font-bold mb-2",children:["Expiring Users (",T.total," within ",T.days_window," days)"]}),0===T.users.length?(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:"No users with expiring subscriptions."}):(0,h.jsx)("div",{className:"max-h-60 overflow-y-auto",children:(0,h.jsxs)("table",{className:"w-full text-sm",children:[(0,h.jsx)("thead",{className:"text-gray-400",children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{className:"text-left py-1 px-2",children:"Email"}),(0,h.jsx)("th",{className:"text-center py-1 px-2",children:"Plan"}),(0,h.jsx)("th",{className:"text-center py-1 px-2",children:"Expires"}),(0,h.jsx)("th",{className:"text-center py-1 px-2",children:"Days Left"}),(0,h.jsx)("th",{className:"text-center py-1 px-2",children:"Auto-Renew"}),(0,h.jsx)("th",{className:"text-center py-1 px-2",children:"Last Reminder"})]})}),(0,h.jsx)("tbody",{className:"text-gray-300",children:T.users.map((e,t)=>{var s;return(0,h.jsxs)("tr",{className:"border-t border-white border-opacity-5",children:[(0,h.jsx)("td",{className:"py-1 px-2",children:e.email}),(0,h.jsx)("td",{className:"text-center py-1 px-2",children:e.plan_type||"\u2014"}),(0,h.jsx)("td",{className:"text-center py-1 px-2",children:e.subscription_end_date?new Date(e.subscription_end_date).toLocaleDateString():"\u2014"}),(0,h.jsx)("td",{className:"text-center py-1 px-2",children:(0,h.jsx)("span",{className:e.days_until_expiry<=1?"text-red-400 font-bold":e.days_until_expiry<=3?"text-orange-400":"text-yellow-300",children:e.days_until_expiry})}),(0,h.jsx)("td",{className:"text-center py-1 px-2",children:e.auto_renew?(0,h.jsx)("span",{className:"text-green-400",children:"ON"}):(0,h.jsx)("span",{className:"text-red-400",children:"OFF"})}),(0,h.jsx)("td",{className:"text-center py-1 px-2",children:null!==(s=e.last_expiry_reminder_days)&&void 0!==s?s:"\u2014"})]},t)})})]})})]}),(null===i||void 0===i||null===(r=i.recent_logs)||void 0===r?void 0:r.length)>0&&(0,h.jsxs)("div",{className:"border-t border-white border-opacity-10 pt-5",children:[(0,h.jsx)("h4",{className:"text-white font-bold mb-3",children:"Recent Activity"}),(0,h.jsx)("div",{className:"max-h-48 overflow-y-auto",children:i.recent_logs.map((e,t)=>{var s;return(0,h.jsxs)("div",{className:"flex items-center gap-3 py-2 border-b border-white border-opacity-5 text-sm",children:[(0,h.jsx)("span",{className:"px-2 py-0.5 rounded text-xs font-mono ".concat("payment_failed"===e.action?"bg-red-800 text-red-200":"subscription_expired"===e.action?"bg-orange-800 text-orange-200":"bg-blue-800 text-blue-200"),children:e.action}),(0,h.jsx)("span",{className:"text-gray-400",children:new Date(e.created_at).toLocaleString()}),(0,h.jsx)("span",{className:"text-gray-500 text-xs truncate",children:null===(s=JSON.stringify(e.details))||void 0===s?void 0:s.slice(0,80)})]},t)})})]})]})]}),(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[(0,h.jsx)(c.KP4,{className:"text-green-400"})," How Auto-Renewal Works"]}),(0,h.jsxs)("div",{className:"space-y-3 text-gray-300 text-sm",children:[(0,h.jsx)("div",{className:"bg-green-900 bg-opacity-20 border border-green-700 rounded-lg p-4",children:(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{className:"text-green-300",children:"Auto-Renewal = ON:"})," Stripe automatically charges the user at the end of their billing period. No action needed \u2014 the user's subscription renews seamlessly."]})}),(0,h.jsx)("div",{className:"bg-yellow-900 bg-opacity-20 border border-yellow-700 rounded-lg p-4",children:(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{className:"text-yellow-300",children:"Auto-Renewal = OFF:"}),' When the subscription end date passes, the daily cron downgrades the user to free tier and sends a "subscription expired" email. Reminder emails are sent at the configured intervals before this happens.']})}),(0,h.jsx)("div",{className:"bg-red-900 bg-opacity-20 border border-red-700 rounded-lg p-4",children:(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{className:"text-red-300",children:"Payment Failed:"}),' If Stripe cannot charge the renewal, a "payment failed" email is sent automatically via webhook. The user keeps access until Stripe exhausts retry attempts, then the subscription is cancelled.']})}),(0,h.jsx)("div",{className:"bg-blue-900 bg-opacity-20 border border-blue-700 rounded-lg p-4",children:(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{className:"text-blue-300",children:"Deduplication:"}),' Each user receives only one email per reminder threshold per subscription period (e.g., one "7 days left" email, one "3 days left" email). The tracker resets when a subscription expires or renews.']})})]})]}),(0,h.jsx)(v.A,(0,a.A)({},R))]})},w=()=>{const[e,t]=(0,l.useState)({provider:"postal",postal_api_url:"",postal_api_key:"",smtp_host:"",smtp_port:587,smtp_secure:!1,smtp_user:"",smtp_password:"",from_name:"",from_email:""}),[s,r]=(0,l.useState)(!0),[i,n]=(0,l.useState)(!1),[o,p]=(0,l.useState)(!1),[u,g]=(0,l.useState)(""),[b,y]=(0,l.useState)({type:"",text:""}),j=(e,t)=>{y({type:e,text:t}),setTimeout(()=>y({type:"",text:""}),5e3)};(0,l.useEffect)(()=>{(async()=>{try{r(!0);const e=(await d.Kp.getEmailConfig()).data;t({provider:e.provider||"postal",postal_api_url:e.postal_api_url||"",postal_api_key:e.has_postal_key?e.postal_api_key:"",smtp_host:e.smtp_host||"",smtp_port:e.smtp_port||587,smtp_secure:e.smtp_secure||!1,smtp_user:e.smtp_user||"",smtp_password:e.has_smtp_password?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"",from_name:e.from_name||"",from_email:e.from_email||""})}catch(e){console.error("Failed to load email config:",e),j("error","Failed to load email settings")}finally{r(!1)}})()},[]);const v="flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500";return s?(0,h.jsxs)("div",{className:"text-gray-400 text-center py-10",children:[(0,h.jsx)(c.hW,{className:"animate-spin inline mr-2"}),"Loading email settings..."]}):(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-6 flex-wrap gap-3",children:[(0,h.jsx)("h3",{className:"text-2xl font-bold text-white",children:"Email Configuration"}),b.text&&(0,h.jsx)("div",{className:"px-4 py-2 rounded-lg text-sm text-white ".concat("success"===b.type?"bg-green-600":"bg-red-600"),children:b.text})]}),(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"bg-gradient-to-r from-blue-900 to-purple-900 bg-opacity-40 border border-blue-500 rounded-lg p-5",children:[(0,h.jsx)("label",{className:"block text-white font-bold mb-3 text-lg",children:"Email Provider"}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,h.jsxs)("button",{onClick:()=>t(e=>(0,a.A)((0,a.A)({},e),{},{provider:"postal"})),className:"relative p-4 rounded-xl border-2 transition-all text-left ".concat("postal"===e.provider?"border-blue-400 bg-blue-600 bg-opacity-30 shadow-lg shadow-blue-500/20":"border-gray-600 bg-white bg-opacity-5 hover:border-gray-400"),children:["postal"===e.provider&&(0,h.jsx)("span",{className:"absolute top-2 right-2 w-3 h-3 bg-blue-400 rounded-full animate-pulse"}),(0,h.jsx)("div",{className:"text-white font-bold text-lg mb-1",children:"Postal API"}),(0,h.jsx)("p",{className:"text-gray-300 text-sm",children:"Direct HTTP API to your Postal mail server. No SMTP relay needed. Fast and reliable."}),(0,h.jsx)("div",{className:"mt-2 text-xs text-blue-300",children:"mail.oioxo.com"})]}),(0,h.jsxs)("button",{onClick:()=>t(e=>(0,a.A)((0,a.A)({},e),{},{provider:"smtp"})),className:"relative p-4 rounded-xl border-2 transition-all text-left ".concat("smtp"===e.provider?"border-green-400 bg-green-600 bg-opacity-30 shadow-lg shadow-green-500/20":"border-gray-600 bg-white bg-opacity-5 hover:border-gray-400"),children:["smtp"===e.provider&&(0,h.jsx)("span",{className:"absolute top-2 right-2 w-3 h-3 bg-green-400 rounded-full animate-pulse"}),(0,h.jsx)("div",{className:"text-white font-bold text-lg mb-1",children:"SMTP Relay"}),(0,h.jsx)("p",{className:"text-gray-300 text-sm",children:"Traditional SMTP server (Gmail, SendPulse, Mailgun, etc). Uses nodemailer."}),(0,h.jsx)("div",{className:"mt-2 text-xs text-green-300",children:"Any SMTP provider"})]})]})]}),"postal"===e.provider&&(0,h.jsxs)("div",{className:"space-y-4 border border-blue-700 rounded-lg p-5 bg-blue-900 bg-opacity-20",children:[(0,h.jsxs)("h4",{className:"text-white font-bold flex items-center gap-2",children:[(0,h.jsx)(c.vwk,{className:"text-blue-400"})," Postal API Settings"]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"API URL"}),(0,h.jsx)("input",{type:"text",value:e.postal_api_url,onChange:e=>t(t=>(0,a.A)((0,a.A)({},t),{},{postal_api_url:e.target.value})),placeholder:"http://mail.oioxo.com:5000",className:v+" w-full"}),(0,h.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"Base URL of your Postal server (without /api/v1)"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Server API Key"}),(0,h.jsx)("input",{type:"password",value:e.postal_api_key,onChange:e=>t(t=>(0,a.A)((0,a.A)({},t),{},{postal_api_key:e.target.value})),placeholder:"Enter Postal API key",className:v+" w-full"}),(0,h.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"Found in Postal admin \u2192 Credentials \u2192 Server API Keys"})]})]}),"smtp"===e.provider&&(0,h.jsxs)("div",{className:"space-y-4 border border-green-700 rounded-lg p-5 bg-green-900 bg-opacity-20",children:[(0,h.jsxs)("h4",{className:"text-white font-bold flex items-center gap-2",children:[(0,h.jsx)(c.maD,{className:"text-green-400"})," SMTP Server Settings"]}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,h.jsxs)("div",{className:"md:col-span-2",children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"SMTP Host"}),(0,h.jsx)("input",{type:"text",value:e.smtp_host,onChange:e=>t(t=>(0,a.A)((0,a.A)({},t),{},{smtp_host:e.target.value})),placeholder:"smtp.gmail.com",className:v+" w-full"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Port"}),(0,h.jsx)("input",{type:"number",value:e.smtp_port,onChange:e=>t(t=>(0,a.A)((0,a.A)({},t),{},{smtp_port:parseInt(e.target.value)||587})),className:v+" w-full"})]})]}),(0,h.jsxs)("div",{className:"flex items-center gap-4",children:[(0,h.jsx)("label",{className:"text-gray-300",children:"Use SSL/TLS"}),(0,h.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,h.jsx)("input",{type:"checkbox",checked:e.smtp_secure,onChange:e=>t(t=>(0,a.A)((0,a.A)({},t),{},{smtp_secure:e.target.checked})),className:"sr-only peer"}),(0,h.jsx)("div",{className:"w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]}),(0,h.jsx)("span",{className:"text-gray-500 text-sm",children:"Enable for port 465, disable for port 587 (STARTTLS)"})]}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Username / Email"}),(0,h.jsx)("input",{type:"text",value:e.smtp_user,onChange:e=>t(t=>(0,a.A)((0,a.A)({},t),{},{smtp_user:e.target.value})),placeholder:"you@domain.com",className:v+" w-full"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Password / App Password"}),(0,h.jsx)("input",{type:"password",value:e.smtp_password,onChange:e=>t(t=>(0,a.A)((0,a.A)({},t),{},{smtp_password:e.target.value})),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",className:v+" w-full"})]})]})]}),(0,h.jsxs)("div",{className:"border border-gray-700 rounded-lg p-5 bg-white bg-opacity-5",children:[(0,h.jsx)("h4",{className:"text-white font-bold mb-4",children:"Sender Identity"}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"From Name"}),(0,h.jsx)("input",{type:"text",value:e.from_name,onChange:e=>t(t=>(0,a.A)((0,a.A)({},t),{},{from_name:e.target.value})),placeholder:"VPN XO",className:v+" w-full"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"From Email"}),(0,h.jsx)("input",{type:"email",value:e.from_email,onChange:e=>t(t=>(0,a.A)((0,a.A)({},t),{},{from_email:e.target.value})),placeholder:"noreply@vpn-xo.com",className:v+" w-full"})]})]})]}),(0,h.jsx)("div",{className:"flex justify-end",children:(0,h.jsxs)(m.A,{variant:"primary",onClick:async()=>{try{n(!0),await d.Kp.updateEmailConfig(e),j("success","Email settings saved successfully")}catch(a){var t,s;j("error",(null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||"Failed to save email settings")}finally{n(!1)}},disabled:i,children:[i?(0,h.jsx)(c.hW,{className:"animate-spin mr-1"}):(0,h.jsx)(c.maD,{className:"mr-1"}),"Save Email Settings"]})}),(0,h.jsxs)("div",{className:"border-t border-white border-opacity-10 pt-5",children:[(0,h.jsxs)("h4",{className:"text-white font-bold mb-3",children:[(0,h.jsx)(c.Cer,{className:"inline mr-2"}),"Test Email (","postal"===e.provider?"Postal API":"SMTP",")"]}),(0,h.jsxs)("div",{className:"flex gap-3",children:[(0,h.jsx)("input",{type:"email",value:u,onChange:e=>g(e.target.value),placeholder:"test@example.com",className:v}),(0,h.jsx)(m.A,{variant:"primary",onClick:async()=>{if(u)try{var e;p(!0);const t="postal"===(null===(e=(await d.Kp.testEmailConfig(u)).data)||void 0===e?void 0:e.provider)?"Postal":"SMTP";j("success","Test email sent via ".concat(t," to ").concat(u))}catch(a){var t,s;j("error",(null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||"Email test failed")}finally{p(!1)}else j("error","Enter a test email address")},disabled:o||!u,children:o?(0,h.jsx)(c.hW,{className:"animate-spin"}):"Send Test"})]}),(0,h.jsxs)("p",{className:"text-gray-500 text-xs mt-1",children:["Sends a test email using the ",(0,h.jsx)("strong",{children:"postal"===e.provider?"Postal API":"SMTP"})," provider to verify your configuration."]})]})]})]})},_=()=>{const[e,t]=(0,l.useState)({}),[s,r]=(0,l.useState)(!0),[i,n]=(0,l.useState)(!1),[o,p]=(0,l.useState)({type:"",text:""}),[u,g]=(0,l.useState)("app"),b=[{id:"app",name:"Mobile App",icon:c.rle},{id:"subscriptions",name:"Subscriptions",icon:c.jNV},{id:"email",name:"Email",icon:c.maD},{id:"stripe",name:"Stripe",icon:c.x1c},{id:"oauth",name:"OAuth",icon:c.DSS},{id:"vpn",name:"VPN",icon:c.vwk},{id:"security",name:"Security",icon:c.SMR},{id:"backup",name:"Backup",icon:c.nBS},{id:"ads",name:"Ads",icon:c.sdT}];(0,l.useEffect)(()=>{y()},[]);const y=async()=>{try{r(!0);const e=await d.Kp.getSystemSettings(),s={};(Array.isArray(e.data)?e.data:[]).forEach(e=>{"true"===e.value?s[e.key]=!0:"false"===e.value?s[e.key]=!1:(isNaN(e.value)||e.value.trim(),s[e.key]=e.value)}),t(s)}catch(e){console.error("Failed to load settings:",e),p({type:"error",text:"Failed to load settings"})}finally{r(!1)}},j=(e,s)=>{t(t=>(0,a.A)((0,a.A)({},t),{},{[e]:s}))},v=async(e,t)=>{try{n(!0),await d.Kp.updateSystemSetting(e,t),p({type:"success",text:"Setting updated successfully"}),setTimeout(()=>p({type:"",text:""}),3e3)}catch(s){console.error("Failed to save setting:",s),p({type:"error",text:"Failed to save setting"})}finally{n(!1)}};return s?(0,h.jsx)("div",{className:"text-white text-center py-10",children:"Loading settings..."}):(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center",children:[(0,h.jsx)("h2",{className:"text-3xl font-bold text-white",children:"System Settings"}),o.text&&(0,h.jsx)("div",{className:"px-4 py-2 rounded-lg ".concat("success"===o.type?"bg-green-600":"bg-red-600"," text-white"),children:o.text})]}),(0,h.jsx)("div",{className:"flex space-x-2 bg-black bg-opacity-30 p-2 rounded-lg overflow-x-auto",children:b.map(e=>(0,h.jsxs)("button",{onClick:()=>g(e.id),className:"flex items-center px-4 py-2 rounded-lg transition whitespace-nowrap ".concat(u===e.id?"bg-blue-600 text-white":"text-gray-300 hover:bg-white hover:bg-opacity-10"),children:[(0,h.jsx)(e.icon,{className:"mr-2"}),e.name]},e.id))}),"app"===u&&(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsx)("h3",{className:"text-2xl font-bold text-white mb-6",children:"Mobile App Configuration"}),(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"bg-red-900 bg-opacity-20 border border-red-500 rounded-lg p-4",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,h.jsxs)("div",{className:"flex items-center text-red-400 font-bold text-lg",children:[(0,h.jsx)(c.BS8,{className:"mr-2"}),"Maintenance Mode"]}),(0,h.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,h.jsx)("input",{type:"checkbox",checked:e.maintenance_mode||!1,onChange:e=>{j("maintenance_mode",e.target.checked),v("maintenance_mode",e.target.checked)},className:"sr-only peer"}),(0,h.jsx)("div",{className:"w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-red-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"})]})]}),(0,h.jsx)("p",{className:"text-gray-300 text-sm",children:'If enabled, the mobile app will block user access and show a "Under Maintenance" screen. Use this during server upgrades.'})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Minimum App Version"}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsx)("input",{type:"text",value:e.min_app_version||"1.0.0",onChange:e=>j("min_app_version",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g. 1.0.5"}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("min_app_version",e.min_app_version),disabled:i,children:"Save"})]}),(0,h.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"Users with older versions will be forced to update."})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Support Email"}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsx)("input",{type:"email",value:e.support_email||"",onChange:e=>j("support_email",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("support_email",e.support_email),disabled:i,children:"Save"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Privacy Policy URL"}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsx)("input",{type:"text",value:e.privacy_policy_url||"",onChange:e=>j("privacy_policy_url",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("privacy_policy_url",e.privacy_policy_url),disabled:i,children:"Save"})]})]})]})]}),"email"===u&&(0,h.jsx)(w,{}),"subscriptions"===u&&(0,h.jsx)(f,{}),"security"===u&&(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsx)("h3",{className:"text-2xl font-bold text-white mb-6",children:"Security Configuration"}),(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Max Connections (Free Tier)"}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsx)("input",{type:"number",value:e.free_tier_limit||"1",onChange:e=>j("free_tier_limit",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("free_tier_limit",e.free_tier_limit),disabled:i,children:"Save"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Server Capacity Limit"}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsx)("input",{type:"number",value:e.server_capacity_limit||"250",onChange:e=>j("server_capacity_limit",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("server_capacity_limit",e.server_capacity_limit),disabled:i,children:"Save"})]}),(0,h.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"Global default capacity for new servers."})]}),(0,h.jsxs)("div",{className:"bg-green-600 bg-opacity-20 border border-green-500 rounded-lg p-4 mt-6",children:[(0,h.jsx)("p",{className:"text-green-200 text-sm",children:(0,h.jsx)("strong",{children:"Current Security Status:"})}),(0,h.jsxs)("ul",{className:"text-green-200 text-sm mt-2 space-y-1",children:[(0,h.jsx)("li",{children:"\u2713 JWT Authentication Active"}),(0,h.jsx)("li",{children:"\u2713 Password Hashing (bcrypt)"}),(0,h.jsx)("li",{children:"\u2713 Rate Limiting Enabled"}),(0,h.jsx)("li",{children:"\u2713 CORS Configured"})]})]})]})]}),"stripe"===u&&(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsx)("h3",{className:"text-2xl font-bold text-white mb-6",children:"Stripe Configuration"}),(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsx)("div",{className:"bg-blue-600 bg-opacity-20 border border-blue-500 rounded-lg p-4",children:(0,h.jsxs)("p",{className:"text-blue-200 text-sm",children:[(0,h.jsx)("strong",{children:"Note:"})," Stripe API keys must be configured in the backend ",(0,h.jsx)("code",{children:".env"})," file for security. Never expose keys in the admin UI."]})}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Stripe Mode"}),(0,h.jsx)("div",{className:"flex gap-4",children:(0,h.jsx)("input",{type:"text",readOnly:!0,value:e.stripe_mode||"test",className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none"})}),(0,h.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"Change in .env: STRIPE_SECRET_KEY (sk_test_ vs sk_live_)"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Success Redirect URL"}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsx)("input",{type:"text",value:e.stripe_success_url||"https://vpn-xo.com/payment-success",onChange:e=>j("stripe_success_url",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("stripe_success_url",e.stripe_success_url),disabled:i,children:"Save"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Cancel Redirect URL"}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsx)("input",{type:"text",value:e.stripe_cancel_url||"https://vpn-xo.com/payment-cancel",onChange:e=>j("stripe_cancel_url",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("stripe_cancel_url",e.stripe_cancel_url),disabled:i,children:"Save"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Webhook Endpoint"}),(0,h.jsx)("input",{type:"text",readOnly:!0,value:"/api/subscriptions/webhook",className:"w-full px-4 py-2 rounded-lg bg-white bg-opacity-5 border border-white border-opacity-10 text-gray-400"}),(0,h.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"Configure this in Stripe Dashboard \u2192 Developers \u2192 Webhooks"})]})]})]}),"oauth"===u&&(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsx)("h3",{className:"text-2xl font-bold text-white mb-6",children:"OAuth Configuration"}),(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsx)("div",{className:"bg-blue-600 bg-opacity-20 border border-blue-500 rounded-lg p-4",children:(0,h.jsxs)("p",{className:"text-blue-200 text-sm",children:[(0,h.jsx)("strong",{children:"Note:"})," OAuth credentials must be set in backend ",(0,h.jsx)("code",{children:".env"})," for security."]})}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Google OAuth Status"}),(0,h.jsx)("div",{className:"bg-green-600 bg-opacity-20 border border-green-500 rounded-lg p-3",children:(0,h.jsx)("p",{className:"text-green-200 text-sm",children:"\u2713 Google OAuth is configured and active"})})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Google OAuth Callback URL"}),(0,h.jsx)("input",{type:"text",readOnly:!0,value:"https://api.vpn-xo.com/api/auth/google/callback",className:"w-full px-4 py-2 rounded-lg bg-white bg-opacity-5 border border-white border-opacity-10 text-gray-400"}),(0,h.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"Set this in Google Cloud Console \u2192 Authorized redirect URIs"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Allowed Login Methods"}),(0,h.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,h.jsxs)("label",{className:"flex items-center text-gray-300",children:[(0,h.jsx)("input",{type:"checkbox",checked:!0,readOnly:!0,className:"mr-2"})," Email/Password"]}),(0,h.jsxs)("label",{className:"flex items-center text-gray-300",children:[(0,h.jsx)("input",{type:"checkbox",checked:!0,readOnly:!0,className:"mr-2"})," Google OAuth"]})]})]})]})]}),"vpn"===u&&(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsx)("h3",{className:"text-2xl font-bold text-white mb-6",children:"VPN Configuration"}),(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Default Protocol"}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsxs)("select",{value:e.default_protocol||"shadowsocks",onChange:e=>j("default_protocol",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,h.jsx)("option",{value:"shadowsocks",children:"Shadowsocks"}),(0,h.jsx)("option",{value:"trojan",children:"Trojan"}),(0,h.jsx)("option",{value:"v2ray",children:"V2Ray (VMess)"}),(0,h.jsx)("option",{value:"vless",children:"VLESS + Reality"}),(0,h.jsx)("option",{value:"wireguard",children:"WireGuard"}),(0,h.jsx)("option",{value:"hysteria2",children:"Hysteria2"})]}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("default_protocol",e.default_protocol),disabled:i,children:"Save"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Max Devices (Premium)"}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsx)("input",{type:"number",value:e.max_devices_premium||"5",onChange:e=>j("max_devices_premium",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("max_devices_premium",e.max_devices_premium),disabled:i,children:"Save"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Max Devices (Free)"}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsx)("input",{type:"number",value:e.max_devices_free||"1",onChange:e=>j("max_devices_free",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("max_devices_free",e.max_devices_free),disabled:i,children:"Save"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Connection Timeout (seconds)"}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsx)("input",{type:"number",value:e.connection_timeout||"30",onChange:e=>j("connection_timeout",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("connection_timeout",e.connection_timeout),disabled:i,children:"Save"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Heartbeat Interval (seconds)"}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsx)("input",{type:"number",value:e.heartbeat_interval||"120",onChange:e=>j("heartbeat_interval",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("heartbeat_interval",e.heartbeat_interval),disabled:i,children:"Save"})]})]})]})]}),"backup"===u&&(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsx)("h3",{className:"text-2xl font-bold text-white mb-6",children:"Backup & Recovery"}),(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Auto-Backup"}),(0,h.jsxs)("div",{className:"flex items-center justify-between bg-white bg-opacity-5 rounded-lg p-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-white font-medium",children:"Enable Automatic Database Backups"}),(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:"Backs up PostgreSQL database daily"})]}),(0,h.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,h.jsx)("input",{type:"checkbox",checked:e.auto_backup||!1,onChange:e=>{j("auto_backup",e.target.checked),v("auto_backup",e.target.checked)},className:"sr-only peer"}),(0,h.jsx)("div",{className:"w-11 h-6 bg-gray-600 peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Backup Retention (days)"}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsx)("input",{type:"number",value:e.backup_retention_days||"30",onChange:e=>j("backup_retention_days",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("backup_retention_days",e.backup_retention_days),disabled:i,children:"Save"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2",children:"Backup Storage Path"}),(0,h.jsxs)("div",{className:"flex gap-4",children:[(0,h.jsx)("input",{type:"text",value:e.backup_path||"/var/backups/vpnxo",onChange:e=>j("backup_path",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("backup_path",e.backup_path),disabled:i,children:"Save"})]})]}),(0,h.jsx)("div",{className:"bg-yellow-600 bg-opacity-20 border border-yellow-500 rounded-lg p-4",children:(0,h.jsxs)("p",{className:"text-yellow-200 text-sm",children:[(0,h.jsx)("strong",{children:"Tip:"})," Configure pg_dump cron on the server: ",(0,h.jsx)("code",{children:"0 2 * * * pg_dump vpnxo_production | gzip > /var/backups/vpnxo/backup_$(date +%Y%m%d).sql.gz"})]})})]})]}),"ads"===u&&(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsx)("h3",{className:"text-2xl font-bold text-white mb-2",children:"Ad Configuration"}),(0,h.jsxs)("p",{className:"text-gray-400 text-sm mb-6",children:["Desktop ad box is fully controlled here. Mobile ads (Android / iOS) are managed via your ",(0,h.jsx)("strong",{style:{color:"#93c5fd"},children:"AdMob dashboard"})," (add mediation partners \u2014 AppLovin, Meta, etc. \u2014 directly inside AdMob Mediation). Update ad unit IDs in the app source code."]}),(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"border border-white border-opacity-10 rounded-xl p-5",children:[(0,h.jsxs)("h4",{className:"text-white font-bold text-lg mb-4 flex items-center gap-2",children:[(0,h.jsx)(c.sdT,{className:"text-blue-400"}),"Desktop Ad Box (Windows & macOS)"]}),(0,h.jsx)("p",{className:"text-gray-400 text-sm mb-5",children:"Shows an image, animated GIF, or video ad below the connection button on Windows and macOS apps. Appears for all users unless you enable \u201cHide for premium\u201d."}),(0,h.jsxs)("div",{className:"flex items-center justify-between bg-white bg-opacity-5 rounded-lg p-4 mb-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-white font-medium",children:"Enable Desktop Ad Box"}),(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:"Show the ad box on Windows / macOS"})]}),(0,h.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,h.jsx)("input",{type:"checkbox",checked:e.ad_desktop_enabled||!1,onChange:e=>{j("ad_desktop_enabled",e.target.checked),v("ad_desktop_enabled",e.target.checked)},className:"sr-only peer"}),(0,h.jsx)("div",{className:"w-11 h-6 bg-gray-600 peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,h.jsxs)("div",{className:"mb-4",children:[(0,h.jsxs)("label",{className:"block text-gray-300 mb-2 text-sm font-medium",children:["Media URL ",(0,h.jsx)("span",{className:"text-gray-500",children:"(image, animated GIF, or video)"})]}),(0,h.jsxs)("div",{className:"flex gap-3",children:[(0,h.jsx)("input",{type:"url",value:e.ad_desktop_media_url||"",onChange:e=>j("ad_desktop_media_url",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://cdn.example.com/ad-banner.gif"}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("ad_desktop_media_url",e.ad_desktop_media_url),disabled:i,children:"Save"})]}),(0,h.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"Supported: .jpg .png .gif .mp4 .webm \u2014 GIFs auto-loop. Videos are muted and looped."})]}),(0,h.jsxs)("div",{className:"mb-4",children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2 text-sm font-medium",children:"Media Type Override"}),(0,h.jsxs)("div",{className:"flex gap-3",children:[(0,h.jsxs)("select",{value:e.ad_desktop_media_type||"",onChange:e=>j("ad_desktop_media_type",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,h.jsx)("option",{value:"",children:"Auto-detect from URL"}),(0,h.jsx)("option",{value:"image",children:"Image (.jpg / .png)"}),(0,h.jsx)("option",{value:"gif",children:"Animated GIF"}),(0,h.jsx)("option",{value:"video",children:"Video (.mp4 / .webm)"})]}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("ad_desktop_media_type",e.ad_desktop_media_type),disabled:i,children:"Save"})]})]}),(0,h.jsxs)("div",{className:"mb-4",children:[(0,h.jsxs)("label",{className:"block text-gray-300 mb-2 text-sm font-medium",children:["Click-through URL ",(0,h.jsx)("span",{className:"text-gray-500",children:"(optional)"})]}),(0,h.jsxs)("div",{className:"flex gap-3",children:[(0,h.jsx)("input",{type:"url",value:e.ad_desktop_click_url||"",onChange:e=>j("ad_desktop_click_url",e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/promo"}),(0,h.jsx)(m.A,{variant:"primary",onClick:()=>v("ad_desktop_click_url",e.ad_desktop_click_url),disabled:i,children:"Save"})]}),(0,h.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"Opens in the user\\'s browser when they click the ad. Leave blank to disable click-through."})]}),(0,h.jsxs)("div",{className:"flex items-center justify-between bg-white bg-opacity-5 rounded-lg p-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-white font-medium",children:"Hide for Premium Users"}),(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:"If enabled, paid / admin users won\\'t see the desktop ad box"})]}),(0,h.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,h.jsx)("input",{type:"checkbox",checked:e.ad_desktop_hide_premium||!1,onChange:e=>{j("ad_desktop_hide_premium",e.target.checked),v("ad_desktop_hide_premium",e.target.checked)},className:"sr-only peer"}),(0,h.jsx)("div",{className:"w-11 h-6 bg-gray-600 peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]}),(0,h.jsxs)("div",{className:"border border-white border-opacity-10 rounded-xl p-5",children:[(0,h.jsx)("h4",{className:"text-white font-bold text-lg mb-3",children:"Mobile Ads (Android & iOS \u2014 Free Users)"}),(0,h.jsxs)("div",{className:"space-y-3 text-sm text-gray-300",children:[(0,h.jsxs)("div",{className:"bg-white bg-opacity-5 rounded-lg p-4",children:[(0,h.jsx)("p",{className:"font-semibold text-white mb-1",children:"Ad Logic"}),(0,h.jsxs)("ul",{className:"space-y-1 list-disc list-inside text-gray-400",children:[(0,h.jsxs)("li",{children:[(0,h.jsx)("strong",{className:"text-white",children:"1st connection:"})," Free \u2014 no ad shown."]}),(0,h.jsxs)("li",{children:[(0,h.jsx)("strong",{className:"text-white",children:"2nd connection:"})," Rewarded video \u2014 user must watch to connect."]}),(0,h.jsxs)("li",{children:[(0,h.jsx)("strong",{className:"text-white",children:"3rd+ connections:"})," Interstitial ad shown before connecting."]}),(0,h.jsxs)("li",{children:[(0,h.jsx)("strong",{className:"text-white",children:"Premium / admin users:"})," Never see any ads."]})]})]}),(0,h.jsxs)("div",{className:"bg-white bg-opacity-5 rounded-lg p-4",children:[(0,h.jsx)("p",{className:"font-semibold text-white mb-1",children:"Ad Counter Reset & Cooldowns"}),(0,h.jsxs)("p",{className:"text-gray-400",children:["The ad gate counter (",(0,h.jsx)("em",{children:"1st free \u2192 2nd rewarded \u2192 3rd+ interstitial"}),") automatically resets to zero after ",(0,h.jsx)("strong",{className:"text-white",children:"8 hours"})," \u2014 each user gets a fresh session every 8 hours. Additionally, the interstitial has a ",(0,h.jsx)("strong",{className:"text-white",children:"30-minute cooldown"}),": if a user connects more than once every 30 min (common when switching servers), the extra reconnects are free \u2014 no ad-bombing."]})]}),(0,h.jsxs)("div",{className:"bg-white bg-opacity-5 rounded-lg p-4",children:[(0,h.jsx)("p",{className:"font-semibold text-white mb-1",children:"Ad Networks"}),(0,h.jsxs)("p",{className:"text-gray-400",children:[(0,h.jsx)("strong",{className:"text-white",children:"AdMob"})," is the primary SDK. Add demand partners (AppLovin, Meta Audience Network, Unity Ads, etc.) through",(0,h.jsx)("strong",{className:"text-white",children:" AdMob Mediation"})," \u2014 no extra Flutter packages needed. Configure ad unit IDs in ",(0,h.jsx)("code",{className:"text-blue-300",children:"lib/core/services/ad_service.dart"}),"."]})]}),(0,h.jsxs)("div",{className:"bg-white bg-opacity-5 rounded-lg p-4",children:[(0,h.jsx)("p",{className:"font-semibold text-white mb-2",children:"Quick Links"}),(0,h.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,h.jsx)("a",{href:"https://admob.google.com",target:"_blank",rel:"noreferrer",className:"px-3 py-1.5 bg-blue-700 hover:bg-blue-600 rounded text-white text-xs",children:"AdMob Dashboard"}),(0,h.jsx)("a",{href:"https://admob.google.com/home/mediation/",target:"_blank",rel:"noreferrer",className:"px-3 py-1.5 bg-purple-700 hover:bg-purple-600 rounded text-white text-xs",children:"AdMob Mediation Setup"})]})]}),(0,h.jsxs)("div",{className:"bg-yellow-900 bg-opacity-40 border border-yellow-600 rounded-lg p-4",children:[(0,h.jsx)("p",{className:"text-yellow-200 text-sm font-semibold mb-1",children:"\u26a0 Required one-time setup in AdMob dashboard"}),(0,h.jsxs)("ul",{className:"text-yellow-200 text-sm space-y-1 list-disc list-inside",children:[(0,h.jsxs)("li",{children:[(0,h.jsx)("strong",{children:"iOS ATT prompt"}),": Go to AdMob \u2192 Privacy & Messaging \u2192 iOS App Tracking Transparency and create a message. Without this, iOS serves non-personalized ads only (lower CPM)."]}),(0,h.jsxs)("li",{children:[(0,h.jsx)("strong",{children:"GDPR consent form"}),": Go to AdMob \u2192 Privacy & Messaging \u2192 GDPR and create a consent message for EEA/UK users."]}),(0,h.jsxs)("li",{children:[(0,h.jsx)("strong",{children:"App Store / Play Store"}),": Include ",(0,h.jsx)("em",{children:'"No ads for Premium subscribers"'})," in the app description to comply with store policies."]})]})]})]})]})]})]})]})};function k(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;const[s,a]=(0,l.useState)(e);return(0,l.useEffect)(()=>{const s=setTimeout(()=>{a(e)},t);return()=>clearTimeout(s)},[e,t]),s}const C=()=>{const[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)(null),[i,o]=(0,l.useState)([]),[p,u]=(0,l.useState)(!0),[g,b]=(0,l.useState)(null),[y,j]=(0,l.useState)({status:"all",priority:"all",category:"all"}),[v,N]=(0,l.useState)(""),f=k(v,300),[w,_]=(0,l.useState)(""),[C,A]=(0,l.useState)(""),[S,D]=(0,l.useState)(!1),[P,T]=(0,l.useState)(!1),[L,F]=(0,l.useState)([]);(0,l.useEffect)(()=>{R(),E(),I()},[y]),(0,l.useEffect)(()=>{const e=setInterval(()=>{R(),E()},3e4);return()=>clearInterval(e)},[y]),(0,l.useEffect)(()=>{s&&U(s.id)},[s]);const R=async()=>{try{u(!0);const e={};"all"!==y.status&&(e.status=y.status),"all"!==y.priority&&(e.priority=y.priority),"all"!==y.category&&(e.category=y.category);const s=await d.Kp.getAllTickets(e);t(s.data.tickets||[])}catch(e){console.error("Failed to load tickets:",e)}finally{u(!1)}},E=async()=>{try{const e=await d.Kp.getTicketStats();b(e.data.stats)}catch(e){console.error("Failed to load stats:",e)}},U=async e=>{try{const t=await d.Kp.getTicket(e);o(t.data.messages||[])}catch(t){console.error("Failed to load ticket details:",t)}},I=async()=>{try{const e=await d.Kp.getUsers({role:"admin",limit:50});F(e.data.users||[])}catch(e){}},M={urgent:{firstResponse:1,resolution:4},high:{firstResponse:4,resolution:24},medium:{firstResponse:12,resolution:72},low:{firstResponse:24,resolution:168}},O=e=>{const t=M[e.priority]||M.medium,s=new Date(e.created_at),a=(new Date-s)/36e5;if(["resolved","closed"].includes(e.status))return{label:"Met",color:"text-green-400",icon:null};const l=t.firstResponse,r=t.resolution;if(a>r)return{label:"Breached",color:"text-red-400",icon:(0,h.jsx)(c.BS8,{className:"text-red-400"})};if(a>.75*r){const e=Math.round(r-a);return{label:"".concat(e,"h left"),color:"text-yellow-400",icon:(0,h.jsx)(c.w_X,{className:"text-yellow-400"})}}return a>l&&!e.first_response_at?{label:"Response overdue",color:"text-orange-400",icon:(0,h.jsx)(c.TNq,{className:"text-orange-400"})}:{label:"On track",color:"text-green-400",icon:null}},K=e=>{const t={open:{color:"bg-blue-500",text:"Open"},in_progress:{color:"bg-yellow-500",text:"In Progress"},waiting_user:{color:"bg-orange-500",text:"Waiting User"},waiting_staff:{color:"bg-purple-500",text:"Waiting Staff"},resolved:{color:"bg-green-500",text:"Resolved"},closed:{color:"bg-gray-500",text:"Closed"}},s=t[e]||t.open;return(0,h.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold text-white ".concat(s.color),children:s.text})},B=e=>{const t={low:"text-gray-400",medium:"text-blue-400",high:"text-orange-400",urgent:"text-red-400"};return t[e]||t.medium},H=e.filter(e=>{if(f){const t=f.toLowerCase();return e.ticket_number.toLowerCase().includes(t)||e.subject.toLowerCase().includes(t)||e.user_email.toLowerCase().includes(t)}return!0});return p&&0===e.length?(0,h.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,h.jsx)("div",{className:"spinner"}),(0,h.jsx)("span",{className:"ml-3 text-white",children:"Loading tickets..."})]}):(0,h.jsxs)("div",{className:"space-y-6",children:[g&&(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,h.jsx)(x.A,{className:"p-6 bg-gradient-to-br from-blue-600 to-blue-800",children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-blue-200 text-sm",children:"Total Tickets"}),(0,h.jsx)("p",{className:"text-white text-3xl font-bold",children:g.total_tickets||0})]}),(0,h.jsx)(c.tVd,{className:"text-blue-200 text-4xl"})]})}),(0,h.jsx)(x.A,{className:"p-6 bg-gradient-to-br from-yellow-600 to-yellow-800",children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-yellow-200 text-sm",children:"Open Tickets"}),(0,h.jsx)("p",{className:"text-white text-3xl font-bold",children:g.open_tickets||0})]}),(0,h.jsx)(c.TNq,{className:"text-yellow-200 text-4xl"})]})}),(0,h.jsx)(x.A,{className:"p-6 bg-gradient-to-br from-green-600 to-green-800",children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-green-200 text-sm",children:"Resolved"}),(0,h.jsx)("p",{className:"text-white text-3xl font-bold",children:g.resolved_tickets||0})]}),(0,h.jsx)(c.A7C,{className:"text-green-200 text-4xl"})]})}),(0,h.jsx)(x.A,{className:"p-6 bg-gradient-to-br from-purple-600 to-purple-800",children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-purple-200 text-sm",children:"Avg Response"}),(0,h.jsx)("p",{className:"text-white text-3xl font-bold",children:g.avg_first_response_hours?"".concat(Math.round(g.avg_first_response_hours),"h"):"N/A"})]}),(0,h.jsx)(c.w_X,{className:"text-purple-200 text-4xl"})]})})]}),(0,h.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,h.jsx)("div",{className:"lg:col-span-1",children:(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"mb-4",children:[(0,h.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"Tickets"}),(0,h.jsx)("button",{onClick:async()=>{T(!0);try{const e=await d.Kp.exportTicketsCsv(),t=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.href=t,s.download="tickets-export.csv",s.click(),window.URL.revokeObjectURL(t)}catch(e){}T(!1)},disabled:P,className:"text-xs text-blue-400 hover:text-blue-300 mb-4 disabled:opacity-50",children:P?"Exporting...":"Export CSV"}),(0,h.jsxs)("div",{className:"relative mb-4",children:[(0,h.jsx)(c.KSO,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,h.jsx)("input",{type:"text",value:v,onChange:e=>N(e.target.value),placeholder:"Search tickets...",className:"w-full pl-10 pr-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,h.jsxs)("div",{className:"space-y-2",children:[(0,h.jsxs)("select",{value:y.status,onChange:e=>j((0,a.A)((0,a.A)({},y),{},{status:e.target.value})),className:"w-full px-3 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,h.jsx)("option",{value:"all",className:"bg-gray-800",children:"All Status"}),(0,h.jsx)("option",{value:"open",className:"bg-gray-800",children:"Open"}),(0,h.jsx)("option",{value:"in_progress",className:"bg-gray-800",children:"In Progress"}),(0,h.jsx)("option",{value:"waiting_user",className:"bg-gray-800",children:"Waiting User"}),(0,h.jsx)("option",{value:"waiting_staff",className:"bg-gray-800",children:"Waiting Staff"}),(0,h.jsx)("option",{value:"resolved",className:"bg-gray-800",children:"Resolved"}),(0,h.jsx)("option",{value:"closed",className:"bg-gray-800",children:"Closed"})]}),(0,h.jsxs)("select",{value:y.priority,onChange:e=>j((0,a.A)((0,a.A)({},y),{},{priority:e.target.value})),className:"w-full px-3 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,h.jsx)("option",{value:"all",className:"bg-gray-800",children:"All Priority"}),(0,h.jsx)("option",{value:"low",className:"bg-gray-800",children:"Low"}),(0,h.jsx)("option",{value:"medium",className:"bg-gray-800",children:"Medium"}),(0,h.jsx)("option",{value:"high",className:"bg-gray-800",children:"High"}),(0,h.jsx)("option",{value:"urgent",className:"bg-gray-800",children:"Urgent"})]})]})]}),(0,h.jsx)("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:0===H.length?(0,h.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,h.jsx)(c.tVd,{className:"text-4xl mx-auto mb-2"}),(0,h.jsx)("p",{children:"No tickets found"})]}):H.map(e=>{var t,a;return(0,h.jsxs)(n.P.div,{onClick:()=>r(e),className:"p-4 rounded-lg cursor-pointer transition ".concat((null===s||void 0===s?void 0:s.id)===e.id?"bg-blue-600 bg-opacity-30 border-2 border-blue-500":"bg-white bg-opacity-5 hover:bg-opacity-10 border-2 border-transparent"),whileHover:{scale:1.02},children:[(0,h.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,h.jsxs)("div",{className:"flex-1",children:[(0,h.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,h.jsxs)("span",{className:"text-xs text-gray-400 font-mono",children:["#",e.ticket_number]}),K(e.status)]}),(0,h.jsx)("h3",{className:"text-white font-semibold text-sm mb-1 line-clamp-2",children:e.subject}),(0,h.jsx)("p",{className:"text-xs text-gray-400",children:e.user_email})]}),e.unread_user_messages>0&&(0,h.jsx)("span",{className:"ml-2 inline-flex items-center justify-center w-6 h-6 rounded-full bg-red-500 text-white text-xs font-bold",children:e.unread_user_messages})]}),(0,h.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,h.jsx)("span",{className:"font-semibold ".concat(B(e.priority)),children:e.priority.toUpperCase()}),(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(()=>{const t=O(e);return(0,h.jsxs)("span",{className:"flex items-center gap-1 ".concat(t.color),children:[t.icon,t.label]})})(),(0,h.jsx)("span",{className:"text-gray-500",children:"\u2022"}),e.assigned_to?(0,h.jsxs)("span",{className:"text-blue-400 flex items-center gap-1",children:[(0,h.jsx)(c.p7b,{size:10}),(null===(t=L.find(t=>t.id===e.assigned_to))||void 0===t||null===(a=t.email)||void 0===a?void 0:a.split("@")[0])||"Assigned"]}):(0,h.jsx)("span",{className:"text-gray-500",children:"Unassigned"})]})]}),(0,h.jsx)("div",{className:"flex items-center justify-end text-xs mt-1",children:(0,h.jsx)("span",{className:"text-gray-400",children:new Date(e.created_at).toLocaleDateString()})})]},e.id)})})]})}),(0,h.jsx)("div",{className:"lg:col-span-2",children:s?(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"mb-6",children:[(0,h.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,h.jsxs)("div",{className:"flex-1",children:[(0,h.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,h.jsxs)("span",{className:"text-gray-400 font-mono",children:["#",s.ticket_number]}),K(s.status),(0,h.jsx)("span",{className:"text-sm font-semibold ".concat(B(s.priority)),children:s.priority.toUpperCase()})]}),(0,h.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:s.subject}),(0,h.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-400",children:[(0,h.jsxs)("span",{children:["From: ",s.user_email]}),(0,h.jsxs)("span",{children:["Created: ",new Date(s.created_at).toLocaleString()]})]})]}),(0,h.jsx)("button",{onClick:()=>r(null),className:"text-gray-400 hover:text-white transition",children:(0,h.jsx)(c.QCr,{className:"text-xl"})})]}),(0,h.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,h.jsxs)("select",{value:s.status,onChange:e=>(async(e,t)=>{try{await d.Kp.updateTicketStatus(e,t),await R(),(null===s||void 0===s?void 0:s.id)===e&&r((0,a.A)((0,a.A)({},s),{},{status:t}))}catch(l){console.error("Failed to update status:",l)}})(s.id,e.target.value),className:"px-3 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,h.jsx)("option",{value:"open",className:"bg-gray-800",children:"Open"}),(0,h.jsx)("option",{value:"in_progress",className:"bg-gray-800",children:"In Progress"}),(0,h.jsx)("option",{value:"waiting_user",className:"bg-gray-800",children:"Waiting User"}),(0,h.jsx)("option",{value:"waiting_staff",className:"bg-gray-800",children:"Waiting Staff"}),(0,h.jsx)("option",{value:"resolved",className:"bg-gray-800",children:"Resolved"}),(0,h.jsx)("option",{value:"closed",className:"bg-gray-800",children:"Closed"})]}),(0,h.jsxs)("select",{value:s.priority,onChange:e=>(async(e,t)=>{try{await d.Kp.updateTicketPriority(e,t),await R(),(null===s||void 0===s?void 0:s.id)===e&&r((0,a.A)((0,a.A)({},s),{},{priority:t}))}catch(l){console.error("Failed to update priority:",l)}})(s.id,e.target.value),className:"px-3 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,h.jsx)("option",{value:"low",className:"bg-gray-800",children:"Low Priority"}),(0,h.jsx)("option",{value:"medium",className:"bg-gray-800",children:"Medium Priority"}),(0,h.jsx)("option",{value:"high",className:"bg-gray-800",children:"High Priority"}),(0,h.jsx)("option",{value:"urgent",className:"bg-gray-800",children:"Urgent Priority"})]}),(0,h.jsxs)("select",{value:s.assigned_to||"",onChange:e=>(async(e,t)=>{try{await d.Kp.assignTicket(e,t),await R(),(null===s||void 0===s?void 0:s.id)===e&&r((0,a.A)((0,a.A)({},s),{},{assigned_to:t}))}catch(l){console.error("Failed to assign ticket:",l)}})(s.id,e.target.value||null),className:"px-3 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,h.jsx)("option",{value:"",className:"bg-gray-800",children:"Unassigned"}),L.map(e=>{var t;return(0,h.jsx)("option",{value:e.id,className:"bg-gray-800",children:(null===(t=e.email)||void 0===t?void 0:t.split("@")[0])||"Admin #".concat(e.id)},e.id)})]}),(()=>{const e=O(s);return(0,h.jsxs)("div",{className:"px-3 py-2 rounded-lg bg-white bg-opacity-5 border border-white border-opacity-10 flex items-center gap-2 text-sm ".concat(e.color),children:[e.icon||(0,h.jsx)(c.w_X,{}),(0,h.jsxs)("span",{children:["SLA: ",e.label]})]})})()]})]}),(0,h.jsx)("div",{className:"mb-6 max-h-96 overflow-y-auto space-y-4",children:i.map(e=>(0,h.jsxs)("div",{className:"p-4 rounded-lg ".concat(e.is_internal_note?"bg-yellow-500 bg-opacity-10 border border-yellow-500 border-opacity-30":e.is_staff?"bg-blue-600 bg-opacity-20":"bg-purple-600 bg-opacity-20"),children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,h.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,h.jsx)(c.x$1,{className:"text-gray-400"}),(0,h.jsx)("span",{className:"text-white font-semibold text-sm",children:e.is_internal_note?"\ud83d\udd12 Internal Note":e.is_staff?"Staff":"User"}),(0,h.jsx)("span",{className:"text-xs text-gray-400",children:e.user_email})]}),(0,h.jsx)("span",{className:"text-xs text-gray-400",children:new Date(e.created_at).toLocaleString()})]}),(0,h.jsx)("p",{className:"text-white whitespace-pre-wrap",children:e.message}),e.attachments&&e.attachments.length>0&&(0,h.jsx)("div",{className:"mt-3 space-y-2",children:e.attachments.map(e=>(0,h.jsxs)("a",{href:e.file_url,download:!0,className:"flex items-center space-x-2 text-sm text-blue-400 hover:text-blue-300",children:[(0,h.jsx)(c.WCW,{}),(0,h.jsx)("span",{children:e.filename})]},e.id))})]},e.id))}),"closed"!==s.status&&(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-white font-medium mb-2",children:"Reply to User"}),(0,h.jsx)("textarea",{value:w,onChange:e=>_(e.target.value),placeholder:"Type your reply...",className:"w-full px-4 py-3 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"4"}),(0,h.jsx)(m.A,{variant:"primary",size:"md",icon:(0,h.jsx)(c.w1Z,{}),onClick:async()=>{if(w.trim())try{D(!0),await d.Kp.addTicketMessage(s.id,{message:w.trim()}),_(""),await U(s.id),await R()}catch(e){console.error("Failed to send reply:",e)}finally{D(!1)}},loading:S,disabled:!w.trim()||S,className:"mt-2",children:"Send Reply"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-white font-medium mb-2",children:"Internal Note (Staff Only)"}),(0,h.jsx)("textarea",{value:C,onChange:e=>A(e.target.value),placeholder:"Add internal note (not visible to user)...",className:"w-full px-4 py-3 rounded-lg bg-yellow-500 bg-opacity-10 border border-yellow-500 border-opacity-30 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500",rows:"3"}),(0,h.jsx)(m.A,{variant:"warning",size:"sm",onClick:async()=>{if(C.trim())try{D(!0),await d.Kp.addInternalNote(s.id,C.trim()),A(""),await U(s.id)}catch(e){console.error("Failed to add internal note:",e)}finally{D(!1)}},loading:S,disabled:!C.trim()||S,className:"mt-2",children:"Add Internal Note"})]})]}),s.rating&&(0,h.jsxs)("div",{className:"mt-6 p-4 bg-green-500 bg-opacity-10 border border-green-500 border-opacity-30 rounded-lg",children:[(0,h.jsx)("h3",{className:"text-white font-semibold mb-2",children:"User Rating"}),(0,h.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[[1,2,3,4,5].map(e=>(0,h.jsx)(c.gt3,{className:"text-xl ".concat(e<=s.rating?"text-yellow-400":"text-gray-600")},e)),(0,h.jsxs)("span",{className:"text-white font-bold",children:[s.rating,"/5"]})]}),s.rating_comment&&(0,h.jsx)("p",{className:"text-gray-300 text-sm",children:s.rating_comment})]})]}):(0,h.jsxs)(x.A,{className:"p-12 text-center",children:[(0,h.jsx)(c.tVd,{className:"text-6xl text-gray-600 mx-auto mb-4"}),(0,h.jsx)("h3",{className:"text-2xl font-bold text-white mb-2",children:"Select a Ticket"}),(0,h.jsx)("p",{className:"text-gray-400",children:"Choose a ticket from the list to view details and respond"})]})})]})]})},A=()=>{const[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)(!0),[i,o]=(0,l.useState)("all"),[p,u]=(0,l.useState)(""),[g,b]=(0,l.useState)(null),{confirm:y,dialogProps:N}=(0,j.A)();(0,l.useEffect)(()=>{f()},[]);const f=async()=>{try{r(!0);const e=await d.Kp.getContactMessages();t(e.data||[])}catch(e){console.error("Failed to load messages:",e)}finally{r(!1)}},w=async s=>{try{await d.Kp.markMessageAsRead(s),t(e.map(e=>e.id===s?(0,a.A)((0,a.A)({},e),{},{read:!0}):e))}catch(l){console.error("Failed to mark as read:",l)}},_=e.filter(e=>{const t="all"===i||"unread"===i&&!e.read||"read"===i&&e.read,s=(e.name||"").toLowerCase().includes(p.toLowerCase())||(e.email||"").toLowerCase().includes(p.toLowerCase())||(e.subject||"").toLowerCase().includes(p.toLowerCase())||(e.message||"").toLowerCase().includes(p.toLowerCase());return t&&s}),k=e.filter(e=>!e.read).length;return s?(0,h.jsx)("div",{className:"text-center py-12",children:(0,h.jsx)("div",{className:"text-white text-xl",children:"Loading messages..."})}):(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Contact Messages"}),(0,h.jsxs)("p",{className:"text-gray-300",children:[k," unread message",1!==k?"s":""]})]}),(0,h.jsx)(m.A,{variant:"outline",size:"sm",onClick:f,children:"Refresh"})]}),(0,h.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[(0,h.jsx)("div",{className:"flex-1",children:(0,h.jsxs)("div",{className:"relative",children:[(0,h.jsx)(c.KSO,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,h.jsx)("input",{type:"text",placeholder:"Search messages...",value:p,onChange:e=>u(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-white bg-opacity-10 border border-white border-opacity-20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),(0,h.jsxs)("div",{className:"flex gap-2",children:[(0,h.jsxs)("button",{onClick:()=>o("all"),className:"px-4 py-2 rounded-lg transition ".concat("all"===i?"bg-blue-600 text-white":"bg-white bg-opacity-10 text-gray-300 hover:bg-opacity-20"),children:["All (",e.length,")"]}),(0,h.jsxs)("button",{onClick:()=>o("unread"),className:"px-4 py-2 rounded-lg transition ".concat("unread"===i?"bg-blue-600 text-white":"bg-white bg-opacity-10 text-gray-300 hover:bg-opacity-20"),children:["Unread (",k,")"]}),(0,h.jsxs)("button",{onClick:()=>o("read"),className:"px-4 py-2 rounded-lg transition ".concat("read"===i?"bg-blue-600 text-white":"bg-white bg-opacity-10 text-gray-300 hover:bg-opacity-20"),children:["Read (",e.length-k,")"]})]})]}),(0,h.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,h.jsx)("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:0===_.length?(0,h.jsxs)("div",{className:"text-center py-12 text-gray-400",children:[(0,h.jsx)(c.maD,{className:"text-6xl mx-auto mb-4 opacity-50"}),(0,h.jsx)("p",{children:"No messages found"})]}):_.map(e=>(0,h.jsxs)(n.P.div,{className:"p-4 rounded-lg cursor-pointer transition ".concat((null===g||void 0===g?void 0:g.id)===e.id?"bg-blue-600 bg-opacity-30 border-2 border-blue-500":e.read?"bg-white bg-opacity-5 hover:bg-opacity-10":"bg-blue-500 bg-opacity-10 hover:bg-opacity-20 border border-blue-500"),onClick:()=>{b(e),e.read||w(e.id)},whileHover:{scale:1.02},children:[(0,h.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[e.read?(0,h.jsx)(c.g5U,{className:"text-gray-400"}):(0,h.jsx)(c.maD,{className:"text-blue-400"}),(0,h.jsx)("span",{className:"text-white font-semibold",children:e.name})]}),(0,h.jsx)("span",{className:"text-gray-400 text-xs",children:new Date(e.created_at).toLocaleDateString()})]}),(0,h.jsx)("p",{className:"text-gray-300 text-sm mb-1",children:e.email}),e.subject&&(0,h.jsx)("p",{className:"text-white font-medium text-sm mb-2",children:e.subject}),(0,h.jsx)("p",{className:"text-gray-400 text-sm line-clamp-2",children:e.message})]},e.id))}),(0,h.jsx)("div",{children:g?(0,h.jsxs)(x.A,{className:"p-6 sticky top-4",children:[(0,h.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("h3",{className:"text-xl font-bold text-white mb-1",children:g.name}),(0,h.jsx)("p",{className:"text-gray-300",children:g.email})]}),(0,h.jsxs)("div",{className:"flex gap-2",children:[!g.read&&(0,h.jsx)("button",{onClick:()=>w(g.id),className:"p-2 bg-green-500 bg-opacity-20 hover:bg-opacity-30 rounded-lg transition",title:"Mark as read",children:(0,h.jsx)(c.A7C,{className:"text-green-400"})}),(0,h.jsx)("button",{onClick:()=>(async s=>{if(await y({title:"Delete Message",message:"Are you sure you want to delete this message?",confirmText:"Delete",variant:"danger"}))try{await d.Kp.deleteContactMessage(s),t(e.filter(e=>e.id!==s)),(null===g||void 0===g?void 0:g.id)===s&&b(null)}catch(a){console.error("Failed to delete message:",a)}})(g.id),className:"p-2 bg-red-500 bg-opacity-20 hover:bg-opacity-30 rounded-lg transition",title:"Delete",children:(0,h.jsx)(c.qbC,{className:"text-red-400"})})]})]}),(0,h.jsx)("div",{className:"mb-4",children:(0,h.jsxs)("span",{className:"text-gray-400 text-sm",children:["Received: ",new Date(g.created_at).toLocaleString()]})}),g.subject&&(0,h.jsxs)("div",{className:"mb-4",children:[(0,h.jsx)("h4",{className:"text-white font-semibold mb-2",children:"Subject:"}),(0,h.jsx)("p",{className:"text-gray-300",children:g.subject})]}),(0,h.jsxs)("div",{className:"mb-6",children:[(0,h.jsx)("h4",{className:"text-white font-semibold mb-2",children:"Message:"}),(0,h.jsx)("div",{className:"bg-white bg-opacity-5 rounded-lg p-4",children:(0,h.jsx)("p",{className:"text-gray-300 whitespace-pre-wrap",children:g.message})})]}),(0,h.jsx)(m.A,{variant:"primary",fullWidth:!0,icon:(0,h.jsx)(c.w1Z,{}),onClick:()=>window.location.href="mailto:".concat(g.email,"?subject=Re: ").concat(g.subject||"Your message"),children:"Reply via Email"})]}):(0,h.jsxs)(x.A,{className:"p-12 text-center",children:[(0,h.jsx)(c.maD,{className:"text-6xl text-gray-600 mx-auto mb-4"}),(0,h.jsx)("p",{className:"text-gray-400",children:"Select a message to view details"})]})})]})]}),(0,h.jsx)(v.A,(0,a.A)({},N))]})},S=()=>{const[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)(!0),[i,o]=(0,l.useState)("all"),[p,u]=(0,l.useState)(""),[g,b]=(0,l.useState)(null),{confirm:y,dialogProps:N}=(0,j.A)();(0,l.useEffect)(()=>{f();const e=setInterval(f,3e4);return()=>clearInterval(e)},[]);const f=async()=>{try{r(!0);const e=await d.Kp.getErrors();t(Array.isArray(e.data)?e.data:[])}catch(e){console.error("Failed to load errors:",e)}finally{r(!1)}},w=async s=>{try{await d.Kp.markErrorAsResolved(s),t(e.map(e=>e.id===s?(0,a.A)((0,a.A)({},e),{},{resolved:!0}):e))}catch(l){console.error("Failed to mark as resolved:",l)}},_=e=>{switch(e){case"critical":return"text-red-400 bg-red-500";case"error":return"text-orange-400 bg-orange-500";case"warning":return"text-yellow-400 bg-yellow-500";default:return"text-blue-400 bg-blue-500"}},k=e=>{switch(e){case"critical":return(0,h.jsx)(c._Hm,{});case"error":return(0,h.jsx)(c.BS8,{});case"warning":return(0,h.jsx)(c.KRc,{});default:return(0,h.jsx)(c.A7C,{})}},C=e.filter(e=>{var t,s;const a="all"===i||e.severity===i,l=e.message.toLowerCase().includes(p.toLowerCase())||(null===(t=e.stack)||void 0===t?void 0:t.toLowerCase().includes(p.toLowerCase()))||(null===(s=e.endpoint)||void 0===s?void 0:s.toLowerCase().includes(p.toLowerCase()));return a&&l}),A=e.filter(e=>!e.resolved).length,S=e.filter(e=>"critical"===e.severity&&!e.resolved).length;return s?(0,h.jsx)("div",{className:"text-center py-12",children:(0,h.jsx)("div",{className:"text-white text-xl",children:"Loading errors..."})}):(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Error Tracking"}),(0,h.jsxs)("p",{className:"text-gray-300",children:[A," unresolved error",1!==A?"s":"",S>0&&(0,h.jsxs)("span",{className:"text-red-400 ml-2",children:["(",S," critical)"]})]})]}),(0,h.jsxs)("div",{className:"flex gap-2",children:[(0,h.jsx)(m.A,{variant:"outline",size:"sm",onClick:f,children:"Refresh"}),(0,h.jsx)(m.A,{variant:"danger",size:"sm",onClick:async()=>{if(await y({title:"Clear Resolved Errors",message:"Are you sure you want to clear all resolved errors?",confirmText:"Clear All",variant:"warning"}))try{await d.Kp.clearResolvedErrors(),t(e.filter(e=>!e.resolved))}catch(s){console.error("Failed to clear resolved errors:",s)}},disabled:0===e.filter(e=>e.resolved).length,children:"Clear Resolved"})]})]}),(0,h.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[(0,h.jsxs)("div",{className:"bg-red-500 bg-opacity-10 border border-red-500 rounded-lg p-4",children:[(0,h.jsx)("div",{className:"text-red-400 text-2xl font-bold",children:e.filter(e=>"critical"===e.severity&&!e.resolved).length}),(0,h.jsx)("div",{className:"text-gray-300 text-sm",children:"Critical"})]}),(0,h.jsxs)("div",{className:"bg-orange-500 bg-opacity-10 border border-orange-500 rounded-lg p-4",children:[(0,h.jsx)("div",{className:"text-orange-400 text-2xl font-bold",children:e.filter(e=>"error"===e.severity&&!e.resolved).length}),(0,h.jsx)("div",{className:"text-gray-300 text-sm",children:"Errors"})]}),(0,h.jsxs)("div",{className:"bg-yellow-500 bg-opacity-10 border border-yellow-500 rounded-lg p-4",children:[(0,h.jsx)("div",{className:"text-yellow-400 text-2xl font-bold",children:e.filter(e=>"warning"===e.severity&&!e.resolved).length}),(0,h.jsx)("div",{className:"text-gray-300 text-sm",children:"Warnings"})]}),(0,h.jsxs)("div",{className:"bg-green-500 bg-opacity-10 border border-green-500 rounded-lg p-4",children:[(0,h.jsx)("div",{className:"text-green-400 text-2xl font-bold",children:e.filter(e=>e.resolved).length}),(0,h.jsx)("div",{className:"text-gray-300 text-sm",children:"Resolved"})]})]}),(0,h.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[(0,h.jsx)("div",{className:"flex-1",children:(0,h.jsxs)("div",{className:"relative",children:[(0,h.jsx)(c.KSO,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,h.jsx)("input",{type:"text",placeholder:"Search errors...",value:p,onChange:e=>u(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-white bg-opacity-10 border border-white border-opacity-20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),(0,h.jsxs)("div",{className:"flex gap-2",children:[(0,h.jsx)("button",{onClick:()=>o("all"),className:"px-4 py-2 rounded-lg transition ".concat("all"===i?"bg-blue-600 text-white":"bg-white bg-opacity-10 text-gray-300 hover:bg-opacity-20"),children:"All"}),(0,h.jsx)("button",{onClick:()=>o("critical"),className:"px-4 py-2 rounded-lg transition ".concat("critical"===i?"bg-red-600 text-white":"bg-white bg-opacity-10 text-gray-300 hover:bg-opacity-20"),children:"Critical"}),(0,h.jsx)("button",{onClick:()=>o("error"),className:"px-4 py-2 rounded-lg transition ".concat("error"===i?"bg-orange-600 text-white":"bg-white bg-opacity-10 text-gray-300 hover:bg-opacity-20"),children:"Errors"}),(0,h.jsx)("button",{onClick:()=>o("warning"),className:"px-4 py-2 rounded-lg transition ".concat("warning"===i?"bg-yellow-600 text-white":"bg-white bg-opacity-10 text-gray-300 hover:bg-opacity-20"),children:"Warnings"})]})]}),(0,h.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,h.jsx)("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:0===C.length?(0,h.jsxs)("div",{className:"text-center py-12 text-gray-400",children:[(0,h.jsx)(c.A7C,{className:"text-6xl mx-auto mb-4 opacity-50"}),(0,h.jsx)("p",{children:"No errors found"})]}):C.map(e=>(0,h.jsxs)(n.P.div,{className:"p-4 rounded-lg cursor-pointer transition ".concat((null===g||void 0===g?void 0:g.id)===e.id?"bg-blue-600 bg-opacity-30 border-2 border-blue-500":e.resolved?"bg-white bg-opacity-5 hover:bg-opacity-10 opacity-60":"".concat(_(e.severity)," bg-opacity-10 hover:bg-opacity-20 border border-current")),onClick:()=>b(e),whileHover:{scale:1.02},children:[(0,h.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)("span",{className:_(e.severity),children:k(e.severity)}),(0,h.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(_(e.severity)," bg-opacity-20"),children:e.severity.toUpperCase()}),e.resolved&&(0,h.jsx)("span",{className:"text-xs px-2 py-1 rounded bg-green-500 bg-opacity-20 text-green-400",children:"RESOLVED"})]}),(0,h.jsxs)("span",{className:"text-gray-400 text-xs flex items-center gap-1",children:[(0,h.jsx)(c.w_X,{}),new Date(e.created_at).toLocaleTimeString()]})]}),(0,h.jsx)("p",{className:"text-white font-medium text-sm mb-2 line-clamp-2",children:e.message}),e.endpoint&&(0,h.jsxs)("p",{className:"text-gray-400 text-xs flex items-center gap-1",children:[(0,h.jsx)(c.FSj,{}),e.endpoint]}),(0,h.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:new Date(e.created_at).toLocaleDateString()})]},e.id))}),(0,h.jsx)("div",{children:g?(0,h.jsxs)(x.A,{className:"p-6 sticky top-4",children:[(0,h.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)("span",{className:"text-2xl ".concat(_(g.severity)),children:k(g.severity)}),(0,h.jsxs)("div",{children:[(0,h.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(_(g.severity)," bg-opacity-20"),children:g.severity.toUpperCase()}),g.resolved&&(0,h.jsx)("span",{className:"ml-2 text-xs px-2 py-1 rounded bg-green-500 bg-opacity-20 text-green-400",children:"RESOLVED"})]})]}),(0,h.jsxs)("div",{className:"flex gap-2",children:[!g.resolved&&(0,h.jsx)("button",{onClick:()=>w(g.id),className:"p-2 bg-green-500 bg-opacity-20 hover:bg-opacity-30 rounded-lg transition",title:"Mark as resolved",children:(0,h.jsx)(c.A7C,{className:"text-green-400"})}),(0,h.jsx)("button",{onClick:()=>(async s=>{if(await y({title:"Delete Error",message:"Are you sure you want to delete this error?",confirmText:"Delete",variant:"danger"}))try{await d.Kp.deleteError(s),t(e.filter(e=>e.id!==s)),(null===g||void 0===g?void 0:g.id)===s&&b(null)}catch(a){console.error("Failed to delete error:",a)}})(g.id),className:"p-2 bg-red-500 bg-opacity-20 hover:bg-opacity-30 rounded-lg transition",title:"Delete",children:(0,h.jsx)(c.qbC,{className:"text-red-400"})})]})]}),(0,h.jsx)("div",{className:"mb-4",children:(0,h.jsxs)("span",{className:"text-gray-400 text-sm",children:["Occurred: ",new Date(g.created_at).toLocaleString()]})}),(0,h.jsxs)("div",{className:"mb-4",children:[(0,h.jsx)("h4",{className:"text-white font-semibold mb-2",children:"Error Message:"}),(0,h.jsx)("div",{className:"bg-red-500 bg-opacity-10 border border-red-500 rounded-lg p-4",children:(0,h.jsx)("p",{className:"text-red-200 font-mono text-sm",children:g.message})})]}),g.endpoint&&(0,h.jsxs)("div",{className:"mb-4",children:[(0,h.jsx)("h4",{className:"text-white font-semibold mb-2",children:"Endpoint:"}),(0,h.jsx)("div",{className:"bg-white bg-opacity-5 rounded-lg p-3",children:(0,h.jsx)("p",{className:"text-gray-300 font-mono text-sm",children:g.endpoint})})]}),g.user_id&&(0,h.jsxs)("div",{className:"mb-4",children:[(0,h.jsx)("h4",{className:"text-white font-semibold mb-2",children:"User ID:"}),(0,h.jsx)("p",{className:"text-gray-300",children:g.user_id})]}),g.stack&&(0,h.jsxs)("div",{className:"mb-4",children:[(0,h.jsx)("h4",{className:"text-white font-semibold mb-2",children:"Stack Trace:"}),(0,h.jsx)("div",{className:"bg-black bg-opacity-50 rounded-lg p-4 max-h-64 overflow-y-auto",children:(0,h.jsx)("pre",{className:"text-gray-300 font-mono text-xs whitespace-pre-wrap",children:g.stack})})]}),g.metadata&&(0,h.jsxs)("div",{className:"mb-4",children:[(0,h.jsx)("h4",{className:"text-white font-semibold mb-2",children:"Additional Info:"}),(0,h.jsx)("div",{className:"bg-white bg-opacity-5 rounded-lg p-4",children:(0,h.jsx)("pre",{className:"text-gray-300 font-mono text-xs whitespace-pre-wrap",children:JSON.stringify(g.metadata,null,2)})})]}),!g.resolved&&(0,h.jsx)(m.A,{variant:"success",fullWidth:!0,icon:(0,h.jsx)(c.A7C,{}),onClick:()=>w(g.id),children:"Mark as Resolved"})]}):(0,h.jsxs)(x.A,{className:"p-12 text-center",children:[(0,h.jsx)(c.KRc,{className:"text-6xl text-gray-600 mx-auto mb-4"}),(0,h.jsx)("p",{className:"text-gray-400",children:"Select an error to view details"})]})})]})]}),(0,h.jsx)(v.A,(0,a.A)({},N))]})},D=()=>{const[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)(!0),[i,n]=(0,l.useState)(!1),[c,o]=(0,l.useState)(null),[x,m]=(0,l.useState)({name:"",description:"",campaign_type:"custom",discount_type:"percentage",discount_value:"",applies_to_all_plans:!0,applicable_plan_types:[],start_date:"",end_date:"",theme_color:"#FF6B6B",banner_text:"",badge_text:"",requires_coupon:!1,coupon_code:"",max_uses:"",max_uses_per_user:1}),{confirm:p,dialogProps:u}=(0,j.A)();(0,l.useEffect)(()=>{g()},[]);const g=async()=>{try{var e;const s=await d.Ay.get("/api/admin/discount/campaigns");t((null===(e=s.data)||void 0===e?void 0:e.campaigns)||[])}catch(s){console.error("Error fetching campaigns:",s)}finally{r(!1)}},b=e=>{const{name:t,value:s,type:l,checked:r}=e.target;m(e=>(0,a.A)((0,a.A)({},e),{},{[t]:"checkbox"===l?r:s}))},y=()=>{m({name:"",description:"",campaign_type:"custom",discount_type:"percentage",discount_value:"",applies_to_all_plans:!0,applicable_plan_types:[],start_date:"",end_date:"",theme_color:"#FF6B6B",banner_text:"",badge_text:"",requires_coupon:!1,coupon_code:"",max_uses:"",max_uses_per_user:1}),o(null)};return s?(0,h.jsx)("div",{className:"loading",children:"Loading campaigns..."}):(0,h.jsxs)("div",{className:"discount-campaign-manager",children:[(0,h.jsxs)("div",{className:"manager-header",children:[(0,h.jsx)("h1",{children:"\ud83c\udfa8 Discount Campaign Manager"}),(0,h.jsx)("button",{className:"btn-create",onClick:()=>{y(),n(!0)},children:"+ Create Campaign"})]}),(0,h.jsx)("div",{className:"campaigns-grid",children:e.map(e=>{return(0,h.jsxs)("div",{className:"campaign-card ".concat(e.is_active?"active":""),children:[(0,h.jsxs)("div",{className:"campaign-header",children:[(0,h.jsx)("div",{className:"campaign-icon",children:(t=e.campaign_type,{black_friday:"\ud83d\udecd\ufe0f",cyber_monday:"\ud83d\udcbb",new_year:"\ud83c\udf89",summer_sale:"\u2600\ufe0f",custom:"\ud83c\udfaf"}[t]||"\ud83c\udfaf")}),(0,h.jsxs)("div",{className:"campaign-status",children:[e.is_active&&(0,h.jsx)("span",{className:"badge active",children:"ACTIVE"}),e.is_featured&&(0,h.jsx)("span",{className:"badge featured",children:"FEATURED"})]})]}),(0,h.jsx)("h3",{children:e.name}),(0,h.jsx)("p",{className:"campaign-description",children:e.description}),(0,h.jsxs)("div",{className:"campaign-details",children:[(0,h.jsxs)("div",{className:"detail-item",children:[(0,h.jsx)("span",{className:"label",children:"Discount:"}),(0,h.jsx)("span",{className:"value",children:"percentage"===e.discount_type?"".concat(e.discount_value,"%"):"$".concat(e.discount_value)})]}),(0,h.jsxs)("div",{className:"detail-item",children:[(0,h.jsx)("span",{className:"label",children:"Period:"}),(0,h.jsxs)("span",{className:"value",children:[new Date(e.start_date).toLocaleDateString()," - ",new Date(e.end_date).toLocaleDateString()]})]}),(0,h.jsxs)("div",{className:"detail-item",children:[(0,h.jsx)("span",{className:"label",children:"Uses:"}),(0,h.jsxs)("span",{className:"value",children:[e.current_uses," / ",e.max_uses||"\u221e"]})]})]}),(0,h.jsxs)("div",{className:"campaign-preview",style:{borderColor:e.theme_color},children:[(0,h.jsx)("div",{className:"preview-badge",style:{backgroundColor:e.theme_color},children:e.badge_text}),(0,h.jsx)("div",{className:"preview-banner",children:e.banner_text})]}),(0,h.jsxs)("div",{className:"campaign-actions",children:[(0,h.jsx)("button",{className:"btn-edit",onClick:()=>(e=>{o(e),m({name:e.name,description:e.description,campaign_type:e.campaign_type,discount_type:e.discount_type,discount_value:e.discount_value,applies_to_all_plans:e.applies_to_all_plans,applicable_plan_types:e.applicable_plan_types||[],start_date:e.start_date.split("T")[0],end_date:e.end_date.split("T")[0],theme_color:e.theme_color,banner_text:e.banner_text,badge_text:e.badge_text,requires_coupon:e.requires_coupon,coupon_code:e.coupon_code||"",max_uses:e.max_uses||"",max_uses_per_user:e.max_uses_per_user}),n(!0)})(e),children:"Edit"}),e.is_active?(0,h.jsx)("button",{className:"btn-deactivate",onClick:()=>(async e=>{try{await d.Ay.post("/api/admin/discount/campaigns/".concat(e,"/deactivate")),g()}catch(t){console.error("Error deactivating campaign:",t)}})(e.id),children:"Deactivate"}):(0,h.jsx)("button",{className:"btn-activate",onClick:()=>(async e=>{try{await d.Ay.post("/api/admin/discount/campaigns/".concat(e,"/activate")),g()}catch(t){console.error("Error activating campaign:",t)}})(e.id),children:"Activate"}),(0,h.jsx)("button",{className:"btn-delete",onClick:()=>(async e=>{if(await p({title:"Delete Campaign",message:"Are you sure you want to delete this campaign?",confirmText:"Delete",variant:"danger"}))try{await d.Ay.delete("/api/admin/discount/campaigns/".concat(e)),g()}catch(t){console.error("Error deleting campaign:",t)}})(e.id),children:"Delete"})]})]},e.id);var t})}),i&&(0,h.jsx)("div",{className:"modal-overlay",onClick:()=>n(!1),children:(0,h.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,h.jsxs)("div",{className:"modal-header",children:[(0,h.jsx)("h2",{children:c?"Edit Campaign":"Create Campaign"}),(0,h.jsx)("button",{className:"btn-close",onClick:()=>n(!1),children:"\xd7"})]}),(0,h.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{c?await d.Ay.put("/api/admin/discount/campaigns/".concat(c.id),x):await d.Ay.post("/api/admin/discount/campaigns",x),g(),y(),n(!1)}catch(t){console.error("Error saving campaign:",t)}},className:"campaign-form",children:[(0,h.jsxs)("div",{className:"form-row",children:[(0,h.jsxs)("div",{className:"form-group",children:[(0,h.jsx)("label",{children:"Campaign Name *"}),(0,h.jsx)("input",{type:"text",name:"name",value:x.name,onChange:b,required:!0,placeholder:"e.g., Black Friday 2025"})]}),(0,h.jsxs)("div",{className:"form-group",children:[(0,h.jsx)("label",{children:"Campaign Type *"}),(0,h.jsxs)("select",{name:"campaign_type",value:x.campaign_type,onChange:b,required:!0,children:[(0,h.jsx)("option",{value:"black_friday",children:"\ud83d\udecd\ufe0f Black Friday"}),(0,h.jsx)("option",{value:"cyber_monday",children:"\ud83d\udcbb Cyber Monday"}),(0,h.jsx)("option",{value:"new_year",children:"\ud83c\udf89 New Year"}),(0,h.jsx)("option",{value:"summer_sale",children:"\u2600\ufe0f Summer Sale"}),(0,h.jsx)("option",{value:"custom",children:"\ud83c\udfaf Custom"})]})]})]}),(0,h.jsxs)("div",{className:"form-group",children:[(0,h.jsx)("label",{children:"Description"}),(0,h.jsx)("textarea",{name:"description",value:x.description,onChange:b,rows:"3",placeholder:"Campaign description..."})]}),(0,h.jsxs)("div",{className:"form-row",children:[(0,h.jsxs)("div",{className:"form-group",children:[(0,h.jsx)("label",{children:"Discount Type *"}),(0,h.jsxs)("select",{name:"discount_type",value:x.discount_type,onChange:b,required:!0,children:[(0,h.jsx)("option",{value:"percentage",children:"Percentage (%)"}),(0,h.jsx)("option",{value:"fixed_amount",children:"Fixed Amount ($)"})]})]}),(0,h.jsxs)("div",{className:"form-group",children:[(0,h.jsx)("label",{children:"Discount Value *"}),(0,h.jsx)("input",{type:"number",name:"discount_value",value:x.discount_value,onChange:b,required:!0,min:"0",step:"0.01",placeholder:"percentage"===x.discount_type?"50":"10.00"})]})]}),(0,h.jsxs)("div",{className:"form-row",children:[(0,h.jsxs)("div",{className:"form-group",children:[(0,h.jsx)("label",{children:"Start Date *"}),(0,h.jsx)("input",{type:"date",name:"start_date",value:x.start_date,onChange:b,required:!0})]}),(0,h.jsxs)("div",{className:"form-group",children:[(0,h.jsx)("label",{children:"End Date *"}),(0,h.jsx)("input",{type:"date",name:"end_date",value:x.end_date,onChange:b,required:!0})]})]}),(0,h.jsxs)("div",{className:"form-row",children:[(0,h.jsxs)("div",{className:"form-group",children:[(0,h.jsx)("label",{children:"Theme Color"}),(0,h.jsx)("input",{type:"color",name:"theme_color",value:x.theme_color,onChange:b})]}),(0,h.jsxs)("div",{className:"form-group",children:[(0,h.jsx)("label",{children:"Badge Text"}),(0,h.jsx)("input",{type:"text",name:"badge_text",value:x.badge_text,onChange:b,placeholder:"e.g., 50% OFF"})]})]}),(0,h.jsxs)("div",{className:"form-group",children:[(0,h.jsx)("label",{children:"Banner Text"}),(0,h.jsx)("input",{type:"text",name:"banner_text",value:x.banner_text,onChange:b,placeholder:"e.g., \ud83d\udd25 BLACK FRIDAY SALE - 50% OFF ALL PLANS!"})]}),(0,h.jsxs)("div",{className:"form-row",children:[(0,h.jsx)("div",{className:"form-group",children:(0,h.jsxs)("label",{children:[(0,h.jsx)("input",{type:"checkbox",name:"requires_coupon",checked:x.requires_coupon,onChange:b}),"Requires Coupon Code"]})}),x.requires_coupon&&(0,h.jsxs)("div",{className:"form-group",children:[(0,h.jsx)("label",{children:"Coupon Code"}),(0,h.jsx)("input",{type:"text",name:"coupon_code",value:x.coupon_code,onChange:b,placeholder:"e.g., BLACKFRIDAY50"})]})]}),(0,h.jsxs)("div",{className:"form-row",children:[(0,h.jsxs)("div",{className:"form-group",children:[(0,h.jsx)("label",{children:"Max Total Uses"}),(0,h.jsx)("input",{type:"number",name:"max_uses",value:x.max_uses,onChange:b,min:"0",placeholder:"Leave empty for unlimited"})]}),(0,h.jsxs)("div",{className:"form-group",children:[(0,h.jsx)("label",{children:"Max Uses Per User"}),(0,h.jsx)("input",{type:"number",name:"max_uses_per_user",value:x.max_uses_per_user,onChange:b,min:"1",required:!0})]})]}),(0,h.jsxs)("div",{className:"form-actions",children:[(0,h.jsx)("button",{type:"button",className:"btn-cancel",onClick:()=>n(!1),children:"Cancel"}),(0,h.jsx)("button",{type:"submit",className:"btn-submit",children:c?"Update Campaign":"Create Campaign"})]})]})]})}),(0,h.jsx)(v.A,(0,a.A)({},u))]})},P={create:"bg-green-500",update:"bg-blue-500",delete:"bg-red-500",login:"bg-purple-500",bulk_activate:"bg-green-500",bulk_suspend:"bg-yellow-500",bulk_upgrade:"bg-purple-500",bulk_downgrade:"bg-orange-500",bulk_delete:"bg-red-500"},T=()=>{const[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)(!0),[i,n]=(0,l.useState)({action:"",target_type:"",start_date:"",end_date:""});(0,l.useEffect)(()=>{o();const e=setInterval(o,3e4);return()=>clearInterval(e)},[i]);const o=async()=>{try{r(!0);const e=await d.Kp.getAuditLogs(i);t(e.data||[])}catch(e){console.error("Failed to load audit logs:",e)}finally{r(!1)}};return(0,h.jsx)("div",{className:"space-y-6",children:(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,h.jsxs)("h2",{className:"text-2xl font-bold text-white flex items-center",children:[(0,h.jsx)(c.OKX,{className:"mr-3 text-blue-400"}),"Audit Trail"]}),(0,h.jsxs)("div",{className:"flex gap-2",children:[(0,h.jsx)(m.A,{variant:"outline",size:"sm",icon:(0,h.jsx)(c.DIg,{}),onClick:o,children:"Refresh"}),(0,h.jsx)(m.A,{variant:"outline",size:"sm",onClick:async()=>{try{const e=await d.Kp.exportAuditCsv(),t=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.href=t,s.download="audit-trail-export.csv",s.click(),window.URL.revokeObjectURL(t)}catch(e){}},children:"Export CSV"})]})]}),(0,h.jsxs)("div",{className:"flex flex-wrap gap-4 mb-6",children:[(0,h.jsxs)("select",{value:i.action,onChange:e=>n((0,a.A)((0,a.A)({},i),{},{action:e.target.value})),className:"px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,h.jsx)("option",{value:"",children:"All Actions"}),(0,h.jsx)("option",{value:"create",children:"Create"}),(0,h.jsx)("option",{value:"update",children:"Update"}),(0,h.jsx)("option",{value:"delete",children:"Delete"}),(0,h.jsx)("option",{value:"login",children:"Login"}),(0,h.jsx)("option",{value:"bulk_activate",children:"Bulk Activate"}),(0,h.jsx)("option",{value:"bulk_suspend",children:"Bulk Suspend"}),(0,h.jsx)("option",{value:"bulk_upgrade",children:"Bulk Upgrade"})]}),(0,h.jsxs)("select",{value:i.target_type,onChange:e=>n((0,a.A)((0,a.A)({},i),{},{target_type:e.target.value})),className:"px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,h.jsx)("option",{value:"",children:"All Targets"}),(0,h.jsx)("option",{value:"user",children:"Users"}),(0,h.jsx)("option",{value:"server",children:"Servers"}),(0,h.jsx)("option",{value:"subscription",children:"Subscriptions"}),(0,h.jsx)("option",{value:"users",children:"Bulk Users"})]}),(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)(c.bfZ,{className:"text-gray-400"}),(0,h.jsx)("input",{type:"date",value:i.start_date,onChange:e=>n((0,a.A)((0,a.A)({},i),{},{start_date:e.target.value})),className:"px-3 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 [color-scheme:dark]",placeholder:"Start date"}),(0,h.jsx)("span",{className:"text-gray-400",children:"to"}),(0,h.jsx)("input",{type:"date",value:i.end_date,onChange:e=>n((0,a.A)((0,a.A)({},i),{},{end_date:e.target.value})),className:"px-3 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 [color-scheme:dark]",placeholder:"End date"})]}),(i.start_date||i.end_date)&&(0,h.jsx)(m.A,{variant:"ghost",size:"sm",onClick:()=>n((0,a.A)((0,a.A)({},i),{},{start_date:"",end_date:""})),children:"Clear dates"})]}),s?(0,h.jsx)("div",{className:"text-center py-8 text-gray-400",children:"Loading audit logs..."}):0===e.length?(0,h.jsx)("div",{className:"text-center py-8 text-gray-400",children:"No audit logs found"}):(0,h.jsx)("div",{className:"space-y-3",children:e.map(e=>(0,h.jsxs)("div",{className:"flex items-start gap-4 p-4 rounded-lg bg-white bg-opacity-5 hover:bg-opacity-10 transition",children:[(0,h.jsx)("div",{className:"w-2 h-2 rounded-full mt-2 flex-shrink-0 ".concat(P[e.action]||"bg-gray-500")}),(0,h.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,h.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,h.jsx)("span",{className:"text-white font-medium",children:e.admin_email||"System"}),(0,h.jsx)("span",{className:"px-2 py-0.5 rounded text-xs font-semibold ".concat(P[e.action]||"bg-gray-500"," text-white"),children:e.action}),e.target_type&&(0,h.jsxs)("span",{className:"text-gray-400 text-sm",children:[e.target_type," ",e.target_id?"#".concat(e.target_id):""]})]}),e.details&&(0,h.jsx)("p",{className:"text-gray-400 text-sm mt-1 truncate",children:"string"===typeof e.details?e.details:JSON.stringify(e.details)}),(0,h.jsxs)("div",{className:"flex items-center gap-4 mt-1 text-xs text-gray-500",children:[(0,h.jsx)("span",{children:new Date(e.created_at).toLocaleString()}),e.ip_address&&(0,h.jsxs)("span",{children:["IP: ",e.ip_address]})]})]})]},e.id))})]})})},L=()=>{var e,t,s,a;const[r,i]=(0,l.useState)(null),[n,o]=(0,l.useState)(!0);(0,l.useEffect)(()=>{p()},[]);const p=async()=>{try{o(!0);const e=await d.Kp.getGeoAnalytics();i(e.data)}catch(e){console.error("Failed to load geo-analytics:",e)}finally{o(!1)}};return n?(0,h.jsx)("div",{className:"text-center py-8 text-gray-400",children:"Loading analytics..."}):r?(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,h.jsxs)("h2",{className:"text-2xl font-bold text-white flex items-center",children:[(0,h.jsx)(c.f35,{className:"mr-3 text-blue-400"}),"Geo-Analytics"]}),(0,h.jsx)(m.A,{variant:"outline",size:"sm",icon:(0,h.jsx)(c.DIg,{}),onClick:p,children:"Refresh"})]}),(0,h.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,h.jsxs)("div",{children:[(0,h.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[(0,h.jsx)(c.YXz,{className:"mr-2 text-green-400"})," Active Connections by Country"]}),(null===(e=r.countryDistribution)||void 0===e?void 0:e.length)>0?(0,h.jsx)("div",{className:"space-y-2",children:r.countryDistribution.map((e,t)=>{const s=Math.max(...r.countryDistribution.map(e=>e.connection_count)),a=s>0?e.connection_count/s*100:0;return(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)("span",{className:"text-white w-24 text-sm truncate",children:e.country}),(0,h.jsx)("div",{className:"flex-1 bg-white bg-opacity-10 rounded-full h-5 overflow-hidden",children:(0,h.jsx)("div",{className:"bg-blue-500 h-full rounded-full transition-all",style:{width:"".concat(a,"%")}})}),(0,h.jsxs)("span",{className:"text-gray-400 text-sm w-16 text-right",children:[e.user_count," users"]}),(0,h.jsxs)("span",{className:"text-gray-500 text-xs w-20 text-right",children:[e.connection_count," conns"]})]},t)})}):(0,h.jsx)("p",{className:"text-gray-500",children:"No active connections"})]}),(0,h.jsxs)("div",{children:[(0,h.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[(0,h.jsx)(c.v$b,{className:"mr-2 text-purple-400"})," Protocol Usage"]}),(null===(t=r.protocolUsage)||void 0===t?void 0:t.length)>0?(0,h.jsx)("div",{className:"space-y-3",children:r.protocolUsage.map((e,t)=>{const s=r.protocolUsage.reduce((e,t)=>e+parseInt(t.count),0),a=s>0?parseInt(e.count)/s*100:0,l=["bg-blue-500","bg-green-500","bg-purple-500","bg-yellow-500","bg-red-500","bg-cyan-500"];return(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)("span",{className:"text-white w-28 text-sm capitalize truncate",children:e.protocol||"Unknown"}),(0,h.jsx)("div",{className:"flex-1 bg-white bg-opacity-10 rounded-full h-5 overflow-hidden",children:(0,h.jsx)("div",{className:"".concat(l[t%l.length]," h-full rounded-full transition-all"),style:{width:"".concat(a,"%")}})}),(0,h.jsxs)("span",{className:"text-gray-400 text-sm w-20 text-right",children:[e.count," (",a.toFixed(0),"%)"]})]},t)})}):(0,h.jsx)("p",{className:"text-gray-500",children:"No protocol data"})]})]})]}),(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[(0,h.jsx)(c.vwk,{className:"mr-2 text-orange-400"})," Server Load Distribution"]}),(null===(s=r.serverLoad)||void 0===s?void 0:s.length)>0?(0,h.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.serverLoad.map((e,t)=>{const s=parseFloat(e.load_percent)||0,a=s>90?"bg-red-500":s>70?"bg-yellow-500":"bg-green-500";return(0,h.jsxs)("div",{className:"bg-white bg-opacity-5 rounded-lg p-4",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,h.jsx)("span",{className:"text-white text-sm font-medium truncate",children:e.name}),(0,h.jsx)("span",{className:"text-gray-400 text-xs",children:e.country})]}),(0,h.jsx)("div",{className:"bg-white bg-opacity-10 rounded-full h-3 overflow-hidden mb-1",children:(0,h.jsx)("div",{className:"".concat(a," h-full rounded-full transition-all"),style:{width:"".concat(Math.min(s,100),"%")}})}),(0,h.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,h.jsxs)("span",{children:[e.current_connections,"/",e.capacity]}),(0,h.jsxs)("span",{children:[s.toFixed(1),"%"]})]})]},t)})}):(0,h.jsx)("p",{className:"text-gray-500",children:"No server data"})]}),(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"User Growth (Last 30 Days)"}),(null===(a=r.userGrowth)||void 0===a?void 0:a.length)>0?(0,h.jsx)("div",{className:"flex items-end gap-1 h-32",children:r.userGrowth.map((e,t)=>{const s=Math.max(...r.userGrowth.map(e=>parseInt(e.count))),a=s>0?parseInt(e.count)/s*100:0;return(0,h.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-end group relative",children:[(0,h.jsxs)("div",{className:"absolute -top-6 hidden group-hover:block bg-gray-700 text-white text-xs px-2 py-1 rounded whitespace-nowrap z-10",children:[new Date(e.date).toLocaleDateString(),": ",e.count," users"]}),(0,h.jsx)("div",{className:"w-full bg-blue-500 rounded-t transition-all",style:{height:"".concat(a,"%"),minHeight:a>0?"4px":"0"}})]},t)})}):(0,h.jsx)("p",{className:"text-gray-500",children:"No user growth data"})]})]}):(0,h.jsx)("div",{className:"text-center py-8 text-gray-400",children:"No data available"})},F=()=>{const[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)(!0),[i,n]=(0,l.useState)(null),[o,p]=(0,l.useState)(!1),[u,g]=(0,l.useState)(!1),[b,y]=(0,l.useState)(!1),[j,v]=(0,l.useState)(!1),[N,f]=(0,l.useState)(""),[w,_]=(0,l.useState)({type:"",text:""}),[k,C]=(0,l.useState)(""),[A,S]=(0,l.useState)({subject:"",body_html:"",body_text:""}),D=(0,l.useCallback)((e,t)=>{_({type:e,text:t}),setTimeout(()=>_({type:"",text:""}),4e3)},[]),P=(0,l.useCallback)(async()=>{try{r(!0);const e=await d.Kp.getEmailTemplates();t(e.data.templates||[])}catch(e){console.error("Failed to load templates:",e),D("error","Failed to load email templates")}finally{r(!1)}},[D]);(0,l.useEffect)(()=>{P()},[P]);const T=async e=>{try{const t=(await d.Kp.getEmailTemplate(e)).data.template;n(t),S({subject:t.subject,body_html:t.body_html,body_text:t.body_text||""}),p(!1),g(!1)}catch(t){D("error","Failed to load template")}},L={auth:"bg-blue-600",billing:"bg-green-600",lifecycle:"bg-yellow-600",support:"bg-purple-600",security:"bg-red-600"},F=e.filter(e=>e.name.toLowerCase().includes(k.toLowerCase())||e.slug.toLowerCase().includes(k.toLowerCase())||(e.category||"").toLowerCase().includes(k.toLowerCase())).reduce((e,t)=>{const s=t.category||"other";return e[s]||(e[s]=[]),e[s].push(t),e},{});return s?(0,h.jsxs)("div",{className:"flex items-center justify-center py-20 text-gray-400",children:[(0,h.jsx)(c.hW,{className:"animate-spin mr-2"})," Loading email templates..."]}):(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("h2",{className:"text-3xl font-bold text-white",children:"Email Templates"}),(0,h.jsxs)("p",{className:"text-gray-400 mt-1",children:["Manage all outgoing email templates. Use ","{{variables}}"," for dynamic content."]})]}),w.text&&(0,h.jsx)("div",{className:"px-4 py-2 rounded-lg text-white text-sm ".concat("success"===w.type?"bg-green-600":"bg-red-600"),children:w.text})]}),(0,h.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,h.jsxs)("div",{className:"lg:col-span-1 space-y-4",children:[(0,h.jsxs)("div",{className:"relative",children:[(0,h.jsx)(c.KSO,{className:"absolute left-3 top-3 text-gray-400"}),(0,h.jsx)("input",{type:"text",value:k,onChange:e=>C(e.target.value),placeholder:"Search templates...",className:"w-full pl-10 pr-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,h.jsx)("div",{className:"space-y-3 max-h-[70vh] overflow-y-auto pr-2",children:Object.entries(F).map(e=>{let[t,s]=e;return(0,h.jsxs)("div",{children:[(0,h.jsx)("h4",{className:"text-xs uppercase tracking-wider text-gray-400 mb-2 px-1",children:t}),s.map(e=>(0,h.jsxs)("button",{onClick:()=>T(e.slug),className:"w-full text-left p-3 rounded-lg mb-2 transition border ".concat((null===i||void 0===i?void 0:i.slug)===e.slug?"bg-blue-600 bg-opacity-30 border-blue-500":"bg-white bg-opacity-5 border-transparent hover:bg-white hover:bg-opacity-10"),children:[(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsx)("span",{className:"text-white font-medium text-sm",children:e.name}),(0,h.jsx)("span",{className:"w-2 h-2 rounded-full ".concat(e.is_active?"bg-green-400":"bg-red-400")})]}),(0,h.jsx)("p",{className:"text-gray-400 text-xs mt-1 truncate",children:e.description}),(0,h.jsx)("div",{className:"flex items-center gap-2 mt-2",children:(0,h.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full text-white ".concat(L[e.category]||"bg-gray-600"),children:e.category})})]},e.slug))]},t)})})]}),(0,h.jsx)("div",{className:"lg:col-span-2",children:i?(0,h.jsxs)(x.A,{className:"p-6 space-y-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-start flex-wrap gap-3",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("h3",{className:"text-2xl font-bold text-white",children:i.name}),(0,h.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:i.description}),(0,h.jsxs)("span",{className:"text-xs text-gray-500 font-mono",children:["slug: ",i.slug]})]}),(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsxs)("button",{onClick:()=>(async e=>{try{await d.Kp.toggleEmailTemplate(e),await P(),(null===i||void 0===i?void 0:i.slug)===e&&await T(e),D("success","Template toggled")}catch(t){D("error","Failed to toggle template")}})(i.slug),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-sm transition ".concat(i.is_active?"bg-green-600 bg-opacity-30 text-green-300 hover:bg-opacity-50":"bg-red-600 bg-opacity-30 text-red-300 hover:bg-opacity-50"),children:[i.is_active?(0,h.jsx)(c.RIx,{}):(0,h.jsx)(c.jZj,{}),i.is_active?"Active":"Disabled"]}),o?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(m.A,{variant:"primary",onClick:async()=>{if(i)try{y(!0),await d.Kp.updateEmailTemplate(i.slug,A),D("success","Template saved successfully"),p(!1),await P(),await T(i.slug)}catch(e){D("error","Failed to save template")}finally{y(!1)}},disabled:b,children:[b?(0,h.jsx)(c.hW,{className:"animate-spin mr-1"}):(0,h.jsx)(c.CMH,{className:"mr-1"}),"Save"]}),(0,h.jsxs)(m.A,{variant:"secondary",onClick:()=>{p(!1),S({subject:i.subject,body_html:i.body_html,body_text:i.body_text||""})},children:[(0,h.jsx)(c.QCr,{className:"mr-1"})," Cancel"]})]}):(0,h.jsxs)(m.A,{variant:"primary",onClick:()=>p(!0),children:[(0,h.jsx)(c.uO9,{className:"mr-1"})," Edit"]})]})]}),(0,h.jsxs)("div",{className:"bg-blue-900 bg-opacity-30 border border-blue-700 rounded-lg p-4",children:[(0,h.jsxs)("div",{className:"flex items-center gap-2 text-blue-300 font-medium mb-2",children:[(0,h.jsx)(c.FSj,{})," Available Variables"]}),(0,h.jsx)("div",{className:"flex flex-wrap gap-2",children:(i.available_variables||[]).map(e=>(0,h.jsx)("span",{className:"text-xs font-mono bg-blue-800 bg-opacity-50 text-blue-200 px-2 py-1 rounded cursor-pointer hover:bg-opacity-80 transition",onClick:()=>{o&&(navigator.clipboard.writeText("{{".concat(e,"}}")),D("success","Copied {{".concat(e,"}} to clipboard")))},title:o?"Click to copy {{".concat(e,"}}"):e,children:"{{".concat(e,"}}")},e))}),(0,h.jsxs)("p",{className:"text-gray-400 text-xs mt-2",children:[(0,h.jsx)(c.__w,{className:"inline mr-1"}),"Global: ","{{app_name}}, {{year}}, {{support_email}}, {{frontend_url}}"," are always available.",o&&" Click a variable to copy it."]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2 font-medium",children:"Subject Line"}),o?(0,h.jsx)("input",{type:"text",value:A.subject,onChange:e=>S(t=>(0,a.A)((0,a.A)({},t),{},{subject:e.target.value})),className:"w-full px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}):(0,h.jsx)("div",{className:"px-4 py-2 rounded-lg bg-white bg-opacity-5 text-gray-200 font-mono text-sm",children:i.subject})]}),(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,h.jsx)("label",{className:"text-gray-300 font-medium",children:"HTML Body"}),!o&&(0,h.jsxs)("button",{onClick:()=>g(!u),className:"text-sm text-blue-400 hover:text-blue-300 flex items-center gap-1",children:[(0,h.jsx)(c.Ny1,{})," ",u?"Show Source":"Preview"]})]}),o?(0,h.jsx)("textarea",{value:A.body_html,onChange:e=>S(t=>(0,a.A)((0,a.A)({},t),{},{body_html:e.target.value})),rows:16,className:"w-full px-4 py-3 rounded-lg bg-gray-900 border border-white border-opacity-20 text-green-300 font-mono text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 resize-y",spellCheck:!1}):u?(0,h.jsx)("div",{className:"bg-white rounded-lg p-4 max-h-96 overflow-auto",children:(0,h.jsx)("iframe",{title:"Email Preview",sandbox:"",srcDoc:i.body_html,style:{width:"100%",minHeight:"300px",border:"none"}})}):(0,h.jsx)("pre",{className:"bg-gray-900 rounded-lg p-4 text-green-300 text-xs font-mono max-h-96 overflow-auto whitespace-pre-wrap",children:i.body_html})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2 font-medium",children:"Plain Text Body (fallback)"}),o?(0,h.jsx)("textarea",{value:A.body_text,onChange:e=>S(t=>(0,a.A)((0,a.A)({},t),{},{body_text:e.target.value})),rows:6,className:"w-full px-4 py-3 rounded-lg bg-gray-900 border border-white border-opacity-20 text-gray-200 font-mono text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 resize-y"}):(0,h.jsx)("pre",{className:"bg-gray-900 rounded-lg p-4 text-gray-300 text-xs font-mono max-h-48 overflow-auto whitespace-pre-wrap",children:i.body_text||"(not set \u2014 HTML only)"})]}),(0,h.jsxs)("div",{className:"border-t border-white border-opacity-10 pt-4",children:[(0,h.jsxs)("label",{className:"block text-gray-300 mb-2 font-medium",children:[(0,h.jsx)(c.Cer,{className:"inline mr-1"})," Send Test Email"]}),(0,h.jsxs)("div",{className:"flex gap-3",children:[(0,h.jsx)("input",{type:"email",value:N,onChange:e=>f(e.target.value),placeholder:"recipient@example.com",className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsx)(m.A,{variant:"primary",onClick:async()=>{if(i&&N)try{v(!0),await d.Kp.testEmailTemplate(i.slug,N),D("success","Test email sent to ".concat(N)),f("")}catch(s){var e,t;D("error",(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Failed to send test email")}finally{v(!1)}},disabled:j||!N,children:j?(0,h.jsx)(c.hW,{className:"animate-spin"}):"Send Test"})]}),(0,h.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"Sends this template with sample data to the specified email."})]})]}):(0,h.jsxs)(x.A,{className:"p-12 text-center",children:[(0,h.jsx)(c.maD,{className:"text-6xl text-gray-600 mx-auto mb-4"}),(0,h.jsx)("p",{className:"text-gray-400 text-lg",children:"Select a template to view or edit"})]})})]})]})},R=e=>{let{title:t,content:s,type:a}=e;const l={info:{bg:"bg-blue-600 bg-opacity-20",border:"border-blue-500",text:"text-blue-200"},warning:{bg:"bg-yellow-600 bg-opacity-20",border:"border-yellow-500",text:"text-yellow-200"},success:{bg:"bg-green-600 bg-opacity-20",border:"border-green-500",text:"text-green-200"},error:{bg:"bg-red-600 bg-opacity-20",border:"border-red-500",text:"text-red-200"},maintenance:{bg:"bg-orange-600 bg-opacity-20",border:"border-orange-500",text:"text-orange-200"}},r=l[a]||l.info;return(0,h.jsx)("div",{className:"".concat(r.bg," border ").concat(r.border," rounded-lg p-4"),children:(0,h.jsxs)("div",{className:"flex items-start justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("h5",{className:"".concat(r.text," font-bold"),children:t||"Announcement Title"}),(0,h.jsx)("p",{className:"".concat(r.text," text-sm mt-1 opacity-80"),children:s||"Announcement content will appear here..."})]}),(0,h.jsx)("button",{className:"".concat(r.text," opacity-50 hover:opacity-100"),children:(0,h.jsx)(c.QCr,{})})]})})},E=()=>{const[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)(!0),[i,n]=(0,l.useState)(null),[o,p]=(0,l.useState)(!1),[u,g]=(0,l.useState)({type:"",text:""}),b={title:"",content:"",type:"info",target_audience:"all",is_active:!0,show_in_app:!0,show_on_website:!1,priority:0,starts_at:"",ends_at:""},[y,N]=(0,l.useState)(b),{confirm:f,dialogProps:w}=(0,j.A)(),_=(0,l.useCallback)((e,t)=>{g({type:e,text:t}),setTimeout(()=>g({type:"",text:""}),4e3)},[]),k=(0,l.useCallback)(async()=>{try{r(!0);const e=await d.Kp.getAnnouncements();t(e.data.announcements||[])}catch(e){console.error("Failed to load announcements:",e),_("error","Failed to load announcements")}finally{r(!1)}},[_]);(0,l.useEffect)(()=>{k()},[k]);const C=()=>{N(b),n("new")},A=async()=>{if(y.title.trim()&&y.content.trim())try{p(!0);const e=(0,a.A)((0,a.A)({},y),{},{starts_at:y.starts_at||null,ends_at:y.ends_at||null});"new"===i?(await d.Kp.createAnnouncement(e),_("success","Announcement created")):(await d.Kp.updateAnnouncement(i,e),_("success","Announcement updated")),n(null),await k()}catch(s){var e,t;_("error",(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Failed to save announcement")}finally{p(!1)}else _("error","Title and content are required")},S={info:{icon:c.__w,color:"blue",label:"Info"},warning:{icon:c.BS8,color:"yellow",label:"Warning"},success:{icon:c.A7C,color:"green",label:"Success"},error:{icon:c.BS8,color:"red",label:"Error/Urgent"},maintenance:{icon:c.w_X,color:"orange",label:"Maintenance"}},D="w-full px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500";return s?(0,h.jsxs)("div",{className:"flex items-center justify-center py-20 text-gray-400",children:[(0,h.jsx)(c.hW,{className:"animate-spin mr-2"})," Loading announcements..."]}):null!==i?(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center",children:[(0,h.jsx)("h2",{className:"text-3xl font-bold text-white",children:"new"===i?"Create Announcement":"Edit Announcement"}),(0,h.jsxs)(m.A,{variant:"secondary",onClick:()=>n(null),children:[(0,h.jsx)(c.QCr,{className:"mr-1"})," Cancel"]})]}),(0,h.jsxs)(x.A,{className:"p-6 space-y-5",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2 font-medium",children:"Title *"}),(0,h.jsx)("input",{type:"text",value:y.title,onChange:e=>N(t=>(0,a.A)((0,a.A)({},t),{},{title:e.target.value})),placeholder:"Announcement title...",className:D})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2 font-medium",children:"Content *"}),(0,h.jsx)("textarea",{value:y.content,onChange:e=>N(t=>(0,a.A)((0,a.A)({},t),{},{content:e.target.value})),rows:4,placeholder:"Announcement message...",className:"".concat(D," resize-y")})]}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2 font-medium",children:"Type"}),(0,h.jsx)("select",{value:y.type,onChange:e=>N(t=>(0,a.A)((0,a.A)({},t),{},{type:e.target.value})),className:D,children:Object.entries(S).map(e=>{let[t,s]=e;return(0,h.jsx)("option",{value:t,children:s.label},t)})})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2 font-medium",children:"Target Audience"}),(0,h.jsxs)("select",{value:y.target_audience,onChange:e=>N(t=>(0,a.A)((0,a.A)({},t),{},{target_audience:e.target.value})),className:D,children:[(0,h.jsx)("option",{value:"all",children:"All Users"}),(0,h.jsx)("option",{value:"free",children:"Free Users"}),(0,h.jsx)("option",{value:"premium",children:"Premium Users"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2 font-medium",children:"Priority"}),(0,h.jsx)("input",{type:"number",value:y.priority,onChange:e=>N(t=>(0,a.A)((0,a.A)({},t),{},{priority:parseInt(e.target.value)||0})),className:D,min:"0",max:"100"}),(0,h.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"Higher = shown first"})]})]}),(0,h.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[{key:"is_active",label:"Active",desc:"Announcement is live"},{key:"show_in_app",label:"Show in App",desc:"Visible in mobile app",icon:c.rle},{key:"show_on_website",label:"Show on Website",desc:"Visible on website",icon:c.f35}].map(e=>{let{key:t,label:s,desc:l,icon:r}=e;return(0,h.jsxs)("div",{className:"bg-white bg-opacity-5 rounded-lg p-4",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[r&&(0,h.jsx)(r,{className:"text-gray-400"}),(0,h.jsx)("span",{className:"text-white font-medium",children:s})]}),(0,h.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,h.jsx)("input",{type:"checkbox",checked:y[t],onChange:e=>N(s=>(0,a.A)((0,a.A)({},s),{},{[t]:e.target.checked})),className:"sr-only peer"}),(0,h.jsx)("div",{className:"w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(0,h.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:l})]},t)})}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsxs)("label",{className:"block text-gray-300 mb-2 font-medium",children:[(0,h.jsx)(c.w_X,{className:"inline mr-1"})," Start Date (optional)"]}),(0,h.jsx)("input",{type:"datetime-local",value:y.starts_at,onChange:e=>N(t=>(0,a.A)((0,a.A)({},t),{},{starts_at:e.target.value})),className:D})]}),(0,h.jsxs)("div",{children:[(0,h.jsxs)("label",{className:"block text-gray-300 mb-2 font-medium",children:[(0,h.jsx)(c.w_X,{className:"inline mr-1"})," End Date (optional)"]}),(0,h.jsx)("input",{type:"datetime-local",value:y.ends_at,onChange:e=>N(t=>(0,a.A)((0,a.A)({},t),{},{ends_at:e.target.value})),className:D})]})]}),(0,h.jsx)("p",{className:"text-gray-500 text-xs",children:"Leave dates empty for the announcement to show immediately with no expiration."}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-gray-300 mb-2 font-medium",children:"Preview"}),(0,h.jsx)(R,{title:y.title,content:y.content,type:y.type})]}),(0,h.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-white border-opacity-10",children:[(0,h.jsx)(m.A,{variant:"secondary",onClick:()=>n(null),children:"Cancel"}),(0,h.jsxs)(m.A,{variant:"primary",onClick:A,disabled:o,children:[o?(0,h.jsx)(c.hW,{className:"animate-spin mr-1"}):(0,h.jsx)(c.CMH,{className:"mr-1"}),"new"===i?"Create":"Save Changes"]})]})]})]}):(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("h2",{className:"text-3xl font-bold text-white",children:"Announcements"}),(0,h.jsx)("p",{className:"text-gray-400 mt-1",children:"Manage in-app and website announcements shown to users."})]}),(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[u.text&&(0,h.jsx)("div",{className:"px-4 py-2 rounded-lg text-white text-sm ".concat("success"===u.type?"bg-green-600":"bg-red-600"),children:u.text}),(0,h.jsxs)(m.A,{variant:"primary",onClick:C,children:[(0,h.jsx)(c.OiG,{className:"mr-1"})," New Announcement"]})]})]}),0===e.length?(0,h.jsxs)(x.A,{className:"p-12 text-center",children:[(0,h.jsx)(c.sdT,{className:"text-6xl text-gray-600 mx-auto mb-4"}),(0,h.jsx)("p",{className:"text-gray-400 text-lg mb-4",children:"No announcements yet"}),(0,h.jsxs)(m.A,{variant:"primary",onClick:C,children:[(0,h.jsx)(c.OiG,{className:"mr-1"})," Create First Announcement"]})]}):(0,h.jsx)("div",{className:"space-y-4",children:e.map(e=>{const t=S[e.type]||S.info,s=t.icon,a=e.ends_at&&new Date(e.ends_at)<new Date,l=e.starts_at&&new Date(e.starts_at)>new Date;return(0,h.jsx)(x.A,{className:"p-5",children:(0,h.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,h.jsxs)("div",{className:"flex items-start gap-3 flex-1",children:[(0,h.jsx)("div",{className:"p-2 rounded-lg bg-".concat(t.color,"-600 bg-opacity-20 mt-1"),children:(0,h.jsx)(s,{className:"text-".concat(t.color,"-400")})}),(0,h.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,h.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,h.jsx)("h4",{className:"text-white font-bold text-lg",children:e.title}),(0,h.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full text-white bg-".concat(t.color,"-600"),children:t.label}),e.is_active&&!a&&!l&&(0,h.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-green-600 text-white",children:"LIVE"}),l&&(0,h.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-yellow-600 text-white",children:"SCHEDULED"}),a&&(0,h.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-gray-600 text-white",children:"EXPIRED"}),!e.is_active&&(0,h.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-red-600 text-white",children:"DISABLED"})]}),(0,h.jsx)("p",{className:"text-gray-300 text-sm mt-1 line-clamp-2",children:e.content}),(0,h.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500",children:[e.show_in_app&&(0,h.jsxs)("span",{className:"flex items-center gap-1",children:[(0,h.jsx)(c.rle,{})," App"]}),e.show_on_website&&(0,h.jsxs)("span",{className:"flex items-center gap-1",children:[(0,h.jsx)(c.f35,{})," Website"]}),(0,h.jsxs)("span",{children:[e.target_audience||"all"," users"]}),e.starts_at&&(0,h.jsxs)("span",{children:["From: ",new Date(e.starts_at).toLocaleDateString()]}),e.ends_at&&(0,h.jsxs)("span",{children:["Until: ",new Date(e.ends_at).toLocaleDateString()]})]})]})]}),(0,h.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[(0,h.jsx)("button",{onClick:()=>(async e=>{try{await d.Kp.toggleAnnouncement(e),await k(),_("success","Announcement toggled")}catch(t){_("error","Failed to toggle announcement")}})(e.id),className:"p-2 rounded-lg transition ".concat(e.is_active?"text-green-400 hover:bg-green-600 hover:bg-opacity-20":"text-gray-500 hover:bg-gray-600 hover:bg-opacity-20"),title:e.is_active?"Deactivate":"Activate",children:e.is_active?(0,h.jsx)(c.RIx,{size:20}):(0,h.jsx)(c.jZj,{size:20})}),(0,h.jsx)("button",{onClick:()=>(e=>{N({title:e.title,content:e.content,type:e.type||"info",target_audience:e.target_audience||"all",is_active:e.is_active,show_in_app:!1!==e.show_in_app,show_on_website:e.show_on_website||!1,priority:e.priority||0,starts_at:e.starts_at?e.starts_at.slice(0,16):"",ends_at:e.ends_at?e.ends_at.slice(0,16):""}),n(e.id)})(e),className:"p-2 rounded-lg text-blue-400 hover:bg-blue-600 hover:bg-opacity-20 transition",title:"Edit",children:(0,h.jsx)(c.uO9,{})}),(0,h.jsx)("button",{onClick:()=>(async e=>{if(await f({title:"Delete Announcement",message:"Delete this announcement?",confirmText:"Delete",variant:"danger"}))try{await d.Kp.deleteAnnouncement(e),_("success","Announcement deleted"),await k()}catch(t){_("error","Failed to delete announcement")}})(e.id),className:"p-2 rounded-lg text-red-400 hover:bg-red-600 hover:bg-opacity-20 transition",title:"Delete",children:(0,h.jsx)(c.qbC,{})})]})]})},e.id)})}),(0,h.jsx)(v.A,(0,a.A)({},w))]})},U=e=>{let{label:t,value:s,badge:a}=e;const l={green:"bg-green-500/20 text-green-300",red:"bg-red-500/20 text-red-300",purple:"bg-purple-500/20 text-purple-300",yellow:"bg-yellow-500/20 text-yellow-300",gray:"bg-gray-500/20 text-gray-300"};return(0,h.jsxs)("div",{className:"p-3 bg-gray-700/30 rounded-lg",children:[(0,h.jsx)("p",{className:"text-gray-400 text-xs mb-1",children:t}),a?(0,h.jsx)("span",{className:"px-2 py-1 rounded text-sm font-medium ".concat(l[a]||l.gray),children:s}):(0,h.jsx)("p",{className:"text-white text-sm font-medium truncate",children:s})]})},I=e=>{var t,s,r,i,n;let{isOpen:o,onClose:x,userId:m,onRefresh:p}=e;const[u,g]=(0,l.useState)(null),[b,y]=(0,l.useState)(!0),[N,f]=(0,l.useState)("overview"),[w,_]=(0,l.useState)({show:!1,password:"",loading:!1}),[k,C]=(0,l.useState)({show:!1,planType:"1month",durationDays:30,bonusMonths:0,loading:!1}),[A,S]=(0,l.useState)(null),{confirm:D,dialogProps:P}=(0,j.A)();(0,l.useEffect)(()=>{o&&m&&T()},[o,m]);const T=async()=>{y(!0);try{const e=await d.Kp.getUserDetails(m);g(e.data)}catch(e){console.error("Failed to load user details:",e)}finally{y(!1)}};if(!o)return null;const L=e=>e?new Date(e).toLocaleString():"N/A",F=e=>{if(!e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toFixed(1)+" "+["B","KB","MB","GB"][t]},R=[{id:"overview",name:"Overview",icon:c.x$1},{id:"subscription",name:"Subscription",icon:c.Hu1},{id:"connections",name:"Connections",icon:c.nVN},{id:"payments",name:"Payments",icon:c.Tsk},{id:"tickets",name:"Tickets",icon:c.tVd},{id:"actions",name:"Actions",icon:c.SMR}],E=null===u||void 0===u?void 0:u.user;return(0,h.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4",onClick:x,children:[(0,h.jsxs)("div",{className:"bg-gray-800 rounded-xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,h.jsxs)("div",{className:"flex items-center justify-between p-5 border-b border-gray-700",children:[(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:(0,h.jsx)(c.x$1,{className:"text-white"})}),(0,h.jsxs)("div",{children:[(0,h.jsx)("h2",{className:"text-xl font-bold text-white",children:(null===E||void 0===E?void 0:E.email)||"Loading..."}),(0,h.jsx)("p",{className:"text-sm text-gray-400",children:"User Details"})]})]}),(0,h.jsx)("button",{onClick:x,className:"text-gray-400 hover:text-white p-2",children:(0,h.jsx)(c.QCr,{size:20})})]}),A&&(0,h.jsxs)("div",{className:"mx-5 mt-3 p-3 rounded-lg text-sm ".concat("success"===A.type?"bg-green-500/20 text-green-300 border border-green-500/30":"bg-red-500/20 text-red-300 border border-red-500/30"),children:[A.text,(0,h.jsx)("button",{onClick:()=>S(null),className:"ml-3 font-bold",children:"\xd7"})]}),(0,h.jsx)("div",{className:"flex gap-1 p-3 border-b border-gray-700 overflow-x-auto",children:R.map(e=>(0,h.jsxs)("button",{onClick:()=>f(e.id),className:"flex items-center gap-2 px-3 py-2 rounded-lg text-sm whitespace-nowrap transition ".concat(N===e.id?"bg-blue-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-white"),children:[(0,h.jsx)(e.icon,{size:14})," ",e.name]},e.id))}),(0,h.jsx)("div",{className:"flex-1 overflow-y-auto p-5",children:b?(0,h.jsx)("div",{className:"flex justify-center py-12",children:(0,h.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):u?(0,h.jsxs)(h.Fragment,{children:["overview"===N&&(0,h.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,h.jsx)(U,{label:"Email",value:E.email}),(0,h.jsx)(U,{label:"Tier",value:E.tier,badge:"paid"===E.tier?"purple":"admin"===E.tier?"yellow":"gray"}),(0,h.jsx)(U,{label:"Status",value:E.status,badge:"active"===E.status?"green":"red"}),(0,h.jsx)(U,{label:"Email Verified",value:E.email_verified?"Yes":"No",badge:E.email_verified?"green":"red"}),(0,h.jsx)(U,{label:"2FA Enabled",value:E.totp_enabled?"Yes":"No",badge:E.totp_enabled?"green":"gray"}),(0,h.jsx)(U,{label:"Referral Code",value:E.referral_code||"None"}),(0,h.jsx)(U,{label:"Created",value:L(E.created_at)}),(0,h.jsx)(U,{label:"Last Login",value:L(E.last_login)})]}),"subscription"===N&&(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,h.jsx)(U,{label:"Plan Type",value:E.plan_type||"None"}),(0,h.jsx)(U,{label:"Days Remaining",value:(null===(t=E.days_remaining)||void 0===t?void 0:t.toString())||"0"}),(0,h.jsx)(U,{label:"Start Date",value:L(E.subscription_start_date)}),(0,h.jsx)(U,{label:"End Date",value:L(E.subscription_end_date)}),(0,h.jsx)(U,{label:"Bonus Months",value:(E.bonus_months||0).toString()}),(0,h.jsx)(U,{label:"Auto Renew",value:E.auto_renew?"Yes":"No"})]}),(0,h.jsxs)("div",{className:"mt-6 p-4 bg-gray-700/50 rounded-lg",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,h.jsxs)("h3",{className:"text-white font-semibold flex items-center gap-2",children:[(0,h.jsx)(c.Wp,{})," Grant/Extend Subscription"]}),(0,h.jsx)("button",{onClick:()=>C(e=>(0,a.A)((0,a.A)({},e),{},{show:!e.show})),className:"text-sm text-blue-400 hover:text-blue-300",children:k.show?"Cancel":"Open"})]}),k.show&&(0,h.jsxs)("div",{className:"space-y-3",children:[(0,h.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"text-gray-400 text-sm",children:"Plan Type"}),(0,h.jsxs)("select",{value:k.planType,onChange:e=>C(t=>(0,a.A)((0,a.A)({},t),{},{planType:e.target.value})),className:"w-full mt-1 px-3 py-2 rounded bg-gray-600 text-white text-sm border border-gray-500",children:[(0,h.jsx)("option",{value:"1month",children:"1 Month"}),(0,h.jsx)("option",{value:"3month",children:"3 Months"}),(0,h.jsx)("option",{value:"6month",children:"6 Months"}),(0,h.jsx)("option",{value:"12month",children:"12 Months"}),(0,h.jsx)("option",{value:"manual",children:"Manual/Custom"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"text-gray-400 text-sm",children:"Duration (days)"}),(0,h.jsx)("input",{type:"number",value:k.durationDays,onChange:e=>C(t=>(0,a.A)((0,a.A)({},t),{},{durationDays:e.target.value})),className:"w-full mt-1 px-3 py-2 rounded bg-gray-600 text-white text-sm border border-gray-500"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"text-gray-400 text-sm",children:"Bonus Months"}),(0,h.jsx)("input",{type:"number",value:k.bonusMonths,onChange:e=>C(t=>(0,a.A)((0,a.A)({},t),{},{bonusMonths:e.target.value})),className:"w-full mt-1 px-3 py-2 rounded bg-gray-600 text-white text-sm border border-gray-500"})]})]}),(0,h.jsx)("button",{onClick:async()=>{var e;if(await D({title:"Grant Subscription",message:"Grant ".concat(k.planType," subscription (").concat(k.durationDays," days, ").concat(k.bonusMonths," bonus months) to ").concat(null===u||void 0===u||null===(e=u.user)||void 0===e?void 0:e.email,"?"),confirmText:"Grant Subscription",variant:"warning"})){C(e=>(0,a.A)((0,a.A)({},e),{},{loading:!0}));try{const e=await d.Kp.adminGrantSubscription(m,{planType:k.planType,durationDays:parseInt(k.durationDays),bonusMonths:parseInt(k.bonusMonths)});S({type:"success",text:e.data.message}),C({show:!1,planType:"1month",durationDays:30,bonusMonths:0,loading:!1}),T(),p&&p()}catch(l){var t,s;S({type:"error",text:(null===(t=l.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||"Failed to grant subscription"}),C(e=>(0,a.A)((0,a.A)({},e),{},{loading:!1}))}}},disabled:k.loading,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded text-sm font-medium disabled:opacity-50",children:k.loading?"Granting...":"Grant Subscription"})]})]})]}),"connections"===N&&(0,h.jsxs)("div",{className:"space-y-4",children:[(null===(s=u.activeConnections)||void 0===s?void 0:s.length)>0&&(0,h.jsxs)("div",{children:[(0,h.jsxs)("h3",{className:"text-green-400 font-semibold mb-2",children:["Active Connections (",u.activeConnections.length,")"]}),(0,h.jsxs)("table",{className:"w-full text-sm",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-gray-600 text-gray-400",children:[(0,h.jsx)("th",{className:"text-left py-2",children:"Server"}),(0,h.jsx)("th",{className:"text-left py-2",children:"Protocol"}),(0,h.jsx)("th",{className:"text-left py-2",children:"Connected"})]})}),(0,h.jsx)("tbody",{children:u.activeConnections.map(e=>(0,h.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,h.jsx)("td",{className:"py-2 text-white",children:e.server_name||e.server_id}),(0,h.jsx)("td",{className:"py-2",children:(0,h.jsx)("span",{className:"px-2 py-0.5 bg-blue-500/20 text-blue-300 rounded text-xs",children:e.protocol})}),(0,h.jsx)("td",{className:"py-2 text-gray-300",children:L(e.connected_at)})]},e.id))})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("h3",{className:"text-gray-300 font-semibold mb-2",children:"Connection History (last 20)"}),(null===(r=u.connections)||void 0===r?void 0:r.length)>0?(0,h.jsxs)("table",{className:"w-full text-sm",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-gray-600 text-gray-400",children:[(0,h.jsx)("th",{className:"text-left py-2",children:"Server"}),(0,h.jsx)("th",{className:"text-left py-2",children:"Protocol"}),(0,h.jsx)("th",{className:"text-left py-2",children:"Connected"}),(0,h.jsx)("th",{className:"text-left py-2",children:"Disconnected"}),(0,h.jsx)("th",{className:"text-left py-2",children:"Data"})]})}),(0,h.jsx)("tbody",{children:u.connections.map(e=>(0,h.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,h.jsx)("td",{className:"py-2 text-white",children:e.server_name||e.server_id}),(0,h.jsx)("td",{className:"py-2",children:(0,h.jsx)("span",{className:"px-2 py-0.5 bg-blue-500/20 text-blue-300 rounded text-xs",children:e.protocol})}),(0,h.jsx)("td",{className:"py-2 text-gray-300",children:L(e.connected_at)}),(0,h.jsx)("td",{className:"py-2 text-gray-300",children:L(e.disconnected_at)}),(0,h.jsx)("td",{className:"py-2 text-gray-300",children:F((e.bytes_sent||0)+(e.bytes_received||0))})]},e.id))})]}):(0,h.jsx)("p",{className:"text-gray-500 text-sm",children:"No connection history"})]})]}),"payments"===N&&(0,h.jsx)("div",{children:(null===(i=u.payments)||void 0===i?void 0:i.length)>0?(0,h.jsxs)("table",{className:"w-full text-sm",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-gray-600 text-gray-400",children:[(0,h.jsx)("th",{className:"text-left py-2",children:"Date"}),(0,h.jsx)("th",{className:"text-left py-2",children:"Plan"}),(0,h.jsx)("th",{className:"text-left py-2",children:"Amount"}),(0,h.jsx)("th",{className:"text-left py-2",children:"Status"}),(0,h.jsx)("th",{className:"text-left py-2",children:"Stripe ID"})]})}),(0,h.jsx)("tbody",{children:u.payments.map(e=>{var t,s;return(0,h.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,h.jsx)("td",{className:"py-2 text-gray-300",children:L(e.created_at)}),(0,h.jsx)("td",{className:"py-2 text-white",children:e.plan_type}),(0,h.jsxs)("td",{className:"py-2 text-green-400",children:["$",(e.amount/100).toFixed(2)," ",null===(t=e.currency)||void 0===t?void 0:t.toUpperCase()]}),(0,h.jsx)("td",{className:"py-2",children:(0,h.jsx)("span",{className:"px-2 py-0.5 rounded text-xs ".concat("succeeded"===e.status?"bg-green-500/20 text-green-300":"bg-yellow-500/20 text-yellow-300"),children:e.status})}),(0,h.jsx)("td",{className:"py-2 text-gray-400 font-mono text-xs",children:(null===(s=e.stripe_payment_id)||void 0===s?void 0:s.slice(0,20))||"-"})]},e.id)})})]}):(0,h.jsx)("p",{className:"text-gray-500 text-sm",children:"No payment history"})}),"tickets"===N&&(0,h.jsx)("div",{children:(null===(n=u.tickets)||void 0===n?void 0:n.length)>0?(0,h.jsxs)("table",{className:"w-full text-sm",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-gray-600 text-gray-400",children:[(0,h.jsx)("th",{className:"text-left py-2",children:"#"}),(0,h.jsx)("th",{className:"text-left py-2",children:"Subject"}),(0,h.jsx)("th",{className:"text-left py-2",children:"Status"}),(0,h.jsx)("th",{className:"text-left py-2",children:"Priority"}),(0,h.jsx)("th",{className:"text-left py-2",children:"Date"})]})}),(0,h.jsx)("tbody",{children:u.tickets.map(e=>(0,h.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,h.jsxs)("td",{className:"py-2 text-blue-400",children:["#",e.ticket_number]}),(0,h.jsx)("td",{className:"py-2 text-white",children:e.subject}),(0,h.jsx)("td",{className:"py-2",children:(0,h.jsx)("span",{className:"px-2 py-0.5 rounded text-xs ".concat("resolved"===e.status?"bg-green-500/20 text-green-300":"open"===e.status?"bg-blue-500/20 text-blue-300":"bg-yellow-500/20 text-yellow-300"),children:e.status})}),(0,h.jsx)("td",{className:"py-2 text-gray-300",children:e.priority}),(0,h.jsx)("td",{className:"py-2 text-gray-400",children:L(e.created_at)})]},e.id))})]}):(0,h.jsx)("p",{className:"text-gray-500 text-sm",children:"No tickets"})}),"actions"===N&&(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"p-4 bg-gray-700/50 rounded-lg",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,h.jsxs)("h3",{className:"text-white font-semibold flex items-center gap-2",children:[(0,h.jsx)(c.pXu,{})," Reset Password"]}),(0,h.jsx)("button",{onClick:()=>_(e=>(0,a.A)((0,a.A)({},e),{},{show:!e.show})),className:"text-sm text-blue-400 hover:text-blue-300",children:w.show?"Cancel":"Reset"})]}),w.show&&(0,h.jsxs)("div",{className:"flex gap-3",children:[(0,h.jsx)("input",{type:"text",placeholder:"Min 8 chars, upper + number + special",value:w.password,onChange:e=>_(t=>(0,a.A)((0,a.A)({},t),{},{password:e.target.value})),className:"flex-1 px-3 py-2 rounded bg-gray-600 text-white text-sm border border-gray-500"}),(0,h.jsx)("button",{onClick:async()=>{var e;const t=w.password;if(!t||t.length<8)return void S({type:"error",text:"Password must be at least 8 characters"});if(!/[A-Z]/.test(t))return void S({type:"error",text:"Password must contain at least one uppercase letter"});if(!/[0-9]/.test(t))return void S({type:"error",text:"Password must contain at least one number"});if(!/[!@#$%^&*()_+\-=[\]{};':"|,.<>/?]/.test(t))return void S({type:"error",text:"Password must contain at least one special character"});if(await D({title:"Reset Password",message:"Are you sure you want to reset the password for ".concat(null===u||void 0===u||null===(e=u.user)||void 0===e?void 0:e.email,"?"),confirmText:"Reset Password",variant:"warning"})){_(e=>(0,a.A)((0,a.A)({},e),{},{loading:!0}));try{const e=await d.Kp.adminResetPassword(m,w.password);S({type:"success",text:e.data.message}),_({show:!1,password:"",loading:!1})}catch(r){var s,l;S({type:"error",text:(null===(s=r.response)||void 0===s||null===(l=s.data)||void 0===l?void 0:l.error)||"Failed to reset password"}),_(e=>(0,a.A)((0,a.A)({},e),{},{loading:!1}))}}},disabled:w.loading,className:"px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded text-sm font-medium disabled:opacity-50",children:w.loading?"Resetting...":"Apply"})]})]}),(0,h.jsxs)("div",{className:"p-4 bg-gray-700/50 rounded-lg",children:[(0,h.jsx)("h3",{className:"text-white font-semibold mb-3",children:"Quick Actions"}),(0,h.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,h.jsx)("button",{onClick:async()=>{try{await d.Kp.updateUser(m,{status:"active"===E.status?"suspended":"active"}),T(),p&&p(),S({type:"success",text:"User ".concat("active"===E.status?"suspended":"activated")})}catch(e){S({type:"error",text:"Failed"})}},className:"px-4 py-2 ".concat("active"===E.status?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"," text-white rounded text-sm font-medium"),children:"active"===E.status?"Suspend User":"Activate User"}),(0,h.jsx)("button",{onClick:async()=>{try{const e="paid"===E.tier?"free":"paid";await d.Kp.updateUser(m,{tier:e}),T(),p&&p(),S({type:"success",text:"Tier changed to ".concat(e)})}catch(e){S({type:"error",text:"Failed"})}},className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded text-sm font-medium",children:"paid"===E.tier?"Downgrade to Free":"Upgrade to Premium"})]})]})]})]}):(0,h.jsx)("p",{className:"text-gray-400 text-center py-8",children:"Failed to load details"})})]}),(0,h.jsx)(v.A,(0,a.A)({},P))]})},M=()=>{const[e,t]=(0,l.useState)("ips"),[s,r]=(0,l.useState)([]),[i,n]=(0,l.useState)([]),[o,x]=(0,l.useState)(!0),[m,p]=(0,l.useState)(""),[u,g]=(0,l.useState)(!1),[b,y]=(0,l.useState)(!1),[N,f]=(0,l.useState)({ip_address:"",reason:"",expires_at:""}),[w,_]=(0,l.useState)({device_id:"",reason:"",user_id:""}),[k,C]=(0,l.useState)(null),{confirm:A,dialogProps:S}=(0,j.A)();(0,l.useEffect)(()=>{D()},[]);const D=async()=>{x(!0);try{const[e,t]=await Promise.all([d.Kp.getBlockedIPs(),d.Kp.getBannedDevices()]);r(e.data.blocked_ips||[]),n(t.data.banned_devices||[])}catch(e){console.error("Failed to load ban data:",e)}finally{x(!1)}},P=s.filter(e=>{var t,s;return(null===(t=e.ip_address)||void 0===t?void 0:t.toLowerCase().includes(m.toLowerCase()))||(null===(s=e.reason)||void 0===s?void 0:s.toLowerCase().includes(m.toLowerCase()))}),T=i.filter(e=>{var t,s;return(null===(t=e.device_id)||void 0===t?void 0:t.toLowerCase().includes(m.toLowerCase()))||(null===(s=e.reason)||void 0===s?void 0:s.toLowerCase().includes(m.toLowerCase()))});return(0,h.jsxs)("div",{className:"space-y-6",children:[k&&(0,h.jsxs)("div",{className:"p-3 rounded-lg text-sm ".concat("success"===k.type?"bg-green-500/20 text-green-300 border border-green-500/30":"bg-red-500/20 text-red-300 border border-red-500/30"),children:[k.text,(0,h.jsx)("button",{onClick:()=>C(null),className:"ml-3 font-bold",children:"\xd7"})]}),(0,h.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,h.jsxs)("button",{onClick:()=>t("ips"),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium ".concat("ips"===e?"bg-red-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:[(0,h.jsx)(c.Rqy,{})," Blocked IPs (",s.length,")"]}),(0,h.jsxs)("button",{onClick:()=>t("devices"),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium ".concat("devices"===e?"bg-orange-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:[(0,h.jsx)(c.rle,{})," Banned Devices (",i.length,")"]})]}),(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsxs)("div",{className:"flex-1 relative",children:[(0,h.jsx)(c.KSO,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),(0,h.jsx)("input",{type:"text",placeholder:"Search...",value:m,onChange:e=>p(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,h.jsxs)("button",{onClick:()=>"ips"===e?g(!u):y(!b),className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-medium",children:[(0,h.jsx)(c.OiG,{})," Add ","ips"===e?"IP Block":"Device Ban"]})]}),u&&"ips"===e&&(0,h.jsxs)("div",{className:"p-4 bg-gray-700/50 rounded-lg border border-gray-600 space-y-3",children:[(0,h.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,h.jsx)("input",{type:"text",placeholder:"IP Address (e.g. 192.168.1.1)",value:N.ip_address,onChange:e=>f(t=>(0,a.A)((0,a.A)({},t),{},{ip_address:e.target.value})),className:"px-3 py-2 rounded bg-gray-600 text-white text-sm border border-gray-500"}),(0,h.jsx)("input",{type:"text",placeholder:"Reason",value:N.reason,onChange:e=>f(t=>(0,a.A)((0,a.A)({},t),{},{reason:e.target.value})),className:"px-3 py-2 rounded bg-gray-600 text-white text-sm border border-gray-500"}),(0,h.jsx)("input",{type:"datetime-local",placeholder:"Expires at (optional)",value:N.expires_at,onChange:e=>f(t=>(0,a.A)((0,a.A)({},t),{},{expires_at:e.target.value})),className:"px-3 py-2 rounded bg-gray-600 text-white text-sm border border-gray-500"})]}),(0,h.jsx)("button",{onClick:async()=>{if(N.ip_address.trim())try{await d.Kp.blockIP(N),C({type:"success",text:"IP ".concat(N.ip_address," blocked")}),f({ip_address:"",reason:"",expires_at:""}),g(!1),D()}catch(s){var e,t;C({type:"error",text:(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Failed to block IP"})}},className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded text-sm font-medium",children:"Block IP"})]}),b&&"devices"===e&&(0,h.jsxs)("div",{className:"p-4 bg-gray-700/50 rounded-lg border border-gray-600 space-y-3",children:[(0,h.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,h.jsx)("input",{type:"text",placeholder:"Device ID",value:w.device_id,onChange:e=>_(t=>(0,a.A)((0,a.A)({},t),{},{device_id:e.target.value})),className:"px-3 py-2 rounded bg-gray-600 text-white text-sm border border-gray-500"}),(0,h.jsx)("input",{type:"text",placeholder:"Reason",value:w.reason,onChange:e=>_(t=>(0,a.A)((0,a.A)({},t),{},{reason:e.target.value})),className:"px-3 py-2 rounded bg-gray-600 text-white text-sm border border-gray-500"}),(0,h.jsx)("input",{type:"text",placeholder:"User ID (optional)",value:w.user_id,onChange:e=>_(t=>(0,a.A)((0,a.A)({},t),{},{user_id:e.target.value})),className:"px-3 py-2 rounded bg-gray-600 text-white text-sm border border-gray-500"})]}),(0,h.jsx)("button",{onClick:async()=>{if(w.device_id.trim())try{await d.Kp.banDevice(w),C({type:"success",text:"Device ".concat(w.device_id," banned")}),_({device_id:"",reason:"",user_id:""}),y(!1),D()}catch(s){var e,t;C({type:"error",text:(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Failed to ban device"})}},className:"px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded text-sm font-medium",children:"Ban Device"})]}),"ips"===e&&(0,h.jsx)("div",{className:"bg-gray-800 rounded-lg border border-gray-700",children:o?(0,h.jsx)("div",{className:"p-4 space-y-3",children:[1,2,3].map(e=>(0,h.jsx)("div",{className:"h-10 bg-gray-700/30 rounded animate-pulse"},e))}):0===P.length?(0,h.jsx)("div",{className:"p-8 text-center text-gray-500",children:"No blocked IPs"}):(0,h.jsxs)("table",{className:"w-full text-sm",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-gray-700 text-gray-400",children:[(0,h.jsx)("th",{className:"text-left py-3 px-4",children:"IP Address"}),(0,h.jsx)("th",{className:"text-left py-3 px-4",children:"Reason"}),(0,h.jsx)("th",{className:"text-left py-3 px-4",children:"Blocked At"}),(0,h.jsx)("th",{className:"text-left py-3 px-4",children:"Expires"}),(0,h.jsx)("th",{className:"text-left py-3 px-4",children:"Actions"})]})}),(0,h.jsx)("tbody",{children:P.map(e=>(0,h.jsxs)("tr",{className:"border-b border-gray-700 hover:bg-gray-700/50",children:[(0,h.jsx)("td",{className:"py-3 px-4 text-white font-mono",children:e.ip_address}),(0,h.jsx)("td",{className:"py-3 px-4 text-gray-300",children:e.reason||"-"}),(0,h.jsx)("td",{className:"py-3 px-4 text-gray-400",children:new Date(e.created_at).toLocaleString()}),(0,h.jsx)("td",{className:"py-3 px-4 text-gray-400",children:e.expires_at?new Date(e.expires_at).toLocaleString():"Never"}),(0,h.jsx)("td",{className:"py-3 px-4",children:(0,h.jsxs)("button",{onClick:()=>(async e=>{if(await A({title:"Unblock IP",message:"Unblock IP ".concat(e,"?"),confirmText:"Unblock",variant:"warning"}))try{await d.Kp.unblockIP(e),C({type:"success",text:"IP ".concat(e," unblocked")}),D()}catch(a){var t,s;C({type:"error",text:(null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||"Failed to unblock IP"})}})(e.ip_address),className:"text-red-400 hover:text-red-300 flex items-center gap-1",children:[(0,h.jsx)(c.qbC,{size:12})," Unblock"]})})]},e.id))})]})}),"devices"===e&&(0,h.jsx)("div",{className:"bg-gray-800 rounded-lg border border-gray-700",children:o?(0,h.jsx)("div",{className:"p-4 space-y-3",children:[1,2,3].map(e=>(0,h.jsx)("div",{className:"h-10 bg-gray-700/30 rounded animate-pulse"},e))}):0===T.length?(0,h.jsx)("div",{className:"p-8 text-center text-gray-500",children:"No banned devices"}):(0,h.jsxs)("table",{className:"w-full text-sm",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-gray-700 text-gray-400",children:[(0,h.jsx)("th",{className:"text-left py-3 px-4",children:"Device ID"}),(0,h.jsx)("th",{className:"text-left py-3 px-4",children:"Reason"}),(0,h.jsx)("th",{className:"text-left py-3 px-4",children:"User ID"}),(0,h.jsx)("th",{className:"text-left py-3 px-4",children:"Banned At"}),(0,h.jsx)("th",{className:"text-left py-3 px-4",children:"Actions"})]})}),(0,h.jsx)("tbody",{children:T.map(e=>(0,h.jsxs)("tr",{className:"border-b border-gray-700 hover:bg-gray-700/50",children:[(0,h.jsx)("td",{className:"py-3 px-4 text-white font-mono text-xs",children:e.device_id}),(0,h.jsx)("td",{className:"py-3 px-4 text-gray-300",children:e.reason||"-"}),(0,h.jsx)("td",{className:"py-3 px-4 text-gray-400 font-mono text-xs",children:e.user_id||"-"}),(0,h.jsx)("td",{className:"py-3 px-4 text-gray-400",children:new Date(e.created_at).toLocaleString()}),(0,h.jsx)("td",{className:"py-3 px-4",children:(0,h.jsxs)("button",{onClick:()=>(async e=>{if(await A({title:"Unban Device",message:"Unban device ".concat(e,"?"),confirmText:"Unban",variant:"warning"}))try{await d.Kp.unbanDevice(e),C({type:"success",text:"Device ".concat(e," unbanned")}),D()}catch(a){var t,s;C({type:"error",text:(null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||"Failed to unban device"})}})(e.device_id),className:"text-red-400 hover:text-red-300 flex items-center gap-1",children:[(0,h.jsx)(c.qbC,{size:12})," Unban"]})})]},e.id))})]})}),(0,h.jsx)(v.A,(0,a.A)({},S))]})},O=e=>{if(!e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB","TB"][t]},K=e=>{if(!e)return"0s";const t=Math.floor(e/86400),s=Math.floor(e%86400/3600),a=Math.floor(e%3600/60);return t>0?"".concat(t,"d ").concat(s,"h ").concat(a,"m"):s>0?"".concat(s,"h ").concat(a,"m"):"".concat(a,"m")},B=e=>{let{value:t,max:s,color:a,label:l}=e;const r=s>0?Math.min(t/s*100,100):0,i=r>90?"bg-red-500":r>70?"bg-yellow-500":a||"bg-green-500";return(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{className:"flex justify-between text-sm mb-1",children:[(0,h.jsx)("span",{className:"text-gray-400",children:l}),(0,h.jsxs)("span",{className:"text-white font-medium",children:[r.toFixed(1),"%"]})]}),(0,h.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-3",children:(0,h.jsx)("div",{className:"".concat(i," rounded-full h-3 transition-all duration-500"),style:{width:"".concat(r,"%")}})})]})},H=()=>{const[e,t]=(0,l.useState)(null),[s,a]=(0,l.useState)(!0),[r,i]=(0,l.useState)(null),[n,o]=(0,l.useState)(!1);(0,l.useEffect)(()=>{m()},[]),(0,l.useEffect)(()=>{if(!n)return;const e=setInterval(m,1e4);return()=>clearInterval(e)},[n]);const m=async()=>{try{const e=await d.Kp.getVPSMetrics();t(e.data),i(null)}catch(e){i("Failed to load VPS metrics"),console.error(e)}finally{a(!1)}};if(s)return(0,h.jsx)("div",{className:"text-center text-gray-400 py-12",children:"Loading VPS metrics..."});if(r)return(0,h.jsx)("div",{className:"text-center text-red-400 py-12",children:r});if(!e)return null;const p=e.cpu||{},u=e.memory||{},g=e.disk||{},b=e.services||{};return(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center",children:[(0,h.jsx)("h2",{className:"text-2xl font-bold text-white",children:"VPS Metrics"}),(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsxs)("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[(0,h.jsx)("input",{type:"checkbox",checked:n,onChange:e=>o(e.target.checked),className:"rounded"}),"Auto-refresh (10s)"]}),(0,h.jsxs)("button",{onClick:m,className:"px-3 py-1.5 rounded bg-blue-600 hover:bg-blue-700 text-white text-sm flex items-center gap-1",children:[(0,h.jsx)(c.DIg,{className:"text-xs"})," Refresh"]})]})]}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,h.jsx)(x.A,{className:"p-5",children:(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)("div",{className:"p-3 rounded-lg bg-blue-500/20",children:(0,h.jsx)(c.UIU,{className:"text-blue-400 text-xl"})}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-400 text-xs uppercase",children:"CPU Usage"}),(0,h.jsxs)("p",{className:"text-white text-xl font-bold",children:[parseFloat(p.usage).toFixed(1),"%"]}),(0,h.jsxs)("p",{className:"text-gray-500 text-xs",children:[p.cores," cores"]})]})]})}),(0,h.jsx)(x.A,{className:"p-5",children:(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)("div",{className:"p-3 rounded-lg bg-purple-500/20",children:(0,h.jsx)(c.FZ6,{className:"text-purple-400 text-xl"})}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-400 text-xs uppercase",children:"Memory"}),(0,h.jsxs)("p",{className:"text-white text-xl font-bold",children:[parseFloat(u.usagePercent).toFixed(1),"%"]}),(0,h.jsxs)("p",{className:"text-gray-500 text-xs",children:[O(u.used)," / ",O(u.total)]})]})]})}),(0,h.jsx)(x.A,{className:"p-5",children:(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)("div",{className:"p-3 rounded-lg bg-yellow-500/20",children:(0,h.jsx)(c.gBZ,{className:"text-yellow-400 text-xl"})}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-400 text-xs uppercase",children:"Disk"}),(0,h.jsxs)("p",{className:"text-white text-xl font-bold",children:[parseFloat(g.usagePercent).toFixed(1),"%"]}),(0,h.jsxs)("p",{className:"text-gray-500 text-xs",children:[O(g.used)," / ",O(g.total)]})]})]})}),(0,h.jsx)(x.A,{className:"p-5",children:(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)("div",{className:"p-3 rounded-lg bg-green-500/20",children:(0,h.jsx)(c.w_X,{className:"text-green-400 text-xl"})}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-400 text-xs uppercase",children:"Uptime"}),(0,h.jsx)("p",{className:"text-white text-xl font-bold",children:K(e.uptime)}),(0,h.jsxs)("p",{className:"text-gray-500 text-xs",children:[e.activeConnections," connections"]})]})]})})]}),(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Resource Usage"}),(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsx)(B,{value:parseFloat(p.usage),max:100,color:"bg-blue-500",label:"CPU (".concat(p.cores," cores)")}),(0,h.jsx)(B,{value:u.used,max:u.total,color:"bg-purple-500",label:"Memory (".concat(O(u.free)," free)")}),(0,h.jsx)(B,{value:g.used,max:g.total,color:"bg-yellow-500",label:"Disk (".concat(O(g.free)," free)")})]})]}),(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Service Status"}),(0,h.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:Object.entries(b).map(e=>{let[t,s]=e;return(0,h.jsxs)("div",{className:"flex items-center gap-2 p-3 rounded-lg ".concat("active"===s?"bg-green-500/10 border border-green-500/30":"bg-red-500/10 border border-red-500/30"),children:[(0,h.jsx)("div",{className:"w-2.5 h-2.5 rounded-full ".concat("active"===s?"bg-green-400 animate-pulse":"bg-red-400")}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-white text-sm font-medium capitalize",children:t}),(0,h.jsx)("p",{className:"text-xs ".concat("active"===s?"text-green-400":"text-red-400"),children:s})]})]},t)})})]})]})},z={critical:{color:"text-red-400",bg:"bg-red-500/20",border:"border-red-500/30",icon:c._Hm},warning:{color:"text-yellow-400",bg:"bg-yellow-500/20",border:"border-yellow-500/30",icon:c.BS8},info:{color:"text-blue-400",bg:"bg-blue-500/20",border:"border-blue-500/30",icon:c.__w}},V=()=>{const[e,t]=(0,l.useState)("active"),[s,r]=(0,l.useState)([]),[i,n]=(0,l.useState)([]),[o,m]=(0,l.useState)(null),[p,u]=(0,l.useState)(!0),[g,b]=(0,l.useState)({severity:"",limit:50}),{confirm:y,dialogProps:N}=(0,j.A)();(0,l.useEffect)(()=>{f();const e=setInterval(f,3e4);return()=>clearInterval(e)},[]),(0,l.useEffect)(()=>{"history"===e&&w()},[e,g]);const f=async()=>{try{u(!0);const e=await d.Kp.getActiveAlerts();r(e.data.alerts||[]),m(e.data.summary||null)}catch(e){console.error("Failed to load alerts:",e),r([])}finally{u(!1)}},w=async()=>{try{const e=await d.Kp.getAlertHistory(g);n(e.data.alerts||[])}catch(e){console.error("Failed to load alert history:",e)}},_=async e=>{try{await d.Kp.acknowledgeAlert(e),f()}catch(a){var t,s;alert("Failed to acknowledge: "+((null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||a.message))}},k=async e=>{const t=prompt("Resolution note (optional):");if(null!==t)try{await d.Kp.resolveAlert(e,t),f()}catch(l){var s,a;alert("Failed to resolve: "+((null===(s=l.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.error)||l.message))}},C=e=>{if(!e)return"N/A";return new Date(e).toLocaleString()},A=e=>{if(!e)return"";const t=Math.floor((Date.now()-new Date(e))/6e4);return t<60?"".concat(t,"m ago"):t<1440?"".concat(Math.floor(t/60),"h ago"):"".concat(Math.floor(t/1440),"d ago")};return p?(0,h.jsx)("div",{className:"text-center text-gray-400 py-12",children:"Loading alerts..."}):(0,h.jsxs)("div",{className:"space-y-6",children:[o&&(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,h.jsx)(x.A,{className:"p-4 border border-white/10",children:(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)(c.jNV,{className:"text-white text-xl"}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-400 text-xs",children:"Total Active"}),(0,h.jsx)("p",{className:"text-white text-xl font-bold",children:o.total||s.length})]})]})}),(0,h.jsx)(x.A,{className:"p-4 border border-red-500/30",children:(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)(c._Hm,{className:"text-red-400 text-xl"}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-red-300 text-xs",children:"Critical"}),(0,h.jsx)("p",{className:"text-white text-xl font-bold",children:o.critical||0})]})]})}),(0,h.jsx)(x.A,{className:"p-4 border border-yellow-500/30",children:(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)(c.BS8,{className:"text-yellow-400 text-xl"}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-yellow-300 text-xs",children:"Warning"}),(0,h.jsx)("p",{className:"text-white text-xl font-bold",children:o.warning||0})]})]})}),(0,h.jsx)(x.A,{className:"p-4 border border-blue-500/30",children:(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)(c.__w,{className:"text-blue-400 text-xl"}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-blue-300 text-xs",children:"Info"}),(0,h.jsx)("p",{className:"text-white text-xl font-bold",children:o.info||0})]})]})})]}),(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsxs)("button",{onClick:()=>t("active"),className:"px-4 py-2 rounded-lg font-medium text-sm flex items-center gap-2 ".concat("active"===e?"bg-blue-600 text-white":"bg-white/5 text-gray-400 hover:bg-white/10"),children:[(0,h.jsx)(c.jNV,{})," Active (",s.length,")"]}),(0,h.jsxs)("button",{onClick:()=>t("history"),className:"px-4 py-2 rounded-lg font-medium text-sm flex items-center gap-2 ".concat("history"===e?"bg-blue-600 text-white":"bg-white/5 text-gray-400 hover:bg-white/10"),children:[(0,h.jsx)(c.OKX,{})," History"]}),"active"===e&&s.length>0&&(0,h.jsx)("button",{onClick:async()=>{if(await y({title:"Acknowledge All",message:"Acknowledge all active alerts?",confirmText:"Acknowledge All",variant:"warning"}))try{await d.Kp.acknowledgeAllAlerts(),f()}catch(s){var e,t;alert("Failed: "+((null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||s.message))}},className:"ml-auto px-4 py-2 rounded-lg bg-yellow-600 hover:bg-yellow-700 text-white text-sm font-medium",children:"Acknowledge All"})]}),"active"===e&&(0,h.jsx)("div",{className:"space-y-3",children:0===s.length?(0,h.jsxs)(x.A,{className:"p-12 text-center",children:[(0,h.jsx)(c.A7C,{className:"text-green-400 text-4xl mx-auto mb-3"}),(0,h.jsx)("p",{className:"text-green-300 text-lg font-medium",children:"All Clear"}),(0,h.jsx)("p",{className:"text-gray-500 text-sm",children:"No active alerts at this time"})]}):s.map(e=>{const t=z[e.severity]||z.info,s=t.icon;return(0,h.jsx)(x.A,{className:"p-4 ".concat(t.bg," border ").concat(t.border),children:(0,h.jsxs)("div",{className:"flex items-start gap-3",children:[(0,h.jsx)(s,{className:"".concat(t.color," text-lg mt-0.5 flex-shrink-0")}),(0,h.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)("span",{className:"text-xs font-medium uppercase ".concat(t.color),children:e.severity}),(0,h.jsx)("span",{className:"text-gray-500 text-xs",children:e.type}),(0,h.jsx)("span",{className:"text-gray-600 text-xs ml-auto",children:A(e.created_at||e.timestamp)})]}),(0,h.jsx)("p",{className:"text-white font-medium mt-1",children:e.message}),e.details&&(0,h.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"string"===typeof e.details?e.details:JSON.stringify(e.details)})]}),(0,h.jsxs)("div",{className:"flex gap-2 flex-shrink-0",children:[(0,h.jsx)("button",{onClick:()=>_(e.id),className:"px-3 py-1.5 rounded text-xs font-medium bg-yellow-600/30 text-yellow-300 hover:bg-yellow-600/50",title:"Acknowledge",children:(0,h.jsx)(c.CMH,{})}),(0,h.jsx)("button",{onClick:()=>k(e.id),className:"px-3 py-1.5 rounded text-xs font-medium bg-green-600/30 text-green-300 hover:bg-green-600/50",title:"Resolve",children:(0,h.jsx)(c.A7C,{})})]})]})},e.id)})}),"history"===e&&(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsx)("div",{className:"flex gap-3",children:(0,h.jsxs)("select",{value:g.severity,onChange:e=>b(t=>(0,a.A)((0,a.A)({},t),{},{severity:e.target.value})),className:"px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white text-sm",children:[(0,h.jsx)("option",{value:"",children:"All Severities"}),(0,h.jsx)("option",{value:"critical",children:"Critical"}),(0,h.jsx)("option",{value:"warning",children:"Warning"}),(0,h.jsx)("option",{value:"info",children:"Info"})]})}),(0,h.jsx)(x.A,{className:"p-0 overflow-hidden",children:(0,h.jsxs)("table",{className:"w-full",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-white/10",children:[(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-400 text-xs uppercase",children:"Severity"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-400 text-xs uppercase",children:"Type"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-400 text-xs uppercase",children:"Message"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-400 text-xs uppercase",children:"Time"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-400 text-xs uppercase",children:"Status"})]})}),(0,h.jsx)("tbody",{children:0===i.length?(0,h.jsx)("tr",{children:(0,h.jsx)("td",{colSpan:5,className:"py-8 text-center text-gray-500",children:"No alert history"})}):i.map((e,t)=>{const s=z[e.severity]||z.info;return(0,h.jsxs)("tr",{className:"border-b border-white/5 hover:bg-white/5",children:[(0,h.jsx)("td",{className:"py-2.5 px-4",children:(0,h.jsx)("span",{className:"text-xs font-medium uppercase ".concat(s.color),children:e.severity})}),(0,h.jsx)("td",{className:"py-2.5 px-4 text-gray-400 text-sm",children:e.type}),(0,h.jsx)("td",{className:"py-2.5 px-4 text-white text-sm max-w-xs truncate",children:e.message}),(0,h.jsx)("td",{className:"py-2.5 px-4 text-gray-500 text-xs",children:C(e.created_at||e.timestamp)}),(0,h.jsx)("td",{className:"py-2.5 px-4",children:(0,h.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full ".concat(e.resolved_at?"bg-green-500/20 text-green-300":e.acknowledged_at?"bg-yellow-500/20 text-yellow-300":"bg-red-500/20 text-red-300"),children:e.resolved_at?"Resolved":e.acknowledged_at?"Acked":"Active"})})]},e.id||t)})})]})})]}),(0,h.jsx)(v.A,(0,a.A)({},N))]})},W={active:{color:"green",label:"Active",icon:c.A7C},maintenance:{color:"yellow",label:"Maintenance",icon:c.BS8},offline:{color:"red",label:"Offline",icon:c._Hm}},G={healthy:{color:"green",label:"Healthy"},degraded:{color:"yellow",label:"Degraded"},unhealthy:{color:"red",label:"Unhealthy"},unknown:{color:"gray",label:"Unknown"}},q=e=>{let{pct:t}=e;const s=t>90?"bg-red-500":t>70?"bg-yellow-500":"bg-green-500";return(0,h.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2",children:(0,h.jsx)("div",{className:"".concat(s," rounded-full h-2 transition-all duration-500"),style:{width:"".concat(Math.min(t,100),"%")}})})},X=e=>{let{server:t,actionLoading:s,onToggleStatus:a,onSetOffline:l,onSSHTest:r,onHealthCheck:i,onEdit:n,onDelete:o,onSelect:d,isSelected:m}=e;const p=W[t.status]||W.offline,u=G[t.health_status]||G.unknown,g=p.icon,b=Array.isArray(t.protocols)?t.protocols:[];return(0,h.jsx)(x.A,{className:"transition-all ".concat(m?"ring-2 ring-blue-500":""),children:(0,h.jsxs)("div",{className:"p-5",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)(g,{className:"text-".concat(p.color,"-400 text-lg")}),(0,h.jsxs)("div",{children:[(0,h.jsx)("h3",{className:"text-white text-lg font-bold",children:t.name}),(0,h.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[(0,h.jsx)(c.f35,{className:"text-xs"}),(0,h.jsx)("span",{children:t.location}),t.country_code&&(0,h.jsxs)("span",{className:"text-xs",children:["(",t.country_code,")"]})]})]})]}),(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-".concat(p.color,"-500/20 text-").concat(p.color,"-400 border border-").concat(p.color,"-500/30"),children:p.label}),(0,h.jsx)("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-".concat(u.color,"-500/20 text-").concat(u.color,"-400 border border-").concat(u.color,"-500/30"),children:u.label}),t.consecutive_failures>0&&(0,h.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold bg-red-500/20 text-red-400 border border-red-500/30",children:[t.consecutive_failures," fails"]})]})]}),(0,h.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-3",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-500 text-xs",children:"IP Address"}),(0,h.jsx)("p",{className:"text-white text-sm font-mono",children:t.ip_address})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-500 text-xs",children:"Connections"}),(0,h.jsxs)("p",{className:"text-white text-sm font-semibold",children:[t.active_connections," / ",t.capacity]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-500 text-xs",children:"Load"}),(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)(q,{pct:t.load_percent}),(0,h.jsxs)("span",{className:"text-white text-sm font-semibold",children:[t.load_percent,"%"]})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-500 text-xs",children:"SSH"}),(0,h.jsx)("p",{className:"text-sm",children:t.has_ssh_password||t.has_ssh_key?(0,h.jsx)("span",{className:"text-green-400",children:"Configured"}):(0,h.jsx)("span",{className:"text-gray-500",children:"Not set"})})]})]}),(0,h.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,h.jsx)("span",{className:"text-gray-500 text-xs",children:"Protocols:"}),b.map(e=>(0,h.jsx)("span",{className:"px-2 py-0.5 rounded text-xs bg-blue-500/15 text-blue-300 border border-blue-500/20",children:e},e)),0===b.length&&(0,h.jsx)("span",{className:"text-gray-600 text-xs",children:"None configured"})]}),(0,h.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,h.jsxs)("button",{onClick:d,className:"px-3 py-1.5 rounded text-xs font-medium bg-white/5 hover:bg-white/10 text-gray-300 flex items-center gap-1",children:[(0,h.jsx)(c.Ny1,{})," ",m?"Hide Details":"Details"]}),(0,h.jsxs)("button",{onClick:r,disabled:"loading"===s.ssh,className:"px-3 py-1.5 rounded text-xs font-medium bg-white/5 hover:bg-white/10 text-gray-300 flex items-center gap-1 disabled:opacity-40",children:[(0,h.jsx)(c.iuJ,{})," ","loading"===s.ssh?"Testing...":"SSH Test"]}),(0,h.jsxs)("button",{onClick:i,disabled:"loading"===s.health,className:"px-3 py-1.5 rounded text-xs font-medium bg-white/5 hover:bg-white/10 text-gray-300 flex items-center gap-1 disabled:opacity-40",children:[(0,h.jsx)(c.szJ,{})," ","loading"===s.health?"Checking...":"Health Check"]}),(0,h.jsxs)("button",{onClick:a,disabled:s.status,className:"px-3 py-1.5 rounded text-xs font-medium flex items-center gap-1 disabled:opacity-40 ".concat("active"===t.status?"bg-yellow-600/20 hover:bg-yellow-600/30 text-yellow-300":"bg-green-600/20 hover:bg-green-600/30 text-green-300"),children:[(0,h.jsx)(c.e9S,{})," ","active"===t.status?"Maintenance":"Activate"]}),"offline"!==t.status&&(0,h.jsxs)("button",{onClick:l,disabled:s.status,className:"px-3 py-1.5 rounded text-xs font-medium bg-red-600/20 hover:bg-red-600/30 text-red-300 flex items-center gap-1 disabled:opacity-40",children:[(0,h.jsx)(c._Hm,{})," Offline"]}),(0,h.jsxs)("button",{onClick:n,className:"px-3 py-1.5 rounded text-xs font-medium bg-white/5 hover:bg-white/10 text-blue-300 flex items-center gap-1",children:[(0,h.jsx)(c.uO9,{})," Edit"]}),(0,h.jsxs)("button",{onClick:o,className:"px-3 py-1.5 rounded text-xs font-medium bg-white/5 hover:bg-white/10 text-red-400 flex items-center gap-1",children:[(0,h.jsx)(c.qbC,{})," Delete"]})]}),s.ssh&&"loading"!==s.ssh&&(0,h.jsxs)("div",{className:"mt-3 p-2.5 rounded text-xs ".concat("ok"===s.ssh?"bg-green-500/10 text-green-300 border border-green-500/20":"bg-red-500/10 text-red-300 border border-red-500/20"),children:[(0,h.jsx)("span",{className:"font-medium",children:"SSH:"})," ",s.sshMsg]}),"done"===s.health&&(0,h.jsxs)("div",{className:"mt-2 p-2.5 rounded text-xs bg-blue-500/10 text-blue-300 border border-blue-500/20",children:[(0,h.jsx)("span",{className:"font-medium",children:"Health:"})," ",s.healthMsg]})]})})},Y=e=>{let{server:t,onClose:s}=e;const[a,r]=(0,l.useState)("guardian"),[i,n]=(0,l.useState)([]),[o,m]=(0,l.useState)([]),[p,u]=(0,l.useState)(!0);(0,l.useEffect)(()=>{u(!0),Promise.all([d.Kp.getGuardianLog(t.id).catch(()=>({data:{log:[]}})),d.Kp.getLoadPrediction(t.id,8).catch(()=>({data:{predictions:[]}}))]).then(e=>{var t,s;let[a,l]=e;n((null===(t=a.data)||void 0===t?void 0:t.log)||[]),m((null===(s=l.data)||void 0===s?void 0:s.predictions)||[])}).finally(()=>u(!1))},[t.id]);const g={healthy:"text-green-400",degraded:"text-yellow-400",unhealthy:"text-red-400",auto_offline:"text-red-500",recovery:"text-green-400",restart_requested:"text-orange-400",status_change:"text-blue-400"};return(0,h.jsxs)(x.A,{className:"p-6 border border-blue-500/30",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,h.jsxs)("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:[(0,h.jsx)(c.SMR,{className:"text-blue-400"}),t.name," \u2014 Details"]}),(0,h.jsx)("button",{onClick:s,className:"text-gray-500 hover:text-white",children:(0,h.jsx)(c.QCr,{})})]}),(0,h.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,h.jsxs)("button",{onClick:()=>r("guardian"),className:"px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-1 ".concat("guardian"===a?"bg-blue-600 text-white":"bg-white/5 text-gray-400 hover:bg-white/10"),children:[(0,h.jsx)(c.SMR,{})," Guardian Log"]}),(0,h.jsxs)("button",{onClick:()=>r("prediction"),className:"px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-1 ".concat("prediction"===a?"bg-blue-600 text-white":"bg-white/5 text-gray-400 hover:bg-white/10"),children:[(0,h.jsx)(c.YYR,{})," Load Prediction"]})]}),p?(0,h.jsx)("div",{className:"space-y-3 py-4",children:[1,2,3].map(e=>(0,h.jsxs)("div",{className:"flex items-center gap-4 p-3 animate-pulse",children:[(0,h.jsx)("div",{className:"h-4 w-1/4 bg-gray-700/30 rounded"}),(0,h.jsx)("div",{className:"h-4 w-1/3 bg-gray-700/30 rounded"}),(0,h.jsx)("div",{className:"h-4 w-1/4 bg-gray-700/30 rounded"})]},e))}):"guardian"===a?(0,h.jsx)("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:0===i.length?(0,h.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,h.jsx)(c.A7C,{className:"text-green-500 text-3xl mx-auto mb-2"}),"No guardian events \u2014 server running smoothly"]}):i.map((e,t)=>{var s;return(0,h.jsxs)("div",{className:"flex items-start gap-3 p-3 rounded bg-white/5",children:[(0,h.jsx)(c.OKX,{className:"text-sm mt-0.5 ".concat(g[e.action]||"text-gray-400")}),(0,h.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)("span",{className:"text-xs font-semibold uppercase ".concat(g[e.action]||"text-gray-400"),children:null===(s=e.action)||void 0===s?void 0:s.replace(/_/g," ")}),(0,h.jsx)("span",{className:"text-gray-600 text-xs",children:new Date(e.created_at).toLocaleString()})]}),(0,h.jsx)("p",{className:"text-gray-300 text-sm mt-0.5",children:"string"===typeof e.details?e.details:JSON.stringify(e.details)})]})]},t)})}):(0,h.jsx)("div",{className:"space-y-2",children:0===o.length?(0,h.jsx)("div",{className:"text-center text-gray-500 py-8",children:"No load history data available for predictions yet"}):(0,h.jsx)("div",{className:"grid grid-cols-4 md:grid-cols-8 gap-2",children:o.map((e,s)=>{const a=t.capacity>0?(e.predicted_load||0)/t.capacity*100:0;return(0,h.jsxs)("div",{className:"text-center p-3 rounded bg-white/5",children:[(0,h.jsx)("p",{className:"text-gray-500 text-xs",children:e.hour||"+".concat(s+1,"h")}),(0,h.jsx)("p",{className:"text-white text-lg font-bold",children:e.predicted_load||0}),(0,h.jsx)(q,{pct:a}),(0,h.jsxs)("p",{className:"text-gray-600 text-xs mt-1",children:[a.toFixed(0),"%"]})]},s)})})})]})},Q=e=>{let{onOpenServerModal:t,onDeleteServer:s,onRefreshParent:r}=e;const[i,n]=(0,l.useState)([]),[o,m]=(0,l.useState)([]),[p,u]=(0,l.useState)(null),[g,b]=(0,l.useState)(!0),[y,N]=(0,l.useState)(!0),[f,w]=(0,l.useState)(null),[_,k]=(0,l.useState)({}),{confirm:C,dialogProps:A}=(0,j.A)(),S=(0,l.useCallback)(async()=>{try{var e,t,s;const[l,r,i]=await Promise.all([d.Kp.getServers(),d.Kp.getGuardianHealth().catch(()=>({data:{servers:[]}})),d.Kp.getServerStatsOverview().catch(()=>({data:{stats:{}}}))]),c=Array.isArray(l.data)?l.data:(null===(e=l.data)||void 0===e?void 0:e.servers)||[],o=(null===(t=r.data)||void 0===t?void 0:t.servers)||[],x={};o.forEach(e=>{x[e.id]=e});const p=c.map(e=>{var t,s,l,r;return(0,a.A)((0,a.A)({},e),{},{health_status:(null===(t=x[e.id])||void 0===t?void 0:t.health_status)||e.health_status||"unknown",consecutive_failures:(null===(s=x[e.id])||void 0===s?void 0:s.consecutive_failures)||0,last_check:(null===(l=x[e.id])||void 0===l?void 0:l.last_check)||e.last_health_check,active_connections:e.current_load||(null===(r=x[e.id])||void 0===r?void 0:r.current_load)||0,load_percent:parseFloat(e.load_percent)||0})});n(p),m(o),u((null===(s=i.data)||void 0===s?void 0:s.stats)||null)}catch(l){console.error("Failed to load server data:",l)}finally{b(!1)}},[]);(0,l.useEffect)(()=>{S()},[S]),(0,l.useEffect)(()=>{if(!y)return;const e=setInterval(S,3e4);return()=>clearInterval(e)},[y,S]);const D=(e,t,s)=>k(l=>(0,a.A)((0,a.A)({},l),{},{[e]:(0,a.A)((0,a.A)({},l[e]),{},{[t]:s})})),P={total:i.length,active:i.filter(e=>"active"===e.status).length,maintenance:i.filter(e=>"maintenance"===e.status).length,offline:i.filter(e=>"offline"===e.status).length,healthy:i.filter(e=>"healthy"===e.health_status).length,degraded:i.filter(e=>"degraded"===e.health_status).length,unhealthy:i.filter(e=>"unhealthy"===e.health_status||"unknown"===e.health_status).length,totalLoad:i.reduce((e,t)=>e+(t.active_connections||0),0),totalCapacity:i.filter(e=>"active"===e.status).reduce((e,t)=>e+(t.capacity||0),0)};return g?(0,h.jsx)("div",{className:"text-center text-gray-400 py-12",children:"Loading server fleet..."}):(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:[(0,h.jsxs)(x.A,{className:"p-4 border border-white/10",children:[(0,h.jsx)("p",{className:"text-gray-400 text-xs uppercase",children:"Fleet"}),(0,h.jsx)("p",{className:"text-white text-2xl font-bold",children:P.total}),(0,h.jsx)("p",{className:"text-gray-500 text-xs",children:"servers"})]}),(0,h.jsxs)(x.A,{className:"p-4 border border-green-500/30",children:[(0,h.jsx)("p",{className:"text-green-400 text-xs uppercase",children:"Active"}),(0,h.jsx)("p",{className:"text-white text-2xl font-bold",children:P.active}),(0,h.jsxs)("p",{className:"text-green-500/50 text-xs",children:[P.healthy," healthy"]})]}),(0,h.jsxs)(x.A,{className:"p-4 border border-yellow-500/30",children:[(0,h.jsx)("p",{className:"text-yellow-400 text-xs uppercase",children:"Maintenance"}),(0,h.jsx)("p",{className:"text-white text-2xl font-bold",children:P.maintenance}),(0,h.jsxs)("p",{className:"text-yellow-500/50 text-xs",children:[P.degraded," degraded"]})]}),(0,h.jsxs)(x.A,{className:"p-4 border border-red-500/30",children:[(0,h.jsx)("p",{className:"text-red-400 text-xs uppercase",children:"Offline"}),(0,h.jsx)("p",{className:"text-white text-2xl font-bold",children:P.offline}),(0,h.jsxs)("p",{className:"text-red-500/50 text-xs",children:[P.unhealthy," unhealthy"]})]}),(0,h.jsxs)(x.A,{className:"p-4 border border-blue-500/30",children:[(0,h.jsx)("p",{className:"text-blue-400 text-xs uppercase",children:"Connections"}),(0,h.jsx)("p",{className:"text-white text-2xl font-bold",children:P.totalLoad}),(0,h.jsxs)("p",{className:"text-blue-500/50 text-xs",children:["of ",P.totalCapacity," capacity"]})]}),(0,h.jsxs)(x.A,{className:"p-4 border border-purple-500/30",children:[(0,h.jsx)("p",{className:"text-purple-400 text-xs uppercase",children:"Utilization"}),(0,h.jsxs)("p",{className:"text-white text-2xl font-bold",children:[P.totalCapacity>0?(P.totalLoad/P.totalCapacity*100).toFixed(1):0,"%"]}),(0,h.jsx)("p",{className:"text-purple-500/50 text-xs",children:"fleet average"})]})]}),(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[(0,h.jsx)(c.vwk,{className:"text-blue-400"})," Server Fleet"]}),(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsxs)("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[(0,h.jsx)("input",{type:"checkbox",checked:y,onChange:e=>N(e.target.checked),className:"rounded"}),"Live (30s)"]}),(0,h.jsxs)("button",{onClick:S,className:"px-3 py-1.5 rounded bg-white/5 hover:bg-white/10 text-gray-300 text-sm flex items-center gap-1",children:[(0,h.jsx)(c.DIg,{className:"text-xs"})," Refresh"]}),(0,h.jsxs)("button",{onClick:()=>null===t||void 0===t?void 0:t(null),className:"px-4 py-1.5 rounded bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium flex items-center gap-1",children:[(0,h.jsx)(c.OiG,{className:"text-xs"})," Add Server"]})]})]}),0===i.length?(0,h.jsxs)(x.A,{className:"p-12 text-center",children:[(0,h.jsx)(c.vwk,{className:"text-gray-600 text-4xl mx-auto mb-3"}),(0,h.jsx)("p",{className:"text-gray-400 text-lg",children:"No servers configured"}),(0,h.jsx)("p",{className:"text-gray-600 text-sm",children:'Click "Add Server" to get started'})]}):(0,h.jsx)("div",{className:"space-y-4",children:i.map(e=>(0,h.jsx)(X,{server:e,actionLoading:_[e.id]||{},onToggleStatus:()=>(async e=>{const t="active"===e.status?"maintenance":"active";if("maintenance"===t&&e.active_connections>0&&!await C({title:"Set Maintenance Mode",message:"This server has ".concat(e.active_connections," active connections. Setting to maintenance will trigger user migration by the Guardian. Continue?"),confirmText:"Continue",variant:"warning"}))return;D(e.id,"status",!0);try{await d.Kp.setServerStatusOps(e.id,t),await S(),null===r||void 0===r||r()}catch(l){var s,a;alert("Failed: "+((null===(s=l.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.error)||l.message))}finally{D(e.id,"status",!1)}})(e),onSetOffline:()=>(async e=>{if(await C({title:"Set Server Offline",message:"Set ".concat(e.name," OFFLINE? Active users will be disconnected."),confirmText:"Set Offline",variant:"danger"})){D(e.id,"status",!0);try{await d.Kp.setServerStatusOps(e.id,"offline"),await S(),null===r||void 0===r||r()}catch(a){var t,s;alert("Failed: "+((null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||a.message))}finally{D(e.id,"status",!1)}}})(e),onSSHTest:()=>(async e=>{D(e.id,"ssh","loading");try{const t=(await d.Kp.testServerSSH(e.id)).data;D(e.id,"ssh",t.connected?"ok":"fail"),D(e.id,"sshMsg",t.output||(t.connected?"Connected":"Failed"))}catch(a){var t,s;D(e.id,"ssh","fail"),D(e.id,"sshMsg",(null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||"SSH test failed")}})(e),onHealthCheck:()=>(async e=>{D(e.id,"health","loading");try{const t=(await d.Kp.triggerHealthCheck(e.id)).data,s=t.protocols||t.results||{},a=Object.entries(s).map(e=>{let[t,s]=e;const a="object"===typeof s?s.status||s.reachable:s;return"".concat(t,": ").concat(a?"\u2705":"\u274c")}).join(", ");D(e.id,"health","done"),D(e.id,"healthMsg",a||(t.is_healthy?"All healthy":"Issues detected"))}catch(a){var t,s;D(e.id,"health","done"),D(e.id,"healthMsg",(null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||"Health check failed")}})(e),onEdit:()=>null===t||void 0===t?void 0:t(e),onDelete:()=>(async e=>{if(e.active_connections>0)return void alert("Cannot delete: ".concat(e.name," has ").concat(e.active_connections," active connections. Set it offline first and wait for connections to drain."));if(await C({title:"Delete Server",message:'Permanently delete server "'.concat(e.name,'" (').concat(e.ip_address,")? This cannot be undone."),confirmText:"Delete",variant:"danger"}))try{await d.Kp.deleteServer(e.id),await S(),null===r||void 0===r||r()}catch(a){var t,s;alert("Failed: "+((null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||a.message))}})(e),onSelect:()=>w((null===f||void 0===f?void 0:f.id)===e.id?null:e),isSelected:(null===f||void 0===f?void 0:f.id)===e.id},e.id))}),f&&(0,h.jsx)(Y,{server:f,onClose:()=>w(null)}),(0,h.jsx)(v.A,(0,a.A)({},A))]})},$=e=>(e||0).toLocaleString(),J=e=>{const t=parseInt(e)||0;return t<1024?"".concat(t," B"):t<1048576?"".concat((t/1024).toFixed(1)," KB"):t<1073741824?"".concat((t/1048576).toFixed(1)," MB"):"".concat((t/1073741824).toFixed(2)," GB")},Z=e=>{let{free:t,paid:s,label:a}=e;const l=(t||0)+(s||0),r=l>0?t/l*100:50;return(0,h.jsxs)("div",{className:"mb-1",children:[a&&(0,h.jsx)("p",{className:"text-gray-500 text-xs mb-0.5",children:a}),(0,h.jsxs)("div",{className:"flex h-3 rounded-full overflow-hidden bg-gray-700 w-full",children:[(0,h.jsx)("div",{className:"bg-blue-500 transition-all",style:{width:"".concat(r,"%")},title:"Free: ".concat($(t))}),(0,h.jsx)("div",{className:"bg-amber-500 transition-all",style:{width:"".concat(100-r,"%")},title:"Paid: ".concat($(s))})]}),(0,h.jsxs)("div",{className:"flex justify-between text-[10px] mt-0.5",children:[(0,h.jsxs)("span",{className:"text-blue-400",children:[$(t)," free"]}),(0,h.jsxs)("span",{className:"text-amber-400",children:[$(s)," paid"]})]})]})},ee=e=>{let{data:t}=e;if(!t)return null;const s=t.users||{},a=t.live||{},l=t.today||{};return(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:[(0,h.jsx)(se,{icon:c.YXz,iconColor:"blue",label:"Free Users",value:s.free_total,sub:"".concat(s.free_active," active (30d)")}),(0,h.jsx)(se,{icon:c.Hu1,iconColor:"amber",label:"Paid Users",value:s.paid_total,sub:"".concat(s.paid_active," active (30d)")}),(0,h.jsx)(se,{icon:c.NPy,iconColor:"green",label:"New Today",value:(parseInt(s.free_new_24h)||0)+(parseInt(s.paid_new_24h)||0),sub:"F:".concat(s.free_new_24h||0," P:").concat(s.paid_new_24h||0)}),(0,h.jsx)(se,{icon:c.BAG,iconColor:"purple",label:"Online Now",value:(parseInt(a.free_online)||0)+(parseInt(a.paid_online)||0),sub:"F:".concat(a.free_online||0," P:").concat(a.paid_online||0)}),(0,h.jsx)(se,{icon:c.yk7,iconColor:"cyan",label:"Connections Today",value:(parseInt(l.free_connections_today)||0)+(parseInt(l.paid_connections_today)||0),sub:"F:".concat(l.free_connections_today||0," P:").concat(l.paid_connections_today||0)}),(0,h.jsx)(se,{icon:c.nBS,iconColor:"pink",label:"Data Today",value:J((parseInt(l.free_data_today)||0)+(parseInt(l.paid_data_today)||0)),sub:"F:".concat(J(l.free_data_today)," P:").concat(J(l.paid_data_today))})]}),(0,h.jsxs)(x.A,{className:"p-5 border border-white/10",children:[(0,h.jsx)("h3",{className:"text-white font-semibold mb-3",children:"User Composition"}),(0,h.jsx)(Z,{free:parseInt(s.free_total)||0,paid:parseInt(s.paid_total)||0,label:"Total users"}),(0,h.jsx)(Z,{free:parseInt(s.free_active)||0,paid:parseInt(s.paid_active)||0,label:"Active users (30d)"}),(0,h.jsx)(Z,{free:parseInt(a.free_online)||0,paid:parseInt(a.paid_online)||0,label:"Online now"}),(0,h.jsx)(Z,{free:parseInt(l.free_connections_today)||0,paid:parseInt(l.paid_connections_today)||0,label:"Connections today"}),(0,h.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-4 text-sm",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-500 text-xs",children:"Conversion Rate"}),(0,h.jsxs)("p",{className:"text-white font-bold",children:[(r=s.paid_total,i=s.total_users,i>0?(r/i*100).toFixed(1):"0.0"),"%"]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-500 text-xs",children:"New This Week"}),(0,h.jsxs)("p",{className:"text-white font-bold",children:["F:",$(s.free_new_7d)," / P:",$(s.paid_new_7d)]})]})]})]}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,h.jsxs)(x.A,{className:"p-5 border border-white/10",children:[(0,h.jsxs)("h3",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[(0,h.jsx)(c.f35,{className:"text-green-400 text-sm"})," Regions (Live)"]}),0===(t.regions||[]).length?(0,h.jsx)("p",{className:"text-gray-500 text-sm text-center py-4",children:"No active connections"}):(0,h.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t.regions.map((e,t)=>(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsx)("span",{className:"text-gray-300 text-sm",children:e.country_name||e.country_code}),(0,h.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,h.jsxs)("span",{className:"text-blue-400",children:[e.free_count," F"]}),(0,h.jsxs)("span",{className:"text-amber-400",children:[e.paid_count," P"]}),(0,h.jsx)("span",{className:"text-gray-500",children:e.total_count})]})]},t))})]}),(0,h.jsxs)(x.A,{className:"p-5 border border-white/10",children:[(0,h.jsxs)("h3",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[(0,h.jsx)(c.nVN,{className:"text-blue-400 text-sm"})," Protocols (Live)"]}),0===(t.protocols||[]).length?(0,h.jsx)("p",{className:"text-gray-500 text-sm text-center py-4",children:"No active connections"}):(0,h.jsx)("div",{className:"space-y-2",children:t.protocols.map((e,t)=>(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-0.5",children:[(0,h.jsx)("span",{className:"text-gray-300 text-sm font-mono",children:e.protocol}),(0,h.jsx)("span",{className:"text-gray-500 text-xs",children:e.total_count})]}),(0,h.jsx)(Z,{free:parseInt(e.free_count),paid:parseInt(e.paid_count)})]},t))})]}),(0,h.jsxs)(x.A,{className:"p-5 border border-white/10",children:[(0,h.jsxs)("h3",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[(0,h.jsx)(c.vwk,{className:"text-purple-400 text-sm"})," Servers (Live)"]}),0===(t.servers||[]).length?(0,h.jsx)("p",{className:"text-gray-500 text-sm text-center py-4",children:"No active connections"}):(0,h.jsx)("div",{className:"space-y-2",children:t.servers.map((e,t)=>(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-0.5",children:[(0,h.jsxs)("span",{className:"text-gray-300 text-sm",children:[e.server_name," ",(0,h.jsxs)("span",{className:"text-gray-600 text-xs",children:["(",e.country_code,")"]})]}),(0,h.jsxs)("span",{className:"text-gray-500 text-xs",children:[e.total_count,"/",e.capacity]})]}),(0,h.jsx)(Z,{free:parseInt(e.free_count),paid:parseInt(e.paid_count)})]},t))})]})]}),t.plans&&t.plans.length>0&&(0,h.jsxs)(x.A,{className:"p-5 border border-white/10",children:[(0,h.jsx)("h3",{className:"text-white font-semibold mb-3",children:"Paid Plan Distribution"}),(0,h.jsx)("div",{className:"flex flex-wrap gap-3",children:t.plans.map((e,t)=>(0,h.jsxs)("div",{className:"bg-white/5 rounded-lg px-4 py-2 text-center min-w-[100px]",children:[(0,h.jsx)("p",{className:"text-amber-400 text-lg font-bold",children:e.count}),(0,h.jsx)("p",{className:"text-gray-400 text-xs",children:e.plan||"unset"})]},t))})]}),t.hourly_trend&&t.hourly_trend.length>0&&(0,h.jsxs)(x.A,{className:"p-5 border border-white/10",children:[(0,h.jsxs)("h3",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[(0,h.jsx)(c.w_X,{className:"text-cyan-400 text-sm"})," 24h Connection Trend"]}),(0,h.jsx)("div",{className:"flex items-end gap-1 h-32 overflow-x-auto",children:t.hourly_trend.map((e,s)=>{const a=parseInt(e.free_count)||0,l=parseInt(e.paid_count)||0,r=a+l,i=r/Math.max(...t.hourly_trend.map(e=>(parseInt(e.free_count)||0)+(parseInt(e.paid_count)||0)),1)*100,n=r>0?a/r*i:0,c=r>0?l/r*i:0,o=new Date(e.hour).getHours();return(0,h.jsxs)("div",{className:"flex flex-col items-center flex-shrink-0",style:{width:"28px"},title:"".concat(o,":00 \u2014 Free: ").concat(a,", Paid: ").concat(l),children:[(0,h.jsxs)("div",{className:"flex flex-col justify-end",style:{height:"100px"},children:[(0,h.jsx)("div",{className:"bg-amber-500 w-5 rounded-t-sm",style:{height:"".concat(c,"%"),minHeight:l>0?"2px":0}}),(0,h.jsx)("div",{className:"bg-blue-500 w-5 rounded-b-sm",style:{height:"".concat(n,"%"),minHeight:a>0?"2px":0}})]}),(0,h.jsx)("span",{className:"text-gray-600 text-[9px] mt-1",children:o})]},s)})})]}),(0,h.jsxs)(x.A,{className:"p-5 border border-white/10",children:[(0,h.jsx)("h3",{className:"text-white font-semibold mb-3",children:"Today's Session Stats"}),(0,h.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-500 text-xs",children:"Free Avg Duration"}),(0,h.jsxs)("p",{className:"text-blue-400 text-lg font-bold",children:[Math.round((parseFloat(null===l||void 0===l?void 0:l.free_avg_duration)||0)/60),"m"]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-500 text-xs",children:"Paid Avg Duration"}),(0,h.jsxs)("p",{className:"text-amber-400 text-lg font-bold",children:[Math.round((parseFloat(null===l||void 0===l?void 0:l.paid_avg_duration)||0)/60),"m"]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-500 text-xs",children:"Free Data Today"}),(0,h.jsx)("p",{className:"text-blue-400 text-lg font-bold",children:J(null===l||void 0===l?void 0:l.free_data_today)})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-gray-500 text-xs",children:"Paid Data Today"}),(0,h.jsx)("p",{className:"text-amber-400 text-lg font-bold",children:J(null===l||void 0===l?void 0:l.paid_data_today)})]})]})]})]});var r,i},te=e=>{var t,s;let{data:a}=e;if(!a||0===a.length)return(0,h.jsxs)(x.A,{className:"p-12 text-center",children:[(0,h.jsx)(c.OKX,{className:"text-gray-600 text-4xl mx-auto mb-3"}),(0,h.jsx)("p",{className:"text-gray-400 text-lg",children:"No historical data yet"}),(0,h.jsx)("p",{className:"text-gray-600 text-sm",children:'Daily snapshots are taken at 23:55 UTC. Click "Snapshot" to take one now.'})]});const l=a[0],r=a.length>1?a[1]:null,i=(e,t)=>{if(!t)return null;const s=e-t;return s>0?"+".concat(s):s<0?"".concat(s):"="},n=[...a].reverse();return(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)(x.A,{className:"p-5 border border-indigo-500/30",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,h.jsxs)("h3",{className:"text-white font-semibold",children:["Latest: ",null===(t=l.snapshot_date)||void 0===t?void 0:t.split("T")[0]]}),r&&(0,h.jsxs)("span",{className:"text-gray-500 text-xs",children:["vs ",null===(s=r.snapshot_date)||void 0===s?void 0:s.split("T")[0]]})]}),(0,h.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:[(0,h.jsx)(ae,{label:"Free Total",value:l.free_total,trend:i(l.free_total,null===r||void 0===r?void 0:r.free_total),color:"blue"}),(0,h.jsx)(ae,{label:"Paid Total",value:l.paid_total,trend:i(l.paid_total,null===r||void 0===r?void 0:r.paid_total),color:"amber"}),(0,h.jsx)(ae,{label:"Free Active",value:l.free_active,trend:i(l.free_active,null===r||void 0===r?void 0:r.free_active),color:"blue"}),(0,h.jsx)(ae,{label:"Paid Active",value:l.paid_active,trend:i(l.paid_active,null===r||void 0===r?void 0:r.paid_active),color:"amber"}),(0,h.jsx)(ae,{label:"Conversions",value:l.conversions,trend:i(l.conversions,null===r||void 0===r?void 0:r.conversions),color:"green"}),(0,h.jsx)(ae,{label:"Churns",value:l.churns,trend:i(l.churns,null===r||void 0===r?void 0:r.churns),color:"red"})]})]}),(0,h.jsxs)(x.A,{className:"p-5 border border-white/10",children:[(0,h.jsx)("h3",{className:"text-white font-semibold mb-3",children:"User Growth Trend"}),(0,h.jsx)("div",{className:"flex items-end gap-1 h-40 overflow-x-auto pb-6 relative",children:n.map((e,t)=>{var s,a,l;const r=Math.max(...n.map(e=>Math.max(e.free_total||0,e.paid_total||0)),1),i=(e.free_total||0)/r*100,c=(e.paid_total||0)/r*100,o=null===(s=e.snapshot_date)||void 0===s||null===(a=s.split("T")[0])||void 0===a?void 0:a.slice(5);return(0,h.jsxs)("div",{className:"flex flex-col items-center flex-shrink-0",style:{width:"36px"},title:"".concat(null===(l=e.snapshot_date)||void 0===l?void 0:l.split("T")[0],"\nFree: ").concat(e.free_total,"\nPaid: ").concat(e.paid_total),children:[(0,h.jsxs)("div",{className:"flex gap-0.5 items-end",style:{height:"120px"},children:[(0,h.jsx)("div",{className:"bg-blue-500/80 w-3 rounded-t-sm transition-all",style:{height:"".concat(i,"%"),minHeight:"2px"}}),(0,h.jsx)("div",{className:"bg-amber-500/80 w-3 rounded-t-sm transition-all",style:{height:"".concat(c,"%"),minHeight:"2px"}})]}),(0,h.jsx)("span",{className:"text-gray-600 text-[9px] mt-1 transform -rotate-45 origin-top-left whitespace-nowrap",children:o})]},t)})})]}),(0,h.jsxs)(x.A,{className:"p-5 border border-white/10",children:[(0,h.jsx)("h3",{className:"text-white font-semibold mb-3",children:"Daily Connections"}),(0,h.jsx)("div",{className:"flex items-end gap-1 h-32 overflow-x-auto pb-6",children:n.map((e,t)=>{var s,a,l;const r=e.free_connections||0,i=e.paid_connections||0,c=r+i,o=c/Math.max(...n.map(e=>(e.free_connections||0)+(e.paid_connections||0)),1)*100,d=c>0?r/c*o:0,x=c>0?i/c*o:0,m=null===(s=e.snapshot_date)||void 0===s||null===(a=s.split("T")[0])||void 0===a?void 0:a.slice(5);return(0,h.jsxs)("div",{className:"flex flex-col items-center flex-shrink-0",style:{width:"36px"},title:"".concat(null===(l=e.snapshot_date)||void 0===l?void 0:l.split("T")[0],"\nFree: ").concat(r,"\nPaid: ").concat(i),children:[(0,h.jsxs)("div",{className:"flex flex-col justify-end",style:{height:"100px"},children:[(0,h.jsx)("div",{className:"bg-amber-500 w-5 rounded-t-sm",style:{height:"".concat(x,"%"),minHeight:i>0?"2px":0}}),(0,h.jsx)("div",{className:"bg-blue-500 w-5",style:{height:"".concat(d,"%"),minHeight:r>0?"2px":0}})]}),(0,h.jsx)("span",{className:"text-gray-600 text-[9px] mt-1 transform -rotate-45 origin-top-left whitespace-nowrap",children:m})]},t)})})]}),(0,h.jsxs)(x.A,{className:"p-5 border border-white/10",children:[(0,h.jsx)("h3",{className:"text-white font-semibold mb-3",children:"Daily Data Transfer"}),(0,h.jsx)("div",{className:"flex items-end gap-1 h-32 overflow-x-auto pb-6",children:n.map((e,t)=>{var s,a,l;const r=parseInt(e.free_data_bytes)||0,i=parseInt(e.paid_data_bytes)||0,c=r+i,o=c/Math.max(...n.map(e=>(parseInt(e.free_data_bytes)||0)+(parseInt(e.paid_data_bytes)||0)),1)*100,d=c>0?r/c*o:0,x=c>0?i/c*o:0,m=null===(s=e.snapshot_date)||void 0===s||null===(a=s.split("T")[0])||void 0===a?void 0:a.slice(5);return(0,h.jsxs)("div",{className:"flex flex-col items-center flex-shrink-0",style:{width:"36px"},title:"".concat(null===(l=e.snapshot_date)||void 0===l?void 0:l.split("T")[0],"\nFree: ").concat(J(r),"\nPaid: ").concat(J(i)),children:[(0,h.jsxs)("div",{className:"flex flex-col justify-end",style:{height:"100px"},children:[(0,h.jsx)("div",{className:"bg-amber-500/70 w-5 rounded-t-sm",style:{height:"".concat(x,"%"),minHeight:i>0?"2px":0}}),(0,h.jsx)("div",{className:"bg-blue-500/70 w-5",style:{height:"".concat(d,"%"),minHeight:r>0?"2px":0}})]}),(0,h.jsx)("span",{className:"text-gray-600 text-[9px] mt-1 transform -rotate-45 origin-top-left whitespace-nowrap",children:m})]},t)})})]}),(0,h.jsxs)(x.A,{className:"p-5 border border-white/10 overflow-x-auto",children:[(0,h.jsx)("h3",{className:"text-white font-semibold mb-3",children:"Daily Breakdown"}),(0,h.jsxs)("table",{className:"w-full text-sm",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"text-gray-500 text-xs border-b border-white/10",children:[(0,h.jsx)("th",{className:"text-left py-2 pr-3",children:"Date"}),(0,h.jsx)("th",{className:"text-right py-2 px-2",children:"Free"}),(0,h.jsx)("th",{className:"text-right py-2 px-2",children:"Paid"}),(0,h.jsx)("th",{className:"text-right py-2 px-2",children:"F Active"}),(0,h.jsx)("th",{className:"text-right py-2 px-2",children:"P Active"}),(0,h.jsx)("th",{className:"text-right py-2 px-2",children:"F Conn"}),(0,h.jsx)("th",{className:"text-right py-2 px-2",children:"P Conn"}),(0,h.jsx)("th",{className:"text-right py-2 px-2",children:"F Data"}),(0,h.jsx)("th",{className:"text-right py-2 px-2",children:"P Data"}),(0,h.jsx)("th",{className:"text-right py-2 px-2",children:"Conv"}),(0,h.jsx)("th",{className:"text-right py-2 px-2",children:"Churn"})]})}),(0,h.jsx)("tbody",{children:a.map((e,t)=>{var s;return(0,h.jsxs)("tr",{className:"border-b border-white/5 hover:bg-white/5",children:[(0,h.jsx)("td",{className:"py-2 pr-3 text-gray-300 whitespace-nowrap",children:null===(s=e.snapshot_date)||void 0===s?void 0:s.split("T")[0]}),(0,h.jsx)("td",{className:"py-2 px-2 text-right text-blue-400",children:$(e.free_total)}),(0,h.jsx)("td",{className:"py-2 px-2 text-right text-amber-400",children:$(e.paid_total)}),(0,h.jsx)("td",{className:"py-2 px-2 text-right text-blue-300",children:$(e.free_active)}),(0,h.jsx)("td",{className:"py-2 px-2 text-right text-amber-300",children:$(e.paid_active)}),(0,h.jsx)("td",{className:"py-2 px-2 text-right text-blue-400",children:$(e.free_connections)}),(0,h.jsx)("td",{className:"py-2 px-2 text-right text-amber-400",children:$(e.paid_connections)}),(0,h.jsx)("td",{className:"py-2 px-2 text-right text-blue-300 whitespace-nowrap",children:J(e.free_data_bytes)}),(0,h.jsx)("td",{className:"py-2 px-2 text-right text-amber-300 whitespace-nowrap",children:J(e.paid_data_bytes)}),(0,h.jsx)("td",{className:"py-2 px-2 text-right text-green-400",children:e.conversions||0}),(0,h.jsx)("td",{className:"py-2 px-2 text-right text-red-400",children:e.churns||0})]},t)})})]})]})]})},se=e=>{let{icon:t,iconColor:s,label:a,value:l,sub:r}=e;return(0,h.jsxs)(x.A,{className:"p-4 border border-".concat(s,"-500/20"),children:[(0,h.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,h.jsx)(t,{className:"text-".concat(s,"-400 text-sm")}),(0,h.jsx)("p",{className:"text-".concat(s,"-400 text-xs uppercase"),children:a})]}),(0,h.jsx)("p",{className:"text-white text-2xl font-bold",children:"number"===typeof l?$(l):l}),r&&(0,h.jsx)("p",{className:"text-gray-500 text-xs mt-0.5",children:r})]})},ae=e=>{let{label:t,value:s,trend:a,color:l}=e;return(0,h.jsxs)("div",{className:"bg-white/5 rounded-lg p-3 border border-".concat(l,"-500/20"),children:[(0,h.jsx)("p",{className:"text-gray-500 text-xs",children:t}),(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)("p",{className:"text-".concat(l,"-400 text-xl font-bold"),children:$(s)}),a&&"="!==a&&(0,h.jsxs)("span",{className:"text-xs flex items-center gap-0.5 ".concat(a.startsWith("+")?"text-green-400":"text-red-400"),children:[a.startsWith("+")?(0,h.jsx)(c.uCC,{className:"text-[8px]"}):(0,h.jsx)(c.$TP,{className:"text-[8px]"}),a]})]})]})},le=()=>{const[e,t]=(0,l.useState)("live"),[s,a]=(0,l.useState)(null),[r,i]=(0,l.useState)([]),[n,o]=(0,l.useState)(30),[x,m]=(0,l.useState)(!0),[p,u]=(0,l.useState)(!0),[g,b]=(0,l.useState)(null),y=(0,l.useCallback)(async()=>{try{const e=await d.Kp.getSegmentLive();a(e.data)}catch(e){console.error("Segment live error:",e)}finally{m(!1)}},[]),j=(0,l.useCallback)(async()=>{try{var e;m(!0);const t=await d.Kp.getSegmentHistory(n);i((null===(e=t.data)||void 0===e?void 0:e.data)||[])}catch(t){console.error("Segment history error:",t)}finally{m(!1)}},[n]);(0,l.useEffect)(()=>{"live"===e?y():j()},[e,y,j]),(0,l.useEffect)(()=>{if(!p||"live"!==e)return;const t=setInterval(y,3e4);return()=>clearInterval(t)},[p,e,y]);return(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,h.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[(0,h.jsx)(c.v$b,{className:"text-indigo-400"})," User Segment Analytics"]}),(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsxs)("div",{className:"flex rounded-lg overflow-hidden border border-white/10",children:[(0,h.jsxs)("button",{onClick:()=>t("live"),className:"px-4 py-1.5 text-sm font-medium flex items-center gap-1 ".concat("live"===e?"bg-indigo-600 text-white":"bg-white/5 text-gray-400 hover:bg-white/10"),children:[(0,h.jsx)(c.nVN,{className:"text-xs"})," Live"]}),(0,h.jsxs)("button",{onClick:()=>t("history"),className:"px-4 py-1.5 text-sm font-medium flex items-center gap-1 ".concat("history"===e?"bg-indigo-600 text-white":"bg-white/5 text-gray-400 hover:bg-white/10"),children:[(0,h.jsx)(c.OKX,{className:"text-xs"})," History"]})]}),"live"===e&&(0,h.jsxs)("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[(0,h.jsx)("input",{type:"checkbox",checked:p,onChange:e=>u(e.target.checked),className:"rounded"}),"Live (30s)"]}),"history"===e&&(0,h.jsxs)("select",{value:n,onChange:e=>o(Number(e.target.value)),className:"bg-white/5 border border-white/10 text-gray-300 rounded px-3 py-1.5 text-sm",children:[(0,h.jsx)("option",{value:7,children:"7 days"}),(0,h.jsx)("option",{value:14,children:"14 days"}),(0,h.jsx)("option",{value:30,children:"30 days"}),(0,h.jsx)("option",{value:90,children:"90 days"}),(0,h.jsx)("option",{value:365,children:"1 year"})]}),(0,h.jsxs)("button",{onClick:"live"===e?y:j,className:"px-3 py-1.5 rounded bg-white/5 hover:bg-white/10 text-gray-300 text-sm flex items-center gap-1",children:[(0,h.jsx)(c.DIg,{className:"text-xs"})," Refresh"]}),(0,h.jsxs)("button",{onClick:async()=>{b("taking...");try{await d.Kp.takeSegmentSnapshot(),b("done \u2713"),"history"===e&&j()}catch(t){b("failed")}setTimeout(()=>b(null),3e3)},className:"px-3 py-1.5 rounded bg-purple-600/30 hover:bg-purple-600/50 text-purple-300 text-sm flex items-center gap-1",children:[(0,h.jsx)(c.p5B,{className:"text-xs"})," ",g||"Snapshot"]})]})]}),(0,h.jsxs)("div",{className:"flex items-center gap-4 text-xs",children:[(0,h.jsxs)("span",{className:"flex items-center gap-1",children:[(0,h.jsx)("span",{className:"w-3 h-3 rounded-full bg-blue-500 inline-block"})," Free users"]}),(0,h.jsxs)("span",{className:"flex items-center gap-1",children:[(0,h.jsx)("span",{className:"w-3 h-3 rounded-full bg-amber-500 inline-block"})," Paid users"]})]}),!x||s||r.length?"live"===e?(0,h.jsx)(ee,{data:s}):(0,h.jsx)(te,{data:r}):(0,h.jsx)("div",{className:"text-center text-gray-400 py-12",children:"Loading segment data..."})]})},re=()=>{const[e,t]=(0,l.useState)([]),[s,a]=(0,l.useState)(!0),[r,i]=(0,l.useState)(null),[n,o]=(0,l.useState)([]);(0,l.useEffect)(()=>{p();const e=setInterval(p,3e4);return()=>clearInterval(e)},[]);const p=async()=>{try{var e;a(!0);const s=await d.Kp.getHighRiskUsers();t((null===(e=s.data)||void 0===e?void 0:e.users)||s.data||[])}catch(s){console.error("Failed to load high-risk users:",s)}finally{a(!1)}};return s&&0===e.length?(0,h.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,h.jsx)("div",{className:"spinner"}),(0,h.jsx)("span",{className:"ml-3 text-white",children:"Loading abuse data..."})]}):(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,h.jsxs)("h2",{className:"text-2xl font-bold text-white flex items-center",children:[(0,h.jsx)(c.SMR,{className:"mr-3 text-red-400"}),"Abuse Detection"]}),(0,h.jsx)(m.A,{variant:"outline",size:"sm",icon:(0,h.jsx)(c.DIg,{}),onClick:p,children:"Refresh"})]}),0===e.length?(0,h.jsx)("p",{className:"text-gray-400 text-center py-8",children:"No high-risk users detected"}):(0,h.jsx)("div",{className:"overflow-x-auto",children:(0,h.jsxs)("table",{className:"w-full text-sm",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-gray-600 text-gray-400",children:[(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"User"}),(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Risk Score"}),(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Flags"}),(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Last Checked"}),(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Actions"})]})}),(0,h.jsx)("tbody",{children:e.map(e=>(0,h.jsxs)("tr",{className:"border-b border-gray-700 hover:bg-white/5",children:[(0,h.jsx)("td",{className:"py-3 px-2 text-white",children:e.email||e.user_id}),(0,h.jsx)("td",{className:"py-3 px-2",children:(0,h.jsx)("span",{className:"px-2 py-1 rounded text-xs font-bold ".concat((e.risk_score||0)>80?"bg-red-500/20 text-red-300":(e.risk_score||0)>50?"bg-yellow-500/20 text-yellow-300":"bg-green-500/20 text-green-300"),children:e.risk_score||0})}),(0,h.jsx)("td",{className:"py-3 px-2 text-gray-300 text-xs max-w-xs truncate",children:Array.isArray(e.flags)?e.flags.join(", "):e.flags||"\u2014"}),(0,h.jsx)("td",{className:"py-3 px-2 text-gray-400 text-xs",children:e.last_checked?new Date(e.last_checked).toLocaleString():"\u2014"}),(0,h.jsxs)("td",{className:"py-3 px-2 space-x-2",children:[(0,h.jsx)("button",{onClick:()=>(async e=>{try{var t;const s=await d.Kp.getAbuseHistory(e);o((null===(t=s.data)||void 0===t?void 0:t.history)||s.data||[]),i(e)}catch(s){console.error("Failed to load abuse history:",s)}})(e.id||e.user_id),className:"text-xs text-blue-400 hover:text-blue-300",children:"History"}),(0,h.jsx)("button",{onClick:()=>(async e=>{try{await d.Kp.evaluateAbuse(e),p()}catch(t){console.error("Failed to evaluate user:",t)}})(e.id||e.user_id),className:"text-xs text-yellow-400 hover:text-yellow-300",children:"Re-evaluate"}),(0,h.jsx)("button",{onClick:()=>(async e=>{try{await d.Kp.resetAbuseScore(e),p()}catch(t){console.error("Failed to reset score:",t)}})(e.id||e.user_id),className:"text-xs text-green-400 hover:text-green-300",children:"Reset"})]})]},e.id||e.user_id))})]})})]}),r&&(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,h.jsxs)("h3",{className:"text-lg font-bold text-white",children:["Abuse History \u2014 ",r]}),(0,h.jsx)("button",{onClick:()=>i(null),className:"text-gray-400 hover:text-white",children:"\u2715"})]}),0===n.length?(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:"No abuse history"}):(0,h.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:n.map((e,t)=>(0,h.jsxs)("div",{className:"flex justify-between items-center p-2 bg-gray-700/30 rounded text-sm",children:[(0,h.jsx)("span",{className:"text-white",children:e.action||e.type||"Event"}),(0,h.jsx)("span",{className:"text-gray-400 text-xs",children:e.created_at?new Date(e.created_at).toLocaleString():""})]},t))})]})]})},ie=()=>{const[e,t]=(0,l.useState)([]),[s,a]=(0,l.useState)(!0),[r,i]=(0,l.useState)(null),[n,o]=(0,l.useState)([]);(0,l.useEffect)(()=>{p();const e=setInterval(p,3e4);return()=>clearInterval(e)},[]);const p=async()=>{try{var e;a(!0);const s=await d.Kp.getTopSessionUsers();t((null===(e=s.data)||void 0===e?void 0:e.users)||s.data||[])}catch(s){console.error("Failed to load top users:",s)}finally{a(!1)}},u=async e=>{try{var t;const s=await d.Kp.getUserSessions(e);o((null===(t=s.data)||void 0===t?void 0:t.sessions)||s.data||[]),i(e)}catch(s){console.error("Failed to load sessions:",s)}};return s&&0===e.length?(0,h.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,h.jsx)("div",{className:"spinner"}),(0,h.jsx)("span",{className:"ml-3 text-white",children:"Loading sessions..."})]}):(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,h.jsxs)("h2",{className:"text-2xl font-bold text-white flex items-center",children:[(0,h.jsx)(c.O2x,{className:"mr-3 text-green-400"}),"Session Control"]}),(0,h.jsx)(m.A,{variant:"outline",size:"sm",icon:(0,h.jsx)(c.DIg,{}),onClick:p,children:"Refresh"})]}),(0,h.jsx)("p",{className:"text-gray-400 text-sm mb-4",children:"Top users by active connections"}),0===e.length?(0,h.jsx)("p",{className:"text-gray-400 text-center py-8",children:"No active sessions"}):(0,h.jsx)("div",{className:"overflow-x-auto",children:(0,h.jsxs)("table",{className:"w-full text-sm",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-gray-600 text-gray-400",children:[(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"User"}),(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Active Sessions"}),(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Total Data"}),(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Actions"})]})}),(0,h.jsx)("tbody",{children:e.map(e=>(0,h.jsxs)("tr",{className:"border-b border-gray-700 hover:bg-white/5",children:[(0,h.jsxs)("td",{className:"py-3 px-2 text-white flex items-center gap-2",children:[(0,h.jsx)(c.x$1,{className:"text-gray-400"}),e.email||e.user_id]}),(0,h.jsx)("td",{className:"py-3 px-2",children:(0,h.jsx)("span",{className:"px-2 py-1 rounded text-xs font-bold bg-blue-500/20 text-blue-300",children:e.active_connections||e.session_count||0})}),(0,h.jsx)("td",{className:"py-3 px-2 text-gray-300",children:e.total_data||"\u2014"}),(0,h.jsxs)("td",{className:"py-3 px-2 space-x-2",children:[(0,h.jsx)("button",{onClick:()=>u(e.id||e.user_id),className:"text-xs text-blue-400 hover:text-blue-300",children:"View"}),(0,h.jsx)("button",{onClick:()=>(async e=>{try{await d.Kp.disconnectAllSessions(e),p(),r===e&&u(e)}catch(t){console.error("Failed to disconnect:",t)}})(e.id||e.user_id),className:"text-xs text-red-400 hover:text-red-300",children:"Disconnect All"})]})]},e.id||e.user_id))})]})})]}),r&&(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,h.jsxs)("h3",{className:"text-lg font-bold text-white",children:["Sessions \u2014 ",r]}),(0,h.jsx)("button",{onClick:()=>i(null),className:"text-gray-400 hover:text-white",children:"\u2715"})]}),0===n.length?(0,h.jsx)("p",{className:"text-gray-400 text-sm",children:"No active sessions"}):(0,h.jsx)("div",{className:"overflow-x-auto",children:(0,h.jsxs)("table",{className:"w-full text-sm",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-gray-600 text-gray-400",children:[(0,h.jsx)("th",{className:"text-left py-2 px-2",children:"Server"}),(0,h.jsx)("th",{className:"text-left py-2 px-2",children:"Protocol"}),(0,h.jsx)("th",{className:"text-left py-2 px-2",children:"Connected"}),(0,h.jsx)("th",{className:"text-left py-2 px-2",children:"Action"})]})}),(0,h.jsx)("tbody",{children:n.map(e=>(0,h.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,h.jsx)("td",{className:"py-2 px-2 text-white",children:e.server_name||e.server_id||"\u2014"}),(0,h.jsx)("td",{className:"py-2 px-2",children:(0,h.jsx)("span",{className:"px-2 py-0.5 bg-blue-500/20 text-blue-300 rounded text-xs",children:e.protocol||"\u2014"})}),(0,h.jsx)("td",{className:"py-2 px-2 text-gray-300 text-xs",children:e.connected_at?new Date(e.connected_at).toLocaleString():"\u2014"}),(0,h.jsx)("td",{className:"py-2 px-2",children:(0,h.jsxs)("button",{onClick:()=>(async e=>{try{await d.Kp.disconnectSession(e),r&&u(r),p()}catch(t){console.error("Failed to disconnect session:",t)}})(e.id),className:"text-xs text-red-400 hover:text-red-300 flex items-center gap-1",children:[(0,h.jsx)(c.axc,{})," Kill"]})})]},e.id))})]})})]})]})},ne=()=>{const[e,t]=(0,l.useState)([]),[s,a]=(0,l.useState)(!0),[r,i]=(0,l.useState)(null),[n,o]=(0,l.useState)("");(0,l.useEffect)(()=>{p();const e=setInterval(p,3e4);return()=>clearInterval(e)},[]);const p=async()=>{try{var e;a(!0);const s=await d.Kp.getLoadDistribution();t((null===(e=s.data)||void 0===e?void 0:e.servers)||s.data||[])}catch(s){console.error("Failed to load distribution:",s)}finally{a(!1)}};return s&&0===e.length?(0,h.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,h.jsx)("div",{className:"spinner"}),(0,h.jsx)("span",{className:"ml-3 text-white",children:"Loading load data..."})]}):(0,h.jsx)("div",{className:"space-y-6",children:(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,h.jsxs)("h2",{className:"text-2xl font-bold text-white flex items-center",children:[(0,h.jsx)(c.CbL,{className:"mr-3 text-indigo-400"}),"Load Balancer"]}),(0,h.jsx)(m.A,{variant:"outline",size:"sm",icon:(0,h.jsx)(c.DIg,{}),onClick:p,children:"Refresh"})]}),0===e.length?(0,h.jsx)("p",{className:"text-gray-400 text-center py-8",children:"No load distribution data"}):(0,h.jsx)("div",{className:"overflow-x-auto",children:(0,h.jsxs)("table",{className:"w-full text-sm",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-gray-600 text-gray-400",children:[(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Server"}),(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Status"}),(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Connections"}),(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Load %"}),(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Weight"}),(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Actions"})]})}),(0,h.jsx)("tbody",{children:e.map(e=>{const t=e.load_percent||e.current_load||0;return(0,h.jsxs)("tr",{className:"border-b border-gray-700 hover:bg-white/5",children:[(0,h.jsxs)("td",{className:"py-3 px-2 text-white flex items-center gap-2",children:[(0,h.jsx)(c.vwk,{className:"text-gray-400"}),e.name||e.server_name||e.server_id]}),(0,h.jsx)("td",{className:"py-3 px-2",children:(0,h.jsx)("span",{className:"px-2 py-1 rounded text-xs font-bold ".concat("online"===e.status?"bg-green-500/20 text-green-300":"maintenance"===e.status?"bg-yellow-500/20 text-yellow-300":"bg-red-500/20 text-red-300"),children:e.status||"\u2014"})}),(0,h.jsxs)("td",{className:"py-3 px-2 text-gray-300",children:[e.active_connections||0," / ",e.max_connections||e.capacity||"\u221e"]}),(0,h.jsx)("td",{className:"py-3 px-2",children:(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)("div",{className:"w-24 bg-gray-700 rounded-full h-2",children:(0,h.jsx)("div",{className:"h-2 rounded-full ".concat(t>80?"bg-red-500":t>50?"bg-yellow-500":"bg-green-500"),style:{width:"".concat(Math.min(t,100),"%")}})}),(0,h.jsxs)("span",{className:"text-gray-300 text-xs",children:[Math.round(t),"%"]})]})}),(0,h.jsx)("td",{className:"py-3 px-2",children:r===(e.id||e.server_id)?(0,h.jsxs)("div",{className:"flex gap-1",children:[(0,h.jsx)("input",{type:"number",value:n,onChange:e=>o(e.target.value),className:"w-16 px-2 py-1 rounded bg-gray-600 text-white text-xs border border-gray-500",step:"0.1",min:"0",max:"10"}),(0,h.jsx)("button",{onClick:()=>(async e=>{try{await d.Kp.setServerWeight(e,parseFloat(n)),i(null),p()}catch(t){console.error("Failed to update weight:",t)}})(e.id||e.server_id),className:"text-xs text-green-400 hover:text-green-300",children:"Save"}),(0,h.jsx)("button",{onClick:()=>i(null),className:"text-xs text-gray-400 hover:text-gray-300",children:"\u2715"})]}):(0,h.jsx)("span",{className:"text-gray-300",children:e.weight||1})}),(0,h.jsx)("td",{className:"py-3 px-2",children:(0,h.jsx)("button",{onClick:()=>{i(e.id||e.server_id),o(String(e.weight||1))},className:"text-xs text-blue-400 hover:text-blue-300",children:"Edit Weight"})})]},e.id||e.server_id)})})]})})]})})},ce=()=>{const[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)(!0),[i,n]=(0,l.useState)(null),[o,p]=(0,l.useState)({}),[u,g]=(0,l.useState)(null);(0,l.useEffect)(()=>{b()},[]);const b=async()=>{try{var e;r(!0);const s=await d.Kp.getQoSConfig(),l=(null===(e=s.data)||void 0===e?void 0:e.config)||s.data||[];t(Array.isArray(l)?l:Object.entries(l).map(e=>{let[t,s]=e;return(0,a.A)({tier:t},s)}))}catch(s){console.error("Failed to load QoS config:",s)}finally{r(!1)}},y=async()=>{try{await d.Kp.updateQoSConfig(i,o),n(null),g({type:"success",text:"QoS updated for ".concat(i," tier")}),b(),setTimeout(()=>g(null),3e3)}catch(e){g({type:"error",text:"Failed to update QoS config"})}};return s?(0,h.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,h.jsx)("div",{className:"spinner"}),(0,h.jsx)("span",{className:"ml-3 text-white",children:"Loading QoS..."})]}):(0,h.jsx)("div",{className:"space-y-6",children:(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,h.jsxs)("h2",{className:"text-2xl font-bold text-white flex items-center",children:[(0,h.jsx)(c.$BV,{className:"mr-3 text-cyan-400"}),"QoS Management"]}),(0,h.jsx)(m.A,{variant:"outline",size:"sm",icon:(0,h.jsx)(c.DIg,{}),onClick:b,children:"Refresh"})]}),u&&(0,h.jsx)("div",{className:"p-3 rounded-lg mb-4 text-sm ".concat("success"===u.type?"bg-green-500/20 text-green-300":"bg-red-500/20 text-red-300"),children:u.text}),(0,h.jsx)("div",{className:"grid md:grid-cols-3 gap-6",children:["free","paid","admin"].map(t=>{const s=e.find(e=>e.tier===t)||{},l=i===t;return(0,h.jsxs)(x.A,{className:"p-5 bg-gradient-to-br from-gray-700/50 to-gray-800/50",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,h.jsxs)("h3",{className:"text-lg font-bold text-white capitalize",children:[t," Tier"]}),!l&&(0,h.jsx)("button",{onClick:()=>(t=>{const s=e.find(e=>e.tier===t)||{};p({max_download_mbps:s.max_download_mbps||"",max_upload_mbps:s.max_upload_mbps||"",max_daily_gb:s.max_daily_gb||"",max_monthly_gb:s.max_monthly_gb||"",priority:s.priority||""}),n(t)})(t),className:"text-xs text-blue-400 hover:text-blue-300",children:"Edit"})]}),l?(0,h.jsxs)("div",{className:"space-y-3",children:[[{key:"max_download_mbps",label:"Max Download (Mbps)"},{key:"max_upload_mbps",label:"Max Upload (Mbps)"},{key:"max_daily_gb",label:"Max Daily (GB)"},{key:"max_monthly_gb",label:"Max Monthly (GB)"},{key:"priority",label:"Priority (1-10)"}].map(e=>{let{key:t,label:s}=e;return(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"text-gray-400 text-xs",children:s}),(0,h.jsx)("input",{type:"number",value:o[t],onChange:e=>p((0,a.A)((0,a.A)({},o),{},{[t]:e.target.value})),className:"w-full mt-1 px-3 py-2 rounded bg-gray-600 text-white text-sm border border-gray-500"})]},t)}),(0,h.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,h.jsx)("button",{onClick:y,className:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white rounded text-sm",children:"Save"}),(0,h.jsx)("button",{onClick:()=>n(null),className:"px-3 py-1.5 bg-gray-600 hover:bg-gray-700 text-white rounded text-sm",children:"Cancel"})]})]}):(0,h.jsxs)("div",{className:"space-y-2",children:[(0,h.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,h.jsx)("span",{className:"text-gray-400",children:"Download"}),(0,h.jsxs)("span",{className:"text-white",children:[s.max_download_mbps||"\u221e"," Mbps"]})]}),(0,h.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,h.jsx)("span",{className:"text-gray-400",children:"Upload"}),(0,h.jsxs)("span",{className:"text-white",children:[s.max_upload_mbps||"\u221e"," Mbps"]})]}),(0,h.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,h.jsx)("span",{className:"text-gray-400",children:"Daily Limit"}),(0,h.jsxs)("span",{className:"text-white",children:[s.max_daily_gb||"\u221e"," GB"]})]}),(0,h.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,h.jsx)("span",{className:"text-gray-400",children:"Monthly Limit"}),(0,h.jsxs)("span",{className:"text-white",children:[s.max_monthly_gb||"\u221e"," GB"]})]}),(0,h.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,h.jsx)("span",{className:"text-gray-400",children:"Priority"}),(0,h.jsx)("span",{className:"text-white",children:s.priority||"\u2014"})]})]})]},t)})})]})})},oe=()=>{const[e,t]=(0,l.useState)([]),[s,a]=(0,l.useState)(null),[r,i]=(0,l.useState)(!0),[n,o]=(0,l.useState)("exports");(0,l.useEffect)(()=>{p()},[]);const p=async()=>{try{var e;i(!0);const[s,l]=await Promise.all([d.Kp.getGdprExportRequests().catch(()=>({data:{requests:[]}})),d.Kp.getConsentAnalytics().catch(()=>({data:{}}))]);t((null===(e=s.data)||void 0===e?void 0:e.requests)||s.data||[]),a(l.data)}catch(s){console.error("Failed to load GDPR data:",s)}finally{i(!1)}};return r?(0,h.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,h.jsx)("div",{className:"spinner"}),(0,h.jsx)("span",{className:"ml-3 text-white",children:"Loading GDPR data..."})]}):(0,h.jsx)("div",{className:"space-y-6",children:(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,h.jsxs)("h2",{className:"text-2xl font-bold text-white flex items-center",children:[(0,h.jsx)(c.JhU,{className:"mr-3 text-emerald-400"}),"GDPR & Privacy Compliance"]}),(0,h.jsx)(m.A,{variant:"outline",size:"sm",icon:(0,h.jsx)(c.DIg,{}),onClick:p,children:"Refresh"})]}),(0,h.jsx)("div",{className:"flex gap-2 mb-6",children:[{id:"exports",label:"Data Export Requests",icon:c.WCW},{id:"consent",label:"Consent Analytics",icon:c.e7y}].map(e=>(0,h.jsxs)("button",{onClick:()=>o(e.id),className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm transition ".concat(n===e.id?"bg-blue-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-white"),children:[(0,h.jsx)(e.icon,{size:14})," ",e.label]},e.id))}),"exports"===n&&(0,h.jsx)("div",{children:Array.isArray(e)&&e.length>0?(0,h.jsx)("div",{className:"overflow-x-auto",children:(0,h.jsxs)("table",{className:"w-full text-sm",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-gray-600 text-gray-400",children:[(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"User"}),(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Status"}),(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Requested"}),(0,h.jsx)("th",{className:"text-left py-3 px-2",children:"Completed"})]})}),(0,h.jsx)("tbody",{children:e.map((e,t)=>(0,h.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,h.jsx)("td",{className:"py-3 px-2 text-white",children:e.email||e.user_id||"\u2014"}),(0,h.jsx)("td",{className:"py-3 px-2",children:(0,h.jsx)("span",{className:"px-2 py-1 rounded text-xs font-bold ".concat("completed"===e.status?"bg-green-500/20 text-green-300":"pending"===e.status?"bg-yellow-500/20 text-yellow-300":"bg-gray-500/20 text-gray-300"),children:e.status||"\u2014"})}),(0,h.jsx)("td",{className:"py-3 px-2 text-gray-400 text-xs",children:e.created_at?new Date(e.created_at).toLocaleString():"\u2014"}),(0,h.jsx)("td",{className:"py-3 px-2 text-gray-400 text-xs",children:e.completed_at?new Date(e.completed_at).toLocaleString():"\u2014"})]},e.id||t))})]})}):(0,h.jsx)("p",{className:"text-gray-400 text-center py-8",children:"No data export requests"})}),"consent"===n&&s&&(0,h.jsxs)("div",{className:"grid md:grid-cols-3 gap-6",children:[(0,h.jsxs)(x.A,{className:"p-5 bg-gradient-to-br from-green-600/20 to-green-800/20 border border-green-500/20",children:[(0,h.jsx)("p",{className:"text-green-200 text-sm mb-1",children:"Consented Users"}),(0,h.jsx)("p",{className:"text-white text-3xl font-bold",children:s.consented||s.total_consented||0})]}),(0,h.jsxs)(x.A,{className:"p-5 bg-gradient-to-br from-red-600/20 to-red-800/20 border border-red-500/20",children:[(0,h.jsx)("p",{className:"text-red-200 text-sm mb-1",children:"Declined / Withdrawn"}),(0,h.jsx)("p",{className:"text-white text-3xl font-bold",children:s.declined||s.total_declined||0})]}),(0,h.jsxs)(x.A,{className:"p-5 bg-gradient-to-br from-blue-600/20 to-blue-800/20 border border-blue-500/20",children:[(0,h.jsx)("p",{className:"text-blue-200 text-sm mb-1",children:"Pending"}),(0,h.jsx)("p",{className:"text-white text-3xl font-bold",children:s.pending||s.total_pending||0})]})]}),"consent"===n&&!s&&(0,h.jsx)("p",{className:"text-gray-400 text-center py-8",children:"No consent data available"})]})})};var de=s(4951);const xe=(0,l.lazy)(()=>Promise.all([s.e(163),s.e(921)]).then(s.bind(s,7921))),me=(0,l.lazy)(()=>s.e(194).then(s.bind(s,8194))),pe=()=>(0,h.jsxs)("div",{className:"flex items-center justify-center py-20",children:[(0,h.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"}),(0,h.jsx)("span",{className:"ml-3 text-gray-400",children:"Loading charts..."})]}),he=e=>{let{analytics:t,onNavigate:s}=e;return(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,h.jsx)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:(0,h.jsx)(x.A,{className:"p-4 bg-gradient-to-br from-blue-600 to-blue-800",children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-blue-200 text-xs",children:"Total Users"}),(0,h.jsx)("p",{className:"text-white text-2xl font-bold",children:(null===t||void 0===t?void 0:t.totalUsers)||0})]}),(0,h.jsx)(c.YXz,{className:"text-blue-200 text-3xl"})]})})}),(0,h.jsx)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:(0,h.jsx)(x.A,{className:"p-4 bg-gradient-to-br from-green-600 to-green-800",children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-green-200 text-xs",children:"Active Connections"}),(0,h.jsx)("p",{className:"text-white text-2xl font-bold",children:(null===t||void 0===t?void 0:t.activeConnections)||0})]}),(0,h.jsx)(c.nVN,{className:"text-green-200 text-3xl"})]})})}),(0,h.jsx)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:(0,h.jsx)(x.A,{className:"p-4 bg-gradient-to-br from-purple-600 to-purple-800",children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-purple-200 text-xs",children:"Premium Users"}),(0,h.jsx)("p",{className:"text-white text-2xl font-bold",children:(null===t||void 0===t?void 0:t.paidUsers)||0})]}),(0,h.jsx)(c.Hu1,{className:"text-purple-200 text-3xl"})]})})}),(0,h.jsx)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:(0,h.jsx)(x.A,{className:"p-4 bg-gradient-to-br from-yellow-600 to-yellow-800",children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"text-yellow-200 text-xs",children:"Free Users"}),(0,h.jsx)("p",{className:"text-white text-2xl font-bold",children:(null===t||void 0===t?void 0:t.freeUsers)||0})]}),(0,h.jsx)(c.YXz,{className:"text-yellow-200 text-3xl"})]})})})]}),(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsx)("h2",{className:"text-2xl font-bold text-white mb-4",children:"System Overview"}),(0,h.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("h3",{className:"text-lg font-semibold text-white mb-3",children:"User Statistics"}),(0,h.jsxs)("div",{className:"space-y-2 text-gray-300",children:[(0,h.jsxs)("div",{className:"flex justify-between",children:[(0,h.jsx)("span",{children:"Total Users:"}),(0,h.jsx)("span",{className:"font-bold text-white",children:(null===t||void 0===t?void 0:t.totalUsers)||0})]}),(0,h.jsxs)("div",{className:"flex justify-between",children:[(0,h.jsx)("span",{children:"Free Users:"}),(0,h.jsx)("span",{className:"font-bold text-white",children:(null===t||void 0===t?void 0:t.freeUsers)||0})]}),(0,h.jsxs)("div",{className:"flex justify-between",children:[(0,h.jsx)("span",{children:"Premium Users:"}),(0,h.jsx)("span",{className:"font-bold text-white",children:(null===t||void 0===t?void 0:t.paidUsers)||0})]}),(0,h.jsxs)("div",{className:"flex justify-between",children:[(0,h.jsx)("span",{children:"Conversion Rate:"}),(0,h.jsxs)("span",{className:"font-bold text-white",children:[(null===t||void 0===t?void 0:t.totalUsers)>0?(t.paidUsers/t.totalUsers*100).toFixed(1):0,"%"]})]})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("h3",{className:"text-lg font-semibold text-white mb-3",children:"Connection Statistics"}),(0,h.jsxs)("div",{className:"space-y-2 text-gray-300",children:[(0,h.jsxs)("div",{className:"flex justify-between",children:[(0,h.jsx)("span",{children:"Active Connections:"}),(0,h.jsx)("span",{className:"font-bold text-white",children:(null===t||void 0===t?void 0:t.activeConnections)||0})]}),(0,h.jsxs)("div",{className:"flex justify-between",children:[(0,h.jsx)("span",{children:"Server Capacity:"}),(0,h.jsx)("span",{className:"font-bold text-white",children:(null===t||void 0===t?void 0:t.serverCapacity)||0})]}),(0,h.jsxs)("div",{className:"flex justify-between",children:[(0,h.jsx)("span",{children:"Utilization:"}),(0,h.jsxs)("span",{className:"font-bold text-white",children:[(null===t||void 0===t?void 0:t.serverCapacity)>0?(((null===t||void 0===t?void 0:t.activeConnections)||0)/t.serverCapacity*100).toFixed(1):"0.0","%"]})]})]})]})]})]}),(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsx)("h2",{className:"text-2xl font-bold text-white mb-4",children:"Quick Actions"}),(0,h.jsxs)("div",{className:"grid md:grid-cols-4 gap-4",children:[(0,h.jsx)(m.A,{variant:"primary",icon:(0,h.jsx)(c.YXz,{}),onClick:()=>s("users"),children:"Manage Users"}),(0,h.jsx)(m.A,{variant:"secondary",icon:(0,h.jsx)(c.vwk,{}),onClick:()=>s("servers"),children:"Manage Servers"}),(0,h.jsx)(m.A,{variant:"outline",icon:(0,h.jsx)(c.Tsk,{}),onClick:()=>s("revenue"),children:"Revenue"}),(0,h.jsx)(m.A,{variant:"outline",icon:(0,h.jsx)(c.BS8,{}),onClick:()=>s("alerts"),children:"Alerts"})]})]})]})},ue=e=>{let{users:t,onRefresh:s,onEdit:r,onDelete:i,onCreateUser:n,onViewUser:o}=e;const[p,u]=(0,l.useState)("all"),[g,b]=(0,l.useState)(""),[y,N]=(0,l.useState)([]),[f,w]=(0,l.useState)(""),[_,k]=(0,l.useState)(!1),[C,A]=(0,l.useState)(null),[S,D]=(0,l.useState)(!1),{confirm:P,dialogProps:T}=(0,j.A)(),[L,F]=(0,l.useState)(1);(0,l.useEffect)(()=>{const e=setInterval(()=>s(),3e4);return()=>clearInterval(e)},[s]);const R=t.filter(e=>{const t="all"===p||e.tier===p,s=e.email.toLowerCase().includes(g.toLowerCase());return t&&s}),E=Math.ceil(R.length/25),U=R.slice(25*(L-1),25*L);return(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,h.jsx)("h2",{className:"text-2xl font-bold text-white",children:"User Management"}),(0,h.jsxs)("div",{className:"flex gap-2",children:[(0,h.jsx)(m.A,{variant:"outline",size:"sm",onClick:async()=>{D(!0);try{const e=await d.Kp.exportUsersCsv(),t=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.href=t,s.download="users-export.csv",s.click(),window.URL.revokeObjectURL(t)}catch(e){}D(!1)},disabled:S,children:S?"Exporting...":"Export CSV"}),(0,h.jsx)(m.A,{variant:"primary",size:"sm",icon:(0,h.jsx)(c.YXz,{}),onClick:n,children:"Add User"})]})]}),y.length>0&&(0,h.jsxs)("div",{className:"flex items-center gap-3 mb-4 p-3 rounded-lg bg-blue-500 bg-opacity-20 border border-blue-400 border-opacity-30",children:[(0,h.jsxs)("span",{className:"text-blue-300 font-medium",children:[y.length," selected"]}),(0,h.jsxs)("select",{value:f,onChange:e=>w(e.target.value),className:"px-3 py-1.5 rounded bg-white bg-opacity-10 border border-white border-opacity-20 text-white text-sm",children:[(0,h.jsx)("option",{value:"",children:"Choose action..."}),(0,h.jsx)("option",{value:"activate",children:"Activate"}),(0,h.jsx)("option",{value:"suspend",children:"Suspend"}),(0,h.jsx)("option",{value:"upgrade",children:"Upgrade to Premium"}),(0,h.jsx)("option",{value:"downgrade",children:"Downgrade to Free"}),(0,h.jsx)("option",{value:"delete",children:"Delete"})]}),(0,h.jsx)("button",{onClick:async()=>{if(!f||0===y.length)return;if(await P({title:"Bulk ".concat(f),message:"Are you sure you want to ".concat(f," ").concat(y.length," user(s)?"),confirmText:f.charAt(0).toUpperCase()+f.slice(1),variant:"delete"===f?"danger":"warning"})){k(!0),A(null);try{await d.Kp.bulkUserAction(f,y),N([]),w(""),s()}catch(a){var e,t;A("Bulk action failed: "+((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||a.message))}finally{k(!1)}}},disabled:!f||_,className:"px-4 py-1.5 rounded bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium disabled:opacity-50",children:_?"Processing...":"Apply"}),(0,h.jsx)("button",{onClick:()=>N([]),className:"text-gray-400 hover:text-white text-sm ml-auto",children:"Clear Selection"})]}),C&&(0,h.jsxs)("div",{className:"mb-4 p-3 rounded-lg bg-red-500 bg-opacity-20 border border-red-400 text-red-300 text-sm",children:[C,(0,h.jsx)("button",{onClick:()=>A(null),className:"ml-2 text-red-400 hover:text-white",children:"\u2715"})]}),(0,h.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,h.jsx)("input",{type:"text",placeholder:"Search by email...",value:g,onChange:e=>b(e.target.value),className:"flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsxs)("select",{value:p,onChange:e=>u(e.target.value),className:"px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,h.jsx)("option",{value:"all",children:"All Users"}),(0,h.jsx)("option",{value:"free",children:"Free"}),(0,h.jsx)("option",{value:"paid",children:"Premium"}),(0,h.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,h.jsx)("div",{className:"overflow-x-auto",children:(0,h.jsxs)("table",{className:"w-full",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-white border-opacity-20",children:[(0,h.jsx)("th",{className:"text-left py-3 px-2 text-gray-300 w-10",children:(0,h.jsx)("input",{type:"checkbox",checked:y.length===R.length&&R.length>0,onChange:()=>{y.length===R.length?N([]):N(R.map(e=>e.id))},className:"rounded"})}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Email"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Tier"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Status"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Created"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Last Login"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Actions"})]})}),(0,h.jsx)("tbody",{children:U.map(e=>(0,h.jsxs)("tr",{className:"border-b border-white border-opacity-10 hover:bg-white hover:bg-opacity-5 ".concat(y.includes(e.id)?"bg-blue-500 bg-opacity-10":""),children:[(0,h.jsx)("td",{className:"py-3 px-2",children:(0,h.jsx)("input",{type:"checkbox",checked:y.includes(e.id),onChange:()=>{return t=e.id,void N(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"rounded"})}),(0,h.jsx)("td",{className:"py-3 px-4 text-white",children:e.email}),(0,h.jsx)("td",{className:"py-3 px-4",children:(0,h.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold ".concat("paid"===e.tier?"bg-purple-500 text-white":"admin"===e.tier?"bg-yellow-500 text-gray-900":"bg-gray-500 text-white"),children:e.tier})}),(0,h.jsx)("td",{className:"py-3 px-4",children:(0,h.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold ".concat("active"===e.status?"bg-green-500 text-white":"bg-red-500 text-white"),children:e.status})}),(0,h.jsx)("td",{className:"py-3 px-4 text-gray-300",children:new Date(e.created_at).toLocaleDateString()}),(0,h.jsx)("td",{className:"py-3 px-4 text-gray-300",children:e.last_login?new Date(e.last_login).toLocaleDateString():"Never"}),(0,h.jsxs)("td",{className:"py-3 px-4",children:[(0,h.jsx)("button",{onClick:()=>o(e),className:"text-green-400 hover:text-green-300 mr-3",title:"View Details",children:"View"}),(0,h.jsx)("button",{onClick:()=>r(e),className:"text-blue-400 hover:text-blue-300 mr-3",children:"Edit"}),(0,h.jsx)("button",{onClick:()=>i(e),className:"text-red-400 hover:text-red-300",children:"Delete"})]})]},e.id))})]})}),E>1&&(0,h.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-white border-opacity-10",children:[(0,h.jsxs)("span",{className:"text-gray-400 text-sm",children:["Showing ",25*(L-1)+1,"\u2013",Math.min(25*L,R.length)," of ",R.length]}),(0,h.jsxs)("div",{className:"flex gap-1",children:[(0,h.jsx)("button",{onClick:()=>F(1),disabled:1===L,className:"px-3 py-1.5 rounded text-sm bg-white/5 text-gray-300 hover:bg-white/10 disabled:opacity-30",children:"\xab"}),(0,h.jsx)("button",{onClick:()=>F(e=>Math.max(1,e-1)),disabled:1===L,className:"px-3 py-1.5 rounded text-sm bg-white/5 text-gray-300 hover:bg-white/10 disabled:opacity-30",children:"\u2039"}),Array.from({length:Math.min(5,E)},(e,t)=>{const s=Math.max(1,Math.min(L-2,E-4))+t;return s>E?null:(0,h.jsx)("button",{onClick:()=>F(s),className:"px-3 py-1.5 rounded text-sm ".concat(s===L?"bg-blue-600 text-white":"bg-white/5 text-gray-300 hover:bg-white/10"),children:s},s)}),(0,h.jsx)("button",{onClick:()=>F(e=>Math.min(E,e+1)),disabled:L===E,className:"px-3 py-1.5 rounded text-sm bg-white/5 text-gray-300 hover:bg-white/10 disabled:opacity-30",children:"\u203a"}),(0,h.jsx)("button",{onClick:()=>F(E),disabled:L===E,className:"px-3 py-1.5 rounded text-sm bg-white/5 text-gray-300 hover:bg-white/10 disabled:opacity-30",children:"\xbb"})]})]})]}),(0,h.jsx)(v.A,(0,a.A)({},T))]})},ge=e=>{let{connections:t,onRefresh:s,onDisconnect:a}=e;const[r,i]=(0,l.useState)(1),n=Math.ceil(t.length/30),c=t.slice(30*(r-1),30*r);return(0,l.useEffect)(()=>{const e=setInterval(()=>s(),3e4);return()=>clearInterval(e)},[s]),(0,h.jsx)("div",{className:"space-y-6",children:(0,h.jsxs)(x.A,{className:"p-6",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,h.jsxs)("h2",{className:"text-2xl font-bold text-white",children:["Active Connections (",t.length,")"]}),(0,h.jsx)(m.A,{variant:"outline",size:"sm",onClick:s,children:"Refresh"})]}),(0,h.jsx)("div",{className:"overflow-x-auto",children:(0,h.jsxs)("table",{className:"w-full",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{className:"border-b border-white border-opacity-20",children:[(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"User"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Server"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Protocol"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Connected At"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Duration"}),(0,h.jsx)("th",{className:"text-left py-3 px-4 text-gray-300",children:"Actions"})]})}),(0,h.jsx)("tbody",{children:c.map(e=>(0,h.jsxs)("tr",{className:"border-b border-white border-opacity-10 hover:bg-white hover:bg-opacity-5",children:[(0,h.jsx)("td",{className:"py-3 px-4 text-white",children:e.email}),(0,h.jsx)("td",{className:"py-3 px-4 text-gray-300",children:e.server_name}),(0,h.jsx)("td",{className:"py-3 px-4",children:(0,h.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold bg-blue-500 text-white",children:e.protocol})}),(0,h.jsx)("td",{className:"py-3 px-4 text-gray-300",children:new Date(e.connected_at).toLocaleString()}),(0,h.jsxs)("td",{className:"py-3 px-4 text-gray-300",children:[Math.floor((Date.now()-new Date(e.connected_at))/6e4)," min"]}),(0,h.jsx)("td",{className:"py-3 px-4",children:(0,h.jsx)("button",{onClick:()=>a(e),className:"text-red-400 hover:text-red-300",children:"Disconnect"})})]},e.id))})]})}),n>1&&(0,h.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-white border-opacity-10",children:[(0,h.jsxs)("span",{className:"text-gray-400 text-sm",children:["Showing ",30*(r-1)+1,"\u2013",Math.min(30*r,t.length)," of ",t.length]}),(0,h.jsxs)("div",{className:"flex gap-1",children:[(0,h.jsx)("button",{onClick:()=>i(1),disabled:1===r,className:"px-3 py-1.5 rounded text-sm bg-white/5 text-gray-300 hover:bg-white/10 disabled:opacity-30",children:"\xab"}),(0,h.jsx)("button",{onClick:()=>i(e=>Math.max(1,e-1)),disabled:1===r,className:"px-3 py-1.5 rounded text-sm bg-white/5 text-gray-300 hover:bg-white/10 disabled:opacity-30",children:"\u2039"}),Array.from({length:Math.min(5,n)},(e,t)=>{const s=Math.max(1,Math.min(r-2,n-4))+t;return s>n?null:(0,h.jsx)("button",{onClick:()=>i(s),className:"px-3 py-1.5 rounded text-sm ".concat(s===r?"bg-blue-600 text-white":"bg-white/5 text-gray-300 hover:bg-white/10"),children:s},s)}),(0,h.jsx)("button",{onClick:()=>i(e=>Math.min(n,e+1)),disabled:r===n,className:"px-3 py-1.5 rounded text-sm bg-white/5 text-gray-300 hover:bg-white/10 disabled:opacity-30",children:"\u203a"}),(0,h.jsx)("button",{onClick:()=>i(n),disabled:r===n,className:"px-3 py-1.5 rounded text-sm bg-white/5 text-gray-300 hover:bg-white/10 disabled:opacity-30",children:"\xbb"})]})]})]})})},be=()=>{var e,t;(0,de.A)("Admin Dashboard");const s=(0,r.Zp)(),{user:n,logout:x}=(0,o.A)(),[p,u]=(0,l.useState)("overview"),f=[{id:"dashboard",label:"Dashboard",icon:c.YYR,items:[{id:"overview",name:"Overview",icon:c.YYR}]},{id:"user-mgmt",label:"User Management",icon:c.YXz,items:[{id:"users",name:"Users",icon:c.YXz},{id:"sessions",name:"Session Control",icon:c.O2x},{id:"abuse",name:"Abuse Detection",icon:c.SMR}]},{id:"servers",label:"Servers & Network",icon:c.vwk,items:[{id:"servers",name:"Command Center",icon:c.vwk},{id:"connections",name:"Connections",icon:c.nVN},{id:"vps",name:"VPS Metrics",icon:c.nBS},{id:"loadbalancer",name:"Load Balancer",icon:c.CbL},{id:"qos",name:"QoS",icon:c.$BV}]},{id:"financial",label:"Financial",icon:c.Tsk,items:[{id:"payments",name:"Payments",icon:c.Tsk},{id:"revenue",name:"Revenue",icon:c.YYR},{id:"forecasting",name:"Forecasting",icon:c.v$b},{id:"discounts",name:"Discounts",icon:c.Tsk}]},{id:"communication",label:"Communication",icon:c.maD,items:[{id:"tickets",name:"Support Tickets",icon:c.tVd},{id:"contact",name:"Messages",icon:c.maD},{id:"emails",name:"Email Templates",icon:c.maD},{id:"announcements",name:"Announcements",icon:c.sdT}]},{id:"monitoring",label:"Monitoring",icon:c.szJ,items:[{id:"errors",name:"Errors",icon:c.BS8},{id:"alerts",name:"Alerts",icon:c.BS8},{id:"audit",name:"Audit Trail",icon:c.OKX}]},{id:"analytics",label:"Analytics",icon:c.f35,items:[{id:"geo",name:"Geo Analytics",icon:c.f35},{id:"segments",name:"Segments",icon:c.v$b}]},{id:"security",label:"Security",icon:c.SMR,items:[{id:"bans",name:"IP/Device Bans",icon:c.e7y},{id:"gdpr",name:"GDPR",icon:c.JhU}]},{id:"settings",label:"Settings",icon:c.Pcn,items:[{id:"system",name:"System Settings",icon:c.Pcn}]}],[w,k]=(0,l.useState)(["dashboard"]),[P,R]=(0,l.useState)(!1),{confirm:U,dialogProps:O}=(0,j.A)(),[K,B]=(0,l.useState)(null),[z,W]=(0,l.useState)([]),[G,q]=(0,l.useState)([]),[X,Y]=(0,l.useState)(!0),[$,J]=(0,l.useState)(null),[Z,ee]=(0,l.useState)({isOpen:!1,user:null}),[te,se]=(0,l.useState)({isOpen:!1,server:null}),[ae,be]=(0,l.useState)({isOpen:!1,type:null,item:null,onConfirm:null}),[ye,je]=(0,l.useState)(!1),[ve,Ne]=(0,l.useState)({isOpen:!1,userId:null}),[fe,we]=(0,l.useState)({email:"",password:"",tier:"free"}),[_e,ke]=(0,l.useState)("");(0,l.useEffect)(()=>{Ce()},[]);const Ce=async()=>{try{Y(!0);const[e,t,s]=await Promise.all([d.Kp.getAnalytics(),d.Kp.getUsers(),d.Kp.getConnections()]);B(e.data||{}),W(t.data||[]),q(s.data||[])}catch(e){J("Failed to load admin data"),console.error("Admin data load error:",e)}finally{Y(!1)}};(0,l.useEffect)(()=>{const e=f.find(e=>e.items.some(e=>e.id===p));e&&!w.includes(e.id)&&k(t=>[...t,e.id])},[p]);return X?(0,h.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center",children:(0,h.jsxs)("div",{className:"text-white text-center",children:[(0,h.jsx)("div",{className:"spinner mx-auto mb-4"}),(0,h.jsx)("div",{className:"text-2xl",children:"Loading Admin Panel..."})]})}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex flex-col",children:[(0,h.jsx)("nav",{className:"bg-black/50 backdrop-blur-md border-b border-white/10 flex-shrink-0",children:(0,h.jsx)("div",{className:"px-4 sm:px-6 lg:px-8",children:(0,h.jsxs)("div",{className:"flex justify-between items-center h-14",children:[(0,h.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,h.jsx)("button",{onClick:()=>R(!P),className:"md:hidden text-gray-300 hover:text-white p-1",children:(0,h.jsx)(c.OXb,{className:"text-lg"})}),(0,h.jsx)(c.e7y,{className:"text-yellow-400 text-xl"}),(0,h.jsx)("h1",{className:"text-white text-lg font-bold",children:"Admin Panel"})]}),(0,h.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,h.jsx)(i.N_,{to:"/dashboard",className:"text-gray-300 hover:text-white transition text-sm",children:"User View"}),(0,h.jsx)("span",{className:"text-gray-400 text-sm hidden sm:inline",children:null===n||void 0===n?void 0:n.email}),(0,h.jsx)("button",{onClick:async()=>{await U({title:"Logout",message:"Are you sure you want to logout from the admin panel?",confirmText:"Logout",variant:"warning"})&&(await x(),s("/login"))},className:"text-gray-300 hover:text-red-400 transition",title:"Logout",children:(0,h.jsx)(c.axc,{})})]})]})})}),(0,h.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,h.jsx)("aside",{className:"".concat(P?"translate-x-0":"-translate-x-full"," md:translate-x-0 fixed md:relative z-30 md:z-auto w-56 h-[calc(100vh-56px)] bg-gray-900 md:bg-transparent border-r border-white/10 overflow-y-auto transition-transform duration-200 flex-shrink-0"),children:(0,h.jsx)("nav",{className:"py-2",children:f.map(e=>{const t=w.includes(e.id),s=e.items.some(e=>e.id===p);return(0,h.jsxs)("div",{className:"mb-0.5",children:[(0,h.jsxs)("button",{onClick:()=>{var t;1===e.items.length?(u(e.items[0].id),R(!1)):(t=e.id,k(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]))},className:"w-full flex items-center justify-between px-4 py-2 text-xs font-semibold uppercase tracking-wider transition ".concat(s?"text-blue-400":"text-gray-500 hover:text-gray-300"),children:[(0,h.jsxs)("span",{className:"flex items-center",children:[(0,h.jsx)(e.icon,{className:"mr-2 text-sm"}),e.label]}),e.items.length>1&&(t?(0,h.jsx)(c.Vr3,{className:"text-[10px]"}):(0,h.jsx)(c.X6T,{className:"text-[10px]"}))]}),(t||1===e.items.length)&&(0,h.jsx)("div",{className:e.items.length>1?"border-l border-white/5 ml-6":"",children:e.items.map(e=>(0,h.jsxs)("button",{onClick:()=>{u(e.id),R(!1)},className:"w-full flex items-center px-4 py-1.5 text-sm transition ".concat(p===e.id?"text-white bg-blue-600/20 border-r-2 border-blue-500":"text-gray-400 hover:text-white hover:bg-white/5"),children:[(0,h.jsx)(e.icon,{className:"mr-2 text-xs opacity-75"}),e.name]},e.id))})]},e.id)})})}),P&&(0,h.jsx)("div",{className:"md:hidden fixed inset-0 bg-black/50 z-20",onClick:()=>R(!1)}),(0,h.jsx)("main",{className:"flex-1 overflow-y-auto",children:(0,h.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:["overview"===p&&(0,h.jsx)(he,{analytics:K,onNavigate:u}),"users"===p&&(0,h.jsx)(ue,{users:z,onRefresh:Ce,onEdit:e=>ee({isOpen:!0,user:e}),onDelete:e=>be({isOpen:!0,type:"user",item:e,onConfirm:()=>async function(e){await d.Kp.deleteUser(e),Ce()}(e.id)}),onCreateUser:()=>je(!0),onViewUser:e=>Ne({isOpen:!0,userId:e.id})}),"connections"===p&&(0,h.jsx)(ge,{connections:G,onRefresh:Ce,onDisconnect:e=>async function(e){await d.Kp.forceDisconnect(e),Ce()}(e.id)}),"servers"===p&&(0,h.jsx)(Q,{onOpenServerModal:e=>se({isOpen:!0,server:e||null}),onDeleteServer:e=>be({isOpen:!0,type:"server",item:e,onConfirm:()=>async function(e){await d.Kp.deleteServer(e),Ce()}(e.id)}),onRefreshParent:Ce}),"tickets"===p&&(0,h.jsx)(C,{}),"payments"===p&&(0,h.jsx)(N,{}),"contact"===p&&(0,h.jsx)(A,{}),"errors"===p&&(0,h.jsx)(S,{}),"discounts"===p&&(0,h.jsx)(D,{}),"system"===p&&(0,h.jsx)(_,{}),"emails"===p&&(0,h.jsx)(F,{}),"announcements"===p&&(0,h.jsx)(E,{}),"audit"===p&&(0,h.jsx)(T,{}),"revenue"===p&&(0,h.jsx)(l.Suspense,{fallback:(0,h.jsx)(pe,{}),children:(0,h.jsx)(xe,{})}),"vps"===p&&(0,h.jsx)(H,{}),"alerts"===p&&(0,h.jsx)(V,{}),"bans"===p&&(0,h.jsx)(M,{}),"geo"===p&&(0,h.jsx)(L,{}),"segments"===p&&(0,h.jsx)(le,{}),"abuse"===p&&(0,h.jsx)(re,{}),"sessions"===p&&(0,h.jsx)(ie,{}),"loadbalancer"===p&&(0,h.jsx)(ne,{}),"qos"===p&&(0,h.jsx)(ce,{}),"gdpr"===p&&(0,h.jsx)(oe,{}),"forecasting"===p&&(0,h.jsx)(l.Suspense,{fallback:(0,h.jsx)(pe,{}),children:(0,h.jsx)(me,{})})]})})]}),(0,h.jsx)(g,{isOpen:Z.isOpen,onClose:()=>ee({isOpen:!1,user:null}),user:Z.user,onSuccess:Ce}),(0,h.jsx)(b,{isOpen:te.isOpen,onClose:()=>se({isOpen:!1,server:null}),server:te.server,onSuccess:Ce}),(0,h.jsx)(y,{isOpen:ae.isOpen,onClose:()=>be({isOpen:!1,type:null,item:null,onConfirm:null}),type:ae.type,itemName:(null===(e=ae.item)||void 0===e?void 0:e.email)||(null===(t=ae.item)||void 0===t?void 0:t.name),onConfirm:ae.onConfirm}),(0,h.jsx)(I,{isOpen:ve.isOpen,onClose:()=>Ne({isOpen:!1,userId:null}),userId:ve.userId,onRefresh:Ce}),ye&&(0,h.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50",children:(0,h.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[(0,h.jsx)("h3",{className:"text-xl font-bold text-white mb-4",children:"Create New User"}),_e&&(0,h.jsx)("div",{className:"mb-3 p-2 bg-red-500/20 text-red-300 rounded text-sm",children:_e}),(0,h.jsxs)("div",{className:"space-y-3",children:[(0,h.jsx)("input",{type:"email",placeholder:"Email",value:fe.email,onChange:e=>we((0,a.A)((0,a.A)({},fe),{},{email:e.target.value})),className:"w-full px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsx)("input",{type:"password",placeholder:"Password",value:fe.password,onChange:e=>we((0,a.A)((0,a.A)({},fe),{},{password:e.target.value})),className:"w-full px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,h.jsxs)("select",{value:fe.tier,onChange:e=>we((0,a.A)((0,a.A)({},fe),{},{tier:e.target.value})),className:"w-full px-4 py-2 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,h.jsx)("option",{value:"free",children:"Free"}),(0,h.jsx)("option",{value:"paid",children:"Premium"}),(0,h.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,h.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,h.jsx)(m.A,{variant:"outline",fullWidth:!0,onClick:()=>{je(!1),ke(""),we({email:"",password:"",tier:"free"})},children:"Cancel"}),(0,h.jsx)(m.A,{variant:"primary",fullWidth:!0,onClick:async()=>{try{ke(""),await d.Kp.createUser(fe),je(!1),we({email:"",password:"",tier:"free"}),Ce()}catch(s){var e,t;ke((null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Failed to create user")}},children:"Create User"})]})]})})]}),(0,h.jsx)(v.A,(0,a.A)({},O))]})}},4951:(e,t,s)=>{s.d(t,{A:()=>l});var a=s(5043);const l=e=>{(0,a.useEffect)(()=>{const t=document.title;return document.title=e?"".concat(e," | VPN XO"):"VPN XO - Secure VPN Service",()=>{document.title=t}},[e])}},8289:(e,t,s)=>{s.d(t,{A:()=>c});var a=s(9379),l=s(3986),r=(s(5043),s(12)),i=s(579);const n=["children","variant","hover","className","onClick"],c=e=>{let{children:t,variant:s="default",hover:c=!0,className:o="",onClick:d}=e,x=(0,l.A)(e,n);const m=c?"hover:shadow-2xl hover:scale-105 cursor-pointer":"",p="\n    ".concat("rounded-2xl transition-all duration-300","\n    ").concat({default:"bg-white bg-opacity-10 backdrop-blur-md border border-white border-opacity-20",solid:"bg-white shadow-xl",gradient:"bg-gradient-to-br from-blue-600 to-purple-600",glass:"bg-white bg-opacity-5 backdrop-blur-lg border border-white border-opacity-10"}[s],"\n    ").concat(m,"\n    ").concat(o,"\n  ").trim().replace(/\s+/g," ");return(0,i.jsx)(r.P.div,(0,a.A)((0,a.A)({className:p,onClick:d,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},whileHover:c?{y:-5}:{}},x),{},{children:t}))}}}]);
//# sourceMappingURL=870.00700afe.chunk.js.map